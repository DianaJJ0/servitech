<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pago de Asesoría | Servitech</title>
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/css/pasarela-pagos.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- MercadoPago SDK -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>

<body>
  <%- include('componentes/header') %>

    <div class="container">
      <div class="payment-container">

        <a href="javascript:history.back()" class="back-link">
          <i class="fas fa-arrow-left"></i> Volver al calendario
        </a>

        <div class="payment-card">
          <div class="payment-header">
            <img src="/assets/img/logo.png" alt="Servitech Logo" class="logo-img" />
            <h1>Confirmar Pago</h1>
            <div class="service-info">
              <% if (typeof expertoSeleccionado !=='undefined' && expertoSeleccionado) { %>
                <p>
                  Asesoría con <%= expertoSeleccionado.nombre %>
                    <%= expertoSeleccionado.apellido ? ' ' + expertoSeleccionado.apellido : '' %>
                </p>
                <% } else { %>
                  <p>Asesoría técnica especializada</p>
                  <% } %>
                    <div class="price" id="montoTotal">
                      $<%= req.query.monto ? parseInt(req.query.monto).toLocaleString('es-CO') : '20.000' %> COP
                    </div>
            </div>
          </div>

          <div class="payment-body">
            <!-- Resumen de la asesoría -->
            <div class="resumen-asesoria">
              <h3><i class="fas fa-calendar-alt"></i> Resumen de tu asesoría</h3>
              <div id="resumenDatos">
                <!-- Se llenará con JavaScript desde localStorage -->
              </div>
            </div>

            <!-- Contenedor para el botón de MercadoPago -->
            <div id="wallet_container"></div>

            <!-- Información de seguridad -->
            <div class="payment-security">
              <div class="security-item">
                <i class="fas fa-lock"></i>
                <span>Pago seguro con MercadoPago</span>
              </div>
              <div class="security-item">
                <i class="fas fa-shield-alt"></i>
                <span>Tu dinero está protegido</span>
              </div>
              <div class="security-item">
                <i class="fas fa-undo-alt"></i>
                <span>Reembolso si el experto rechaza</span>
              </div>
            </div>

            <!-- Loading state -->
            <div id="loadingState" style="display: none;">
              <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Creando preferencia de pago...</p>
              </div>
            </div>

            <!-- Error state -->
            <div id="errorState" style="display: none;" class="error-message">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Error al procesar el pago. <a href="javascript:location.reload()">Intentar nuevamente</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('componentes/footer') %>

      <!-- Datos del servidor para JavaScript -->
      <script type="application/json" id="serverData"><%- JSON.stringify({
    expertoSeleccionado: expertoSeleccionado || {},
    montoQuery: req.query.monto || "",
    duracionQuery: req.query.duracion || ""
  }) %></script>

      <script src="/assets/js/common.js"></script>
      <script src="/assets/js/pasarelaPagos.js"></script>
</body>

</html>
