<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pago de Asesoría | ServiTech</title>

  <!-- Estilos CSS en orden correcto -->
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/componentes.css">
  <link rel="stylesheet" href="/assets/css/pasarela-pagos.css">

  <!-- Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Meta tags -->
  <meta name="description" content="Procesa el pago de tu asesoría técnica de forma segura">
  <meta name="robots" content="noindex, nofollow">
</head>

<body>
  <%- include('componentes/header') %>

    <main class="main-content">
      <div class="container">

        <!-- Navegación de retorno -->
        <nav class="breadcrumb-nav">
          <a href="javascript:history.back()" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Volver al calendario
          </a>
        </nav>

        <!-- Alerta de notificaciones -->
        <div id="alertContainer" class="alert-container hidden">
          <div class="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="alertText">Mensaje de alerta</span>
            <button onclick="cerrarAlerta()" class="alert-close">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- Tarjeta principal de pago -->
        <section class="payment-card">

          <!-- Header del pago -->
          <header class="payment-header">
            <div class="logo-container">
              <span>Servitech</span>
            </div>

            <div class="payment-title">
              <h1>Confirmar Pago de Asesoría</h1>
              <% if (typeof expertoSeleccionado !=='undefined' && expertoSeleccionado && expertoSeleccionado.nombre) {
                %>
                <p class="payment-subtitle">
                  Asesoría con <%= expertoSeleccionado.nombre %>
                    <% if (expertoSeleccionado.apellido) { %>
                      <%= expertoSeleccionado.apellido %>
                        <% } %>
                </p>
                <% } else { %>
                  <p class="payment-subtitle">Asesoría técnica especializada</p>
                  <% } %>
            </div>

            <div class="payment-amount">
              <div class="amount-label">Total a pagar:</div>
              <div class="amount-value" id="montoTotal">
                <% let montoSeguro=20000; if (typeof monto !=='undefined' && monto !==null && !isNaN(monto)) {
                  montoSeguro=parseInt(monto); } %>
                  $<%= montoSeguro.toLocaleString('es-CO') %> COP
              </div>
            </div>
          </header>

          <!-- Cuerpo del pago -->
          <section class="payment-body">

            <!-- Resumen de la asesoría -->
            <div class="payment-summary">
              <h2 class="summary-title">
                <i class="fas fa-calendar-check"></i>
                Resumen de tu asesoría
              </h2>
              <div id="resumenDatos" class="summary-content">
                <div class="loading-placeholder">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Cargando datos de la asesoría...</span>
                </div>
              </div>
            </div>

            <!-- BOTÓN MERCADO PAGO -->
            <div class="mp-checkout-container">
              <h3 class="form-title"><i class="fab fa-cc-visa"></i> Pagar con Mercado Pago</h3>
              <p class="mp-info">Serás redirigido a la plataforma de Mercado Pago para completar el pago. Servitech no
                almacena datos de tarjeta.</p>
              <div class="form-row form-row-center">
                <!-- Botón brandado (visualmente Mercado Pago). Si la SDK inyecta otro botón, .mp-duplicate lo ocultará -->
                <button id="btnIrAMercadoPago" class="btn-pay mercadopago-button" type="button"
                  aria-label="Ir a Mercado Pago">
                  <span>Ir a Mercado Pago</span>
                </button>
              </div>
            </div>

            <!-- Área de procesamiento de pago -->
            <div class="payment-process">
              <div id="loadingState" class="loading-state hidden">
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                </div>
                <p class="loading-text">Procesando tu solicitud...</p>
              </div>
              <div id="successState" class="success-state hidden">
                <div class="success-icon">
                  <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="success-title">Pago Procesado Exitosamente</h3>
                <p class="success-message">
                  Tu pago ha sido procesado y la solicitud de asesoría fue enviada al experto.
                  Recibirás una notificación cuando el experto acepte o rechace tu solicitud.
                </p>
                <div class="success-actions">
                  <a href="/misAsesorias.html" class="btn btn-primary">
                    <i class="fas fa-calendar-alt"></i>
                    Ver Mis Asesorías
                  </a>
                  <a href="/expertos.html" class="btn btn-outline">
                    <i class="fas fa-search"></i>
                    Buscar Más Expertos
                  </a>
                </div>
              </div>
              <div id="errorState" class="error-state hidden">
                <div class="error-icon">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="error-title">Error al procesar el pago</h3>
                <p id="errorMessage" class="error-message">
                  Ocurrió un problema al procesar tu pago. Por favor, inténtalo nuevamente.
                </p>
                <div class="error-actions">
                  <button onclick="reintentar()" class="btn btn-primary">
                    <i class="fas fa-redo"></i>
                    Reintentar
                  </button>
                  <a href="/contacto.html" class="btn btn-outline">
                    <i class="fas fa-headset"></i>
                    Contactar Soporte
                  </a>
                </div>
              </div>
            </div>
          </section>

          <!-- Footer del pago -->
          <footer class="payment-footer">
            <div class="security-badges">
              <div class="security-item">
                <i class="fas fa-shield-alt"></i>
                <span>Pago 100% seguro</span>
              </div>
              <div class="security-item">
                <i class="fas fa-undo-alt"></i>
                <span>Reembolso automático si rechaza</span>
              </div>
            </div>
          </footer>
        </section>

        <!-- Información adicional -->
        <section class="additional-info">
          <div class="info-grid">
            <article class="info-card">
              <div class="info-icon">
                <i class="fas fa-video"></i>
              </div>
              <h3>Asesoría Virtual</h3>
              <p>Se realizará por videollamada en la fecha y hora acordada</p>
            </article>
            <article class="info-card">
              <div class="info-icon">
                <i class="fas fa-clock"></i>
              </div>
              <h3>Confirmación en 24h</h3>
              <p>El experto tiene hasta 24 horas para confirmar tu solicitud</p>
            </article>
            <article class="info-card">
              <div class="info-icon">
                <i class="fas fa-headset"></i>
              </div>
              <h3>Soporte Completo</h3>
              <p>Te acompañamos en todo el proceso de tu asesoría</p>
            </article>
          </div>
        </section>

      </div>
    </main>

    <%- include('componentes/footer') %>

      <!-- Datos del servidor para JavaScript -->
      <script type="application/json" id="serverData"><%- JSON.stringify({
    expertoSeleccionado: expertoSeleccionado || {},
    monto: typeof monto !== 'undefined' ? monto : 20000,
    duracion: typeof duracion !== 'undefined' ? duracion : 1,
    user: user || null,
    mpPublicKey: process.env.MP_PUBLIC_KEY || ''
  }) %></script>

      <!-- Scripts JavaScript -->
      <script src="/assets/js/common.js"></script>
      <script src="/assets/js/pasarelaPagos.js"></script>
</body>

</html>
