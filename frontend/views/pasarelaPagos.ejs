<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pago de Asesoría | ServiTech</title>

  <!-- Estilos CSS en orden correcto -->
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/componentes.css">
  <link rel="stylesheet" href="/assets/css/pasarela-pagos.css">

  <!-- Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Meta tags -->
  <meta name="description" content="Procesa el pago de tu asesoría técnica de forma segura">
  <meta name="robots" content="noindex, nofollow">
</head>

<body>
  <%- include('componentes/header') %>

    <main class="main-content">
      <div class="container">

        <!-- Navegación de retorno -->
        <nav class="breadcrumb-nav">
          <a href="javascript:history.back()" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Volver al calendario
          </a>
        </nav>

        <!-- Alerta de notificaciones -->
        <div id="alertContainer" class="alert-container" style="display: none;">
          <div class="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="alertText">Mensaje de alerta</span>
            <button onclick="cerrarAlerta()" class="alert-close">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- Tarjeta principal de pago -->
        <section class="payment-card">

          <!-- Header del pago -->
          <header class="payment-header">
            <div class="logo-container">
              <span>Servitech</span>
            </div>

            <div class="payment-title">
              <h1>Confirmar Pago de Asesoría</h1>
              <% if (typeof expertoSeleccionado !=='undefined' && expertoSeleccionado && expertoSeleccionado.nombre) {
                %>
                <p class="payment-subtitle">
                  Asesoría con <%= expertoSeleccionado.nombre %>
                    <% if (expertoSeleccionado.apellido) { %>
                      <%= expertoSeleccionado.apellido %>
                        <% } %>
                </p>
                <% } else { %>
                  <p class="payment-subtitle">Asesoría técnica especializada</p>
                  <% } %>
            </div>

            <div class="payment-amount">
              <div class="amount-label">Total a pagar:</div>
              <div class="amount-value" id="montoTotal">
                <% let montoSeguro=20000; if (typeof monto !=='undefined' && monto !==null && !isNaN(monto)) {
                  montoSeguro=parseInt(monto); } %>
                  $<%= montoSeguro.toLocaleString('es-CO') %> COP
              </div>
            </div>
          </header>

          <!-- Cuerpo del pago -->
          <section class="payment-body">

            <!-- Resumen de la asesoría -->
            <div class="payment-summary">
              <h2 class="summary-title">
                <i class="fas fa-calendar-check"></i>
                Resumen de tu asesoría
              </h2>
              <div id="resumenDatos" class="summary-content">
                <div class="loading-placeholder">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Cargando datos de la asesoría...</span>
                </div>
              </div>
            </div>

            <!-- FORMULARIO DE PAGO -->
            <form id="formPago" class="form-pago" autocomplete="off">

              <h3 class="form-title"><i class="fas fa-credit-card"></i> Información para el pago</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="nombrePago">Nombre completo</label>
                  <input type="text" id="nombrePago" name="nombrePago" maxlength="80" required
                    pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ ]{5,80}$" placeholder="Como aparece en la tarjeta"
                    autocomplete="cc-name">
                  <small class="input-help">Solo letras y espacios. Ej: Juan Pérez</small>
                </div>
                <div class="form-group">
                  <label for="emailPago">Correo electrónico</label>
                  <input type="email" id="emailPago" name="emailPago" maxlength="80" required
                    placeholder="tucorreo@email.com" autocomplete="email">
                  <small class="input-help">Ejemplo: usuario@email.com</small>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="cedulaPago">Cédula/NIT</label>
                  <input type="text" id="cedulaPago" name="cedulaPago" maxlength="15" required pattern="^[0-9]{5,15}$"
                    placeholder="Ej: 1234567890" inputmode="numeric" autocomplete="off">
                  <small class="input-help">Solo números, entre 5 y 15 dígitos.</small>
                </div>
                <div class="form-group">
                  <label for="telefonoPago">Teléfono (opcional)</label>
                  <input type="text" id="telefonoPago" name="telefonoPago" maxlength="10" pattern="^[0-9]{0,10}$"
                    placeholder="Ej: 3001234567" inputmode="numeric" autocomplete="tel">
                  <small class="input-help">Solo números, máximo 10 dígitos.</small>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="metodoPago">Método de pago</label>
                  <select id="metodoPago" name="metodoPago" required>
                    <option value="">Selecciona un método</option>
                    <option value="tarjeta">Tarjeta de crédito/débito</option>
                    <option value="pse">PSE (simulado)</option>
                  </select>
                  <small class="input-help">Elige cómo deseas pagar</small>
                </div>
                <div class="form-group">
                  <label for="numeroTarjeta">Número de tarjeta</label>
                  <input type="text" id="numeroTarjeta" name="numeroTarjeta" maxlength="19"
                    pattern="^(?:[0-9]{4} ?){4,5}$" placeholder="0000 0000 0000 0000" inputmode="numeric"
                    autocomplete="cc-number">
                  <small class="input-help">16 a 19 dígitos, solo números. Ej: 1234 5678 9012 3456</small>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="expiracionTarjeta">Fecha de expiración</label>
                  <input type="text" id="expiracionTarjeta" name="expiracionTarjeta" maxlength="5"
                    pattern="^(0[1-9]|1[0-2])\/([0-9]{2})$" placeholder="MM/AA" autocomplete="cc-exp"
                    inputmode="numeric">
                  <small class="input-help">Formato MM/AA. Ej: 08/27</small>
                </div>
                <div class="form-group">
                  <label for="cvvTarjeta">CVV</label>
                  <input type="password" id="cvvTarjeta" name="cvvTarjeta" maxlength="4" pattern="^[0-9]{3,4}$"
                    placeholder="123" inputmode="numeric" autocomplete="cc-csc">
                  <small class="input-help">3 o 4 dígitos, solo números.</small>
                </div>
              </div>
              <div class="form-row form-row-center">
                <button id="btnPagar" class="btn-pay" type="submit">
                  <i class="fas fa-play"></i>
                  Pagar Ahora
                </button>
              </div>
            </form>

            <!-- Área de procesamiento de pago -->
            <div class="payment-process">
              <div id="loadingState" class="loading-state" style="display: none;">
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                </div>
                <p class="loading-text">Procesando tu solicitud...</p>
              </div>
              <div id="successState" class="success-state" style="display: none;">
                <div class="success-icon">
                  <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="success-title">Pago Procesado Exitosamente</h3>
                <p class="success-message">
                  Tu pago ha sido procesado y la solicitud de asesoría fue enviada al experto.
                  Recibirás una notificación cuando el experto acepte o rechace tu solicitud.
                </p>
                <div class="success-actions">
                  <a href="/misAsesorias.html" class="btn btn-primary">
                    <i class="fas fa-calendar-alt"></i>
                    Ver Mis Asesorías
                  </a>
                  <a href="/expertos.html" class="btn btn-outline">
                    <i class="fas fa-search"></i>
                    Buscar Más Expertos
                  </a>
                </div>
              </div>
              <div id="errorState" class="error-state" style="display: none;">
                <div class="error-icon">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="error-title">Error al procesar el pago</h3>
                <p id="errorMessage" class="error-message">
                  Ocurrió un problema al procesar tu pago. Por favor, inténtalo nuevamente.
                </p>
                <div class="error-actions">
                  <button onclick="reintentar()" class="btn btn-primary">
                    <i class="fas fa-redo"></i>
                    Reintentar
                  </button>
                  <a href="/contacto.html" class="btn btn-outline">
                    <i class="fas fa-headset"></i>
                    Contactar Soporte
                  </a>
                </div>
              </div>
            </div>
          </section>

          <!-- Footer del pago -->
          <footer class="payment-footer">
            <div class="security-badges">
              <div class="security-item">
                <i class="fas fa-shield-alt"></i>
                <span>Pago 100% seguro</span>
              </div>
              <div class="security-item">
                <i class="fas fa-undo-alt"></i>
                <span>Reembolso automático si rechaza</span>
              </div>
            </div>
          </footer>
        </section>

        <!-- Información adicional -->
        <section class="additional-info">
          <div class="info-grid">
            <article class="info-card">
              <div class="info-icon">
                <i class="fas fa-video"></i>
              </div>
              <h3>Asesoría Virtual</h3>
              <p>Se realizará por videollamada en la fecha y hora acordada</p>
            </article>
            <article class="info-card">
              <div class="info-icon">
                <i class="fas fa-clock"></i>
              </div>
              <h3>Confirmación en 24h</h3>
              <p>El experto tiene hasta 24 horas para confirmar tu solicitud</p>
            </article>
            <article class="info-card">
              <div class="info-icon">
                <i class="fas fa-headset"></i>
              </div>
              <h3>Soporte Completo</h3>
              <p>Te acompañamos en todo el proceso de tu asesoría</p>
            </article>
          </div>
        </section>

      </div>
    </main>

    <%- include('componentes/footer') %>

      <!-- Datos del servidor para JavaScript -->
      <script type="application/json" id="serverData"><%- JSON.stringify({
    expertoSeleccionado: expertoSeleccionado || {},
    monto: typeof monto !== 'undefined' ? monto : 20000,
    duracion: typeof duracion !== 'undefined' ? duracion : 1,
    user: user || null
  }) %></script>

      <!-- Scripts JavaScript -->
      <script src="/assets/js/common.js"></script>
      <script src="/assets/js/pasarelaPagos.js"></script>
</body>

</html>
