<!DOCTYPE html>
<!--
  Archivo: registroExperto.ejs
  Propósito: Formulario para que un usuario se registre como experto.
  Variables EJS esperadas:
    - categorias: array de categorías (opcional)
  Dependencias:
    - /assets/css/registroExperto.css, /assets/js/registroExperto.js
  Notas para Deepwiki:
    - Validar que la selección de categorías venga del servidor para evitar manipulación.
-->

<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Experto | Servitech</title>
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/css/registroExperto.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
</head>

<body>

  <main class="registroExperto-main">
    <section class="registroExperto-section">
      <!-- Alertas -->
      <div class="alert alert-danger hidden">
        Mensaje de error
      </div>
      <div class="alert alert-success hidden">
        Mensaje de éxito
      </div>

      <!-- Encabezado -->
      <div class="registro-header">
        <a href="/" class="logo-link"><img src="/assets/img/logo.png" alt="Logo de ServiTech" class="logo-img"></a>
        <div class="registro-header-content">
          <h1 class="registro-header-title">Registro de Experto</h1>
          <p class="subtitle registro-header-subtitle">Completa tu perfil para ofrecer asesorías de forma profesional
          </p>
        </div>
        <div class="registro-header-right">
          <span id="currentDate" class="registro-fecha"></span>
          <a href="/" class="back-link"><i class="fas fa-arrow-left"></i>Inicio</a>
        </div>
      </div>

      <!-- Formulario -->
      <form id="registroExpertoForm" class="registroExperto-form" autocomplete="off">
        <!-- Sección 1: Información básica -->
        <div class="form-section">
          <h2 class="form-section-title"><i class="fas fa-user"></i> Información básica</h2>

          <div class="form-row triple">
            <!-- Sección de email (solo lectura) -->
            <div class="form-group compact email-group">
              <label for="email"><i class="fas fa-envelope"></i> Email registrado</label>
              <div class="email-field">
                <span id="email-display">
                  <%= typeof email !=='undefined' && email ? email : (user && user.email ? user.email
                    : 'email registrado' ) %>
                </span>
              </div>
              <p class="form-hint">Email asociado a tu cuenta</p>
            </div>

            <!-- Sección de precio -->
            <div class="form-group compact price-group">
              <label for="precio">Precio por hora (COP)
                <span class="price-tooltip" title="Ej: 30.000 - 200.000"><i class="fas fa-info-circle"></i></span>
              </label>
              <div class="price-input">
                <span class="currency">$</span>
                <input type="number" id="precio" name="precio" min="10000" step="100" required placeholder="Ej: 50000"
                  inputmode="numeric" class="form-control">
              </div>
              <p class="form-hint">Define un precio proporcional a tu experiencia</p>
            </div>

            <!-- Sección de teléfono -->
            <div class="form-group compact">
              <label for="telefonoContacto"><i class="fas fa-phone"></i> Teléfono de contacto</label>
              <input type="tel" id="telefonoContacto" name="telefonoContacto" placeholder="Ej: 3001234567"
                class="form-control">
              <p class="form-hint">Se usa solo para coordinar asesorías</p>
            </div>
          </div>
        </div>

        <!-- Sección 2: Descripción profesional -->
        <div class="form-section">
          <h2 class="form-section-title"><i class="fas fa-file-alt"></i> Descripción profesional</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="descripcion">Tu experiencia y especialidades</label>
              <textarea id="descripcion" name="descripcion" rows="4"
                placeholder="Cuenta brevemente tu experiencia, herramientas y tipos de proyectos"
                class="form-control"><%= (typeof experto !== 'undefined' && experto && experto.infoExperto && experto.infoExperto.descripcion) ? experto.infoExperto.descripcion : '' %></textarea>
              <p class="form-hint">Sé concreto y destaca resultados</p>
            </div>
          </div>
        </div>

        <!-- Sección 3: Categorías y disponibilidad -->
        <div class="form-section">
          <h2 class="form-section-title"><i class="fas fa-tags"></i> Categorías y disponibilidad</h2>
          <div class="form-row double">
            <!-- Sección de categorías -->
            <div class="form-group">
              <label for="categorias">Categorías de especialización</label>
              <select id="categorias" name="categorias[]" multiple class="form-control"
                aria-label="Categorías de especialización">
                <% if (Array.isArray(typeof categorias !=='undefined' ? categorias : []) && (categorias || []).length) {
                  %>
                  <% (categorias || []).forEach(function(cat){ %>
                    <option value="<%= cat.id %>">
                      <%= cat.name %>
                    </option>
                    <% }); %>
                      <% } else { %>
                        <option disabled>No hay categorías disponibles</option>
                        <% } %>
              </select>
              <p class="form-hint">Selecciona hasta 5 categorías</p>
            </div>
            <!-- Sección de días disponibles -->
            <div class="form-group">
              <label>Días disponibles</label>
              <div class="days-selector">
                <button type="button" class="day-option" data-day="Lunes">Lun</button>
                <button type="button" class="day-option" data-day="Martes">Mar</button>
                <button type="button" class="day-option" data-day="Miércoles">Mié</button>
                <button type="button" class="day-option" data-day="Jueves">Jue</button>
                <button type="button" class="day-option" data-day="Viernes">Vie</button>
                <button type="button" class="day-option" data-day="Sábado">Sáb</button>
                <button type="button" class="day-option" data-day="Domingo">Dom</button>
              </div>
              <input type="hidden" id="diasDisponibles" name="diasDisponibles" value="">
              <div class="days-selected-display">Selecciona tus días disponibles</div>
            </div>
          </div>
        </div>

        <!-- Sección 5: Datos bancarios (estructura mejorada) -->
        <section class="form-section" aria-labelledby="bank-data-title">

          <header class="form-section-header">
            <h2 id="bank-data-title" class="form-section-title">
              <i class="fas fa-university" aria-hidden="true"></i>
              Datos bancarios
            </h2>
            <p class="form-section-description">
              Información requerida para realizar transferencias y pagos
            </p>
          </header>

          <div class="form-content">
            <div class="bank-data-grid">
              <!-- Información del banco -->
              <div class="form-field-group">

                <h4 class="form-subtitle">Información del banco</h4>
                <div class="form-row cols-4">
                  <!-- Banco (selector simple) -->
                  <div class="form-field">
                    <label for="banco" class="form-label">Banco</label>
                    <div class="select-wrapper">
                      <select id="banco" name="banco" class="form-control" aria-describedby="banco-hint">
                        <option value="">Selecciona</option>
                        <option value="Bancolombia">Bancolombia</option>
                        <option value="Nequi">Nequi</option>
                      </select>
                    </div>
                    <p class="form-hint" id="banco-hint">El banco donde recibirás los pagos</p>
                    <div class="mensaje-error" id="errorBanco"></div>
                  </div>
                  <!-- Tipo de cuenta -->
                  <div class="form-field">
                    <label for="tipo-cuenta" class="form-label">Tipo de cuenta</label>
                    <div class="select-wrapper">
                      <select id="tipo-cuenta" name="tipoCuenta" class="form-control"
                        aria-describedby="tipo-cuenta-hint">
                        <option value="">Selecciona</option>
                        <option value="Ahorros">Ahorros</option>
                        <option value="Corriente">Corriente</option>
                        <option value="Nequi">Nequi</option>
                      </select>
                    </div>
                    <p id="tipo-cuenta-hint" class="form-hint">Tipo de cuenta bancaria</p>
                    <div class="mensaje-error" id="errorTipoCuenta"></div>
                  </div>
                  <!-- Número de cuenta -->
                  <div class="form-field">
                    <label for="numeroCuenta" class="form-label">Número de cuenta</label>
                    <div class="password-wrapper">
                      <input type="text" id="numeroCuenta" name="numeroCuenta" placeholder="********" autocomplete="off"
                        class="form-control" aria-describedby="numero-cuenta-hint" maxlength="34" inputmode="numeric">
                      <button type="button" id="toggleAccountNumber" class="btn-icon"
                        aria-label="Mostrar/ocultar número de cuenta" aria-pressed="false">
                        <i class="fas fa-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <p id="numero-cuenta-hint" class="form-hint">Número de cuenta asociado a la cuenta
                    </p>
                    <div class="mensaje-error" id="errorNumeroCuenta"></div>
                  </div>
                </div>
              </div>
              <!-- Información del titular -->
              <div class="form-field-group">
                <h4 class="form-subtitle">Información del titular</h4>
                <div class="form-row cols-4">
                  <!-- Nombre del titular -->
                  <div class="form-field">
                    <label for="titular" class="form-label">Nombre completo</label>
                    <input type="text" id="titular" name="titular" placeholder="Nombre del titular" class="form-control"
                      aria-describedby="titular-hint">
                    <p id="titular-hint" class="form-hint">Nombre tal como aparece en la cuenta</p>
                  </div>
                  <!-- Tipo de documento -->
                  <div class="form-field">
                    <label for="tipo-documento" class="form-label">Tipo de documento</label>
                    <div class="select-wrapper">
                      <select id="tipo-documento" name="tipoDocumento" class="form-control">
                        <option value="">Selecciona</option>
                        <option value="CC">Cédula</option>
                        <option value="CE">Cédula de extranjería</option>
                        <option value="NIT">NIT</option>
                      </select>
                    </div>
                  </div>
                  <!-- Número de documento -->
                  <div class="form-field">
                    <label for="numero-documento" class="form-label">Número de documento</label>
                    <input type="text" id="numero-documento" name="numeroDocumento" placeholder="Ej: 3004888442"
                      class="form-control" aria-describedby="numero-documento-hint" inputmode="numeric" maxlength="11"
                      autocomplete="off">
                    <p id="numero-documento-hint" class="form-hint">Sin puntos ni espacios</p>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </section>

        <!-- Botón de envío -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Guardar y solicitar verificación
          </button>
        </div>

      </form>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="/assets/js/shared-validators.umd.js"></script>
  <script src="/assets/js/registroExperto.js"></script>
</body>

</html>
