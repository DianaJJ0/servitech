<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <% if (typeof status !=='undefined' && status==='success' ) { %>
      ¡Asesoría Confirmada! - ServiTech
      <% } else if (typeof status !=='undefined' && status==='pending' ) { %>
        Procesando Solicitud - ServiTech
        <% } else { %>
          Confirmación de Asesoría - ServiTech
          <% } %>
  </title>
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/componentes.css">
  <link rel="stylesheet" href="/assets/css/confirmacion-asesoria.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="description" content="Confirmación de tu asesoría técnica en ServiTech - Sistema de pagos simulados">
  <meta name="robots" content="noindex, nofollow">
</head>

<body>
  <%- include('componentes/header') %>
    <main class="main-content">
      <div class="container">
        <section class="confirmacion-container">
          <% if (status==='success' ) { %>
            <div class="confirmacion-card success">
              <div class="icon-container">
                <i class="fas fa-check-circle"></i>
              </div>
              <h1>¡Asesoría agendada exitosamente!</h1>
              <p class="mensaje-principal">
                Tu pago simulado ha sido procesado correctamente y la solicitud de asesoría ha sido enviada al
                experto.<br>
                El dinero simulado está retenido de forma segura hasta que se complete la asesoría.
              </p>
              <!-- FACTURA DEL PAGO Y ASESORÍA -->
              <div class="factura-container">
                <h3><i class="fas fa-file-invoice"></i> Factura de tu pago simulado</h3>
                <div class="factura-grid">
                  <div class="factura-section">
                    <h4>Datos del pago</h4>
                    <% if (typeof pago !=='undefined' && pago && pago.metadatos && pago.metadatos.datosPago) { %>
                      <ul>
                        <li><strong>Nombre:</strong>
                          <%= pago.metadatos.datosPago.nombre %>
                        </li>
                        <li><strong>Email:</strong>
                          <%= pago.metadatos.datosPago.email %>
                        </li>
                        <li><strong>Cédula/NIT:</strong>
                          <%= pago.metadatos.datosPago.cedula %>
                        </li>
                        <% if (pago.metadatos.datosPago.telefono) { %>
                          <li><strong>Teléfono:</strong>
                            <%= pago.metadatos.datosPago.telefono %>
                          </li>
                          <% } %>
                            <li><strong>Monto:</strong> $<%= pago.monto ? pago.monto.toLocaleString('es-CO') : 'N/A' %>
                                COP</li>
                            <li><strong>Fecha del pago:</strong>
                              <%= pago.fechaCreacion ? new Date(pago.fechaCreacion).toLocaleString('es-CO') : 'N/A' %>
                            </li>
                      </ul>
                      <% } else { %>
                        <p>No se encontraron datos del pago.</p>
                        <% } %>
                  </div>
                  <div class="factura-section">
                    <h4>Datos de la asesoría</h4>
                    <% if (typeof asesoria !=='undefined' && asesoria) { %>
                      <ul>
                        <li><strong>Título:</strong>
                          <%= asesoria.titulo %>
                        </li>
                        <li><strong>Descripción:</strong>
                          <%= asesoria.descripcion %>
                        </li>
                        <li><strong>Experto:</strong>
                          <%= asesoria.experto?.nombre %>
                            <%= asesoria.experto?.apellido %>
                        </li>
                        <li><strong>Fecha y hora:</strong>
                          <%= asesoria.fechaHoraInicio ? new Date(asesoria.fechaHoraInicio).toLocaleString('es-CO')
                            : "N/A" %>
                        </li>
                        <li><strong>Duración:</strong>
                          <%= asesoria.duracionMinutos %> minutos
                        </li>
                      </ul>
                      <% } else { %>
                        <p>No se encontraron datos de la asesoría.</p>
                        <% } %>
                  </div>
                </div>
              </div>
              <div class="pasos-siguientes">
                <h3><i class="fas fa-route"></i> ¿Qué sigue ahora?</h3>
                <div class="paso">
                  <div class="paso-numero">1</div>
                  <div class="paso-contenido">
                    <h4>Experto revisa tu solicitud</h4>
                    <p>El experto tiene hasta 24 horas para aceptar o rechazar tu solicitud de asesoría.</p>
                  </div>
                </div>
                <div class="paso">
                  <div class="paso-numero">2</div>
                  <div class="paso-contenido">
                    <h4>Recibe notificación inmediata</h4>
                    <p>Te enviaremos un correo electrónico tan pronto como el experto responda.</p>
                  </div>
                </div>
                <div class="paso">
                  <div class="paso-numero">3</div>
                  <div class="paso-contenido">
                    <h4>Coordina y realiza la asesoría</h4>
                    <p>Si es aceptada, recibirás los datos de contacto del experto para la videollamada.</p>
                  </div>
                </div>
              </div>
              <div class="info-pago-simulado">
                <div class="simulado-badge">
                  <i class="fas fa-flask"></i>
                  <strong>Pago Simulado</strong>
                </div>
                <p>Este es un sistema de demostración. No se procesó dinero real, pero la asesoría se creó normalmente.
                </p>
              </div>
              <div class="acciones">
                <a href="/misAsesorias.html" class="btn btn-primary">
                  <i class="fas fa-calendar-check"></i>
                  Ver mis asesorías
                </a>
                <a href="/expertos.html" class="btn btn-secondary">
                  <i class="fas fa-search"></i>
                  Buscar más expertos
                </a>
              </div>
            </div>
            <% } else if (status==='pending' ) { %>
              <!-- Estado pendiente -->
              <div class="confirmacion-card pending">
                <div class="icon-container">
                  <i class="fas fa-clock"></i>
                </div>
                <h1>Procesando tu solicitud</h1>
                <p class="mensaje-principal">
                  Tu solicitud de asesoría está siendo procesada. Si ves este mensaje por mucho tiempo, actualiza la
                  página.
                </p>
                <div class="loading-indicator">
                  <div class="spinner"></div>
                  <p>Finalizando proceso...</p>
                </div>
              </div>
              <% } else if (status==='failure' || status==='error' ) { %>
                <!-- Estado error -->
                <div class="confirmacion-card error">
                  <div class="icon-container">
                    <i class="fas fa-exclamation-triangle"></i>
                  </div>
                  <h1>No se pudo procesar tu solicitud</h1>
                  <p class="mensaje-principal">
                    Ocurrió un problema al procesar tu solicitud de asesoría.
                  </p>
                  <div class="acciones">
                    <a href="javascript:history.back()" class="btn btn-primary">
                      <i class="fas fa-redo"></i>
                      Intentar nuevamente
                    </a>
                    <a href="/contacto.html" class="btn btn-secondary">
                      <i class="fas fa-headset"></i>
                      Contactar soporte
                    </a>
                  </div>
                </div>
                <% } else { %>
                  <!-- Estado desconocido -->
                  <div class="confirmacion-card error">
                    <div class="icon-container">
                      <i class="fas fa-question-circle"></i>
                    </div>
                    <h1>Estado no reconocido</h1>
                    <p class="mensaje-principal">
                      Se recibió un estado no reconocido: "<%= status %>". Contacta a soporte si persiste.
                    </p>
                  </div>
                  <% } %>
        </section>
        <section class="info-adicional">
          <div class="info-grid">
            <article class="info-item">
              <i class="fas fa-shield-alt"></i>
              <h4>Sistema Seguro</h4>
              <p>Tus datos están protegidos con tecnología de encriptación.</p>
            </article>
            <article class="info-item">
              <i class="fas fa-undo-alt"></i>
              <h4>Proceso Transparente</h4>
              <p>Si el experto rechaza tu solicitud, recibirás un reembolso completo.</p>
            </article>
            <article class="info-item">
              <i class="fas fa-headset"></i>
              <h4>Soporte Especializado</h4>
              <p>Nuestro equipo de atención al cliente te acompaña en todo el proceso.</p>
            </article>
          </div>
        </section>
      </div>
    </main>
    <%- include('componentes/footer') %>

      <!-- Datos para JavaScript -->
      <script type="application/json" id="pageStatus"><%- JSON.stringify(status) %></script>
      <script type="application/json" id="pageData"><%- JSON.stringify({
  pagoId: typeof pagoId !== 'undefined' ? pagoId : null,
  asesoriaId: typeof asesoriaId !== 'undefined' ? asesoriaId : null,
  simulado: true,
  hasUser: !!(user)
}) %></script>
      <script type="application/json" id="facturaData"><%- JSON.stringify({
  pago: typeof pago !== 'undefined' ? pago : null,
  asesoria: typeof asesoria !== 'undefined' ? asesoria : null
}) %></script>
      <script src="/assets/js/common.js"></script>
      <script src="/assets/js/confirmacionAsesoria.js"></script>
      <div id="conexionEstado" class="conexion-estado offline" style="display: none;">
        <i class="fas fa-wifi-slash"></i> <span>Sin conexión</span>
      </div>
</body>

</html>
