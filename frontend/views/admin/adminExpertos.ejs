<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Expertos - Servitech Admin</title>
  <link rel="stylesheet" href="/assets/css/administrador.css" />
  <link rel="stylesheet" href="/assets/css/admin.css" />
  <link rel="stylesheet" href="/assets/css/admin-components.css" />
  <!-- page-specific CSS -->
  <link rel="stylesheet" href="/assets/css/admin-clientes.css" />
  <link rel="stylesheet" href="/assets/css/admin-responsive.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <!-- Navbar -->
  <div class="admin-layout">
    <%- include('../componentes/navbarAdmin.ejs') %>
      <main class="admin-main">
        <!-- Contenido principal -->
        <header class="admin-header">
          <div class="header-search">
            <i class="fas fa-search"></i>
            <input type="text" id="inputBuscarUsuario" placeholder="Buscar usuarios..." />
          </div>
          <div class="header-actions">
            <div class="notification-icon">
              <i class="fas fa-bell"></i>
              <span class="notification-badge">5</span>
            </div>
            <div class="admin-profile">
              <img src="https://i.pravatar.cc/150?img=11" alt="Admin profile" class="profile-img" />
              <div class="profile-info">
                <span class="profile-name">Admin ServiTech</span>
                <span class="profile-role">Administrador</span>
              </div>
              <i class="fas fa-chevron-down"></i>
            </div>
          </div>
        </header>

        <div class="admin-content">

          <!-- Título y acciones principales -->
          <div class="page-header">
            <h1>Gestión de Expertos</h1>
            <div class="page-actions">
              <button type="button" class="btn-primary" id="btnAddExpert">
                <i class="fas fa-plus"></i>
                <span>Nuevo experto</span>
              </button>
              <button class="btn-outline">
                <i class="fas fa-file-export"></i>
                <span>Exportar</span>
              </button>
            </div>
          </div>

          <!-- Modernized filtros, estadísticas, tabla y paginación -->
          <div class="clientes-grid">
            <!-- Filtros -->
            <div class="table-container clientes-grid__filters">

              <!-- Toggle para pantallas pequeñas / medias: sigue el mismo patrón que categorias -->
              <button class="categorias-filters-toggle clientes-filters-toggle" aria-expanded="true"
                aria-controls="expertosFiltersPanel">
                <i class="fas fa-filter"></i>
                <span class="categorias-filters-toggle__label">Filtros</span>
              </button>

              <div id="expertosFiltersPanel" class="clientes-filters-panel categorias-filters-panel">
                <div class="clientes-filtros">
                  <h3 class="clientes-filtros__title">Filtros</h3>
                  <div class="clientes-filtros__group">
                    <label class="clientes-filtros__label">Estado</label>
                    <select class="clientes-filtros__select" id="filtroEstadoUsuario">
                      <option value="">Todos los estados</option>
                      <option value="activo">Activos</option>
                      <option value="inactivo">Inactivos</option>
                      <option value="suspendido">Suspendidos</option>
                    </select>
                  </div>
                  <div class="clientes-filtros__group">
                    <label class="clientes-filtros__label">Fecha de registro</label>
                    <select class="clientes-filtros__select" id="filtroFechaRegistroUsuario">
                      <option value="">Todas las fechas</option>
                      <option value="today">Hoy</option>
                      <option value="week">Esta semana</option>
                      <option value="month">Este mes</option>
                      <option value="year">Este año</option>
                    </select>
                  </div>
                  <button class="btn-primary clientes-filtros__btn clientes-filtros__btn--center">
                    <i class="fas fa-filter"></i>
                    <span>Aplicar filtros</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Tabla de expertos -->
            <div class="table-container">
              <div class="clientes-list">
                <table class="admin-table admin-table--expertos">
                  <thead>
                    <tr class="expertos-col--actions">
                      <th>Expertos</th>
                      <th>Categorías</th>
                      <th>Registro</th>
                      <th>Sesiones</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>

                    <tr class="placeholder-row">
                      <td colspan="6" style="text-align:center;padding:24px;color:var(--admin-text-secondary);">
                        Cargando expertos...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Paginación (ubicada directamente bajo la tabla) -->
              <div class="admin-pagination" role="navigation" aria-label="Paginación de expertos" id="expertos-pagination-container">
                <span class="admin-pagination__info" id="expertos-pagination-info">Cargando...</span>
                <div class="admin-pagination__controles" id="expertos-pagination-controls"></div>
              </div>

            </div>

          </div>
        </div>

      </main>
  </div>

  <!--css para agregar expertos-->
  <style>
    /* ===== Variables globales proporcionadas ===== */
    :root {
      --admin-bg: #0e1525;
      --admin-card-bg: #1c2333;
      --admin-border-color: #2b3245;
      --admin-hover-bg: #252e43;
      --admin-accent-color: #3a8eff;
      --admin-accent-secondary: #12d8fa;
      --admin-text-primary: #f5f5f5;
      --admin-text-secondary: #a0a0a0;
      --admin-shadow: 0 4px 12px #00000040;
    }

    /* ===== Variables locales del modal ===== */
    :root {
      --ae-modal-max-width: 920px;
      --ae-modal-radius: 12px;
      --ae-modal-padding: 1rem 1.25rem;
      --ae-modal-z: 1200;
      --ae-backdrop: rgba(4, 8, 16, 0.62);
      --ae-transition: 160ms cubic-bezier(.2, .9, .2, 1);
    }

    /* ===== Reset y base ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      line-height: 1.5;
      background-color: var(--admin-bg);
      color: var(--admin-text-primary);
      padding: 1rem;
      min-height: 100vh;
    }

    /* ===== Estructura del modal ===== */
    .modal-expert {
      display: none;
      position: fixed;
      inset: 0;
      z-index: var(--ae-modal-z);
      background: var(--ae-backdrop);
      align-items: center;
      justify-content: center;
      padding: 1.25rem;
    }

    .modal-expert.is-open {
      display: flex;
      animation: ae-fade-in 220ms ease both;
    }

    @keyframes ae-fade-in {
      from {
        opacity: 0;
        transform: translateY(6px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-expert__container {
      width: 100%;
      max-width: var(--ae-modal-max-width);
      border-radius: var(--ae-modal-radius);
      overflow: hidden;
      box-shadow: var(--admin-shadow);
      border: 1px solid var(--admin-border-color);
      background: var(--admin-card-bg);
      color: var(--admin-text-primary);
      max-height: 95vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== Header del modal ===== */
    .modal-expert__header {
      padding: var(--ae-modal-padding);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--admin-border-color);
      background: var(--admin-card-bg);
    }

    .modal-expert__title {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--admin-text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-close {
      background: transparent;
      border: none;
      color: var(--admin-text-secondary);
      font-size: 1.1rem;
      padding: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all var(--ae-transition);
    }

    .btn-close:hover {
      background: var(--admin-hover-bg);
      color: var(--admin-text-primary);
    }

    /* ===== Cuerpo del modal ===== */
    .modal-expert__body {
      padding: var(--ae-modal-padding);
      overflow-y: auto;
      flex: 1;
    }

    .modal-expert__grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    /* ===== Grupos de formulario ===== */
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-section {
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--admin-border-color);
    }

    .form-section:last-of-type {
      border-bottom: none;
      margin-bottom: 0;
    }

    /* ===== Elementos de formulario ===== */
    .modal-expert__label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--admin-text-primary);
    }

    .modal-expert__icon {
      width: 16px;
      color: var(--admin-accent-color);
    }

    .modal-expert__input,
    .modal-expert__select,
    .modal-expert__textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--admin-border-color);
      border-radius: 8px;
      background: var(--admin-card-bg);
      color: var(--admin-text-primary);
      font-size: 0.95rem;
      transition: all var(--ae-transition);
    }

    .modal-expert__input:focus,
    .modal-expert__select:focus,
    .modal-expert__textarea:focus {
      outline: none;
      border-color: var(--admin-accent-color);
      box-shadow: 0 0 0 3px rgba(58, 142, 255, 0.1);
    }

    /* Visual para campos inválidos (aplicado por JS con la clase input-error o aria-invalid)
       Usado para el campo Nombre cuando queda vacío o contiene caracteres no permitidos */
    .input-error,
    input[aria-invalid="true"],
    textarea[aria-invalid="true"] {
      border-color: #e53e3e !important;
      box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.08) !important;
    }

    .modal-expert__textarea {
      min-height: 100px;
      resize: vertical;
    }

    .modal-expert__hint {
      font-size: 0.85rem;
      color: var(--admin-text-secondary);
    }

    /* ===== Componentes específicos ===== */

    /* Precio con símbolo de moneda */
    .price-input-wrapper {
      position: relative;
    }

    .price-symbol {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--admin-text-secondary);
    }

    .price-input {
      padding-left: 24px;
    }

    /* Selector de días */
    .days-selector {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .days-buttons {
      display: flex;
      gap: 0.35rem;
      flex-wrap: wrap;
    }

    .day-button {
      flex: 1;
      min-width: 40px;
      padding: 0.5rem;
      border: 1px solid var(--admin-border-color);
      background: var(--admin-card-bg);
      color: var(--admin-text-primary);
      border-radius: 6px;
      cursor: pointer;
      transition: all var(--ae-transition);
      text-align: center;
    }

    .day-button.active {
      background: var(--admin-accent-color);
      color: var(--admin-card-bg);
      border-color: var(--admin-accent-color);
    }

    .days-display {
      padding: 0.75rem;
      background: var(--admin-hover-bg);
      border-radius: 6px;
      font-size: 0.9rem;
      min-height: 44px;
      display: flex;
      align-items: center;
    }

    /* Select con iconos */
    .select-with-icons {
      position: relative;
    }

    .select-with-icons .icon-left {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--admin-text-secondary);
      pointer-events: none;
    }

    .select-with-icons .icon-right {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--admin-text-secondary);
      pointer-events: none;
      /* dejar que el click pase al select */
    }

    .select-with-icons select {
      padding-left: 36px;
      padding-right: 36px;
      /* ocultar la flecha nativa para evitar el doble indicador */
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background: transparent;
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    /* Asegurar que el select y sus opciones respeten el tema oscuro */
    .select-with-icons select {
      color: var(--admin-text-primary);
      background-color: transparent;
      /* el contenedor ya pinta el fondo */
      -webkit-text-fill-color: var(--admin-text-primary);
    }

    .select-with-icons select option {
      /* Muchos navegadores (Firefox/Chrome) respetan estos valores; en otros
         puede que dependa del sistema, pero normalmente mejora legibilidad */
      background-color: var(--admin-card-bg);
      color: var(--admin-text-primary);
    }

    /* Compatibilidad Windows/IE: ocultar flecha nativa extra */
    .select-with-icons select::-ms-expand {
      display: none;
    }

    /* Mejorar contraste dentro del desplegable: elementos hover/selected */
    .select-with-icons select option:hover,
    .select-with-icons select option:checked,
    .select-with-icons select option:active {
      background-color: rgba(20, 28, 40, 0.98);
      /* tono ligeramente más oscuro */
      color: var(--admin-text-primary);
    }

    /* Reforzar el color del área desplegada en WebKit/Chromium cuando está abierto */
    .select-with-icons select:focus,
    .select-with-icons select:active {
      background-color: var(--admin-card-bg);
      color: var(--admin-text-primary);
    }

    /* Custom select styles */
    .custom-select {
      position: relative;
      width: 100%;
      font-size: 0.95rem;
    }

    .custom-select__trigger {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--admin-border-color);
      background: var(--admin-card-bg);
      color: var(--admin-text-primary);
      cursor: pointer;
    }

    .custom-select__options {
      position: absolute;
      left: 0;
      right: 0;
      margin-top: 8px;
      list-style: none;
      padding: 0.25rem;
      border-radius: 8px;
      border: 1px solid var(--admin-border-color);
      background: linear-gradient(180deg, var(--admin-card-bg), var(--admin-hover-bg));
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 2000;
      max-height: 220px;
      overflow: auto;
    }

    .custom-select__options li {
      padding: 0.6rem 0.75rem;
      cursor: pointer;
      color: var(--admin-text-primary);
      border-radius: 6px;
    }

    .custom-select__options li[aria-selected="true"],
    .custom-select__options li:hover {
      background: rgba(58, 142, 255, 0.08);
      color: var(--admin-text-primary);
    }

    .custom-select.open .custom-select__options {
      display: block;
    }

    /* Upload de imagen */
    .upload-wrapper {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .upload-box {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border: 1px dashed var(--admin-border-color);
      border-radius: 8px;
      color: var(--admin-text-secondary);
      background: var(--admin-card-bg);
      cursor: pointer;
      transition: all var(--ae-transition);
      position: relative;
      /* permite posicionar el input absoluto dentro del label */
    }

    .upload-box:hover {
      border-color: var(--admin-accent-color);
      color: var(--admin-text-primary);
    }

    .file-input {
      /* No usar display:none: el input debe estar presente para que el label lo dispare.
         Lo mantenemos invisible pero interactivo llenando la caja del label. */
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      opacity: 0;
      cursor: pointer;
      z-index: 2;
    }

    .preview-container {
      position: relative;
      display: none;
    }

    .preview-image {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid var(--admin-border-color);
    }

    .remove-preview {
      position: absolute;
      top: -6px;
      right: -6px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: none;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
    }

    /* Sección de datos bancarios */
    .bank-section {
      padding: 1.5rem;
      border-radius: 10px;
      border: 1px solid var(--admin-border-color);
      background: var(--admin-hover-bg);
    }

    .bank-title {
      margin: 0 0 0.5rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--admin-text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .bank-subtitle {
      margin: 0 0 1.5rem 0;
      color: var(--admin-text-secondary);
      font-size: 0.9rem;
    }

    .bank-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    /* Campo de número de cuenta con toggle */
    .account-input-wrapper {
      display: flex;
    }

    .account-input {
      flex: 1;
      border-radius: 8px 0 0 8px;
      border-right: none;
    }

    .toggle-password {
      flex: 0 0 44px;
      border: 1px solid var(--admin-border-color);
      border-left: none;
      border-radius: 0 8px 8px 0;
      background: var(--admin-card-bg);
      color: var(--admin-text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Campos de teléfono */
    .phone-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    /* Caja de información */
    .info-box {
      padding: 1rem;
      border-radius: 8px;
      background: rgba(58, 142, 255, 0.05);
      border: 1px solid rgba(58, 142, 255, 0.1);
    }

    .info-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      color: var(--admin-accent-color);
      font-weight: 600;
    }

    .info-list {
      margin: 0;
      padding-left: 0;
      list-style: none;
    }

    .info-list li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      color: var(--admin-text-secondary);
      font-size: 0.9rem;
    }

    .info-list li i {
      color: var(--admin-accent-color);
    }

    /* ===== Footer del modal ===== */
    .modal-expert__footer {
      padding: 1rem 1.25rem;
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      border-top: 1px solid var(--admin-border-color);
      background: var(--admin-card-bg);
    }

    .btn {
      padding: 0.6rem 1.25rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all var(--ae-transition);
      border: none;
    }

    .btn-outline {
      background: transparent;
      color: var(--admin-text-primary);
      border: 1px solid var(--admin-border-color);
    }

    .btn-outline:hover {
      background: var(--admin-hover-bg);
    }

    .btn-primary {
      background: var(--admin-accent-color);
      color: white;
    }

    .btn-primary:hover {
      background: #2d7de8;
      transform: translateY(-1px);
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .modal-expert__grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .bank-grid {
        grid-template-columns: 1fr;
      }

      .phone-fields {
        grid-template-columns: 1fr;
      }

      .upload-wrapper {
        flex-direction: column;
        align-items: flex-start;
      }

      .modal-expert__footer {
        flex-direction: column-reverse;
      }

      .btn {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .modal-expert {
        padding: 0.5rem;
      }

      .modal-expert__body {
        padding: 1rem;
      }

      .bank-section {
        padding: 1rem;
      }

      .days-buttons {
        gap: 0.25rem;
      }

      .day-button {
        min-width: 36px;
        padding: 0.4rem;
      }
    }
  </style>

  <!-- Script: toggle filtros expertos -->
  <script src="/assets/js/admin/admin-expertos-filters.js"></script>
  <script src="/assets/js/admin/admin-expertos-accessibility.js"></script>

  <!-- Modal para agregar nuevo experto -->
  <div id="expertModal" class="modal-expert">
    <div class="modal-expert__container">

      <div class="modal-expert__header">
        <h2 class="modal-expert__title">
          <i class="fas fa-user-plus"></i> Agregar nuevo experto
        </h2>
        <button class="btn-close" aria-label="Cerrar modal">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-expert__body">
        <form id="expertForm">
          <div class="modal-expert__grid">

            <!-- Información básica -->
            <div class="form-group">
              <label class="modal-expert__label" for="name">
                <i class="fas fa-user modal-expert__icon"></i>
                Nombre completo
              </label>
              <input type="text" id="name" class="modal-expert__input" placeholder="Nombre y apellidos registrados" />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label class="modal-expert__label" for="email">
                <i class="fas fa-envelope modal-expert__icon"></i>
                Email registrado
              </label>
              <input type="email" id="email" class="modal-expert__input" placeholder="Email de la cuenta" />
            </div>

            <!-- Precio por hora -->
            <div class="form-group">
              <label class="modal-expert__label" for="precio">
                <i class="fas fa-money-bill-wave modal-expert__icon"></i>
                Precio por hora (COP)
                <span class="price-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP">
                  <i class="fas fa-info-circle"></i>
                </span>
              </label>
              <div class="price-input-wrapper">
                <span class="price-symbol">$</span>
                <input type="number" id="precio" class="modal-expert__input price-input" min="10000" step="100" required
                  placeholder="Ej: 50000" />
              </div>
              <p class="modal-expert__hint">Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)</p>
            </div>

            <!-- Días disponibles -->
            <div class="form-group">
              <label class="modal-expert__label">
                <i class="fas fa-calendar-alt modal-expert__icon"></i>
                Días disponibles
              </label>
              <div class="days-selector">
                <div class="days-buttons">
                  <button type="button" class="day-button" data-day="lunes">L</button>
                  <button type="button" class="day-button" data-day="martes">M</button>
                  <button type="button" class="day-button" data-day="miercoles">X</button>
                  <button type="button" class="day-button" data-day="jueves">J</button>
                  <button type="button" class="day-button" data-day="viernes">V</button>
                  <button type="button" class="day-button" data-day="sabado">S</button>
                  <button type="button" class="day-button" data-day="domingo">D</button>
                </div>
                <div class="days-display">Ningún día seleccionado</div>
              </div>
              <input type="hidden" id="diasDisponibles" name="diasDisponibles" />
            </div>

            <!-- Estado (custom select para control visual y accesibilidad) -->
            <div class="form-group">
              <label class="modal-expert__label" for="statusInput">
                <i class="fas fa-toggle-on modal-expert__icon"></i>
                Estado
              </label>
              <div class="select-with-icons">
                <!-- control custom: mantiene compatibilidad con el formulario mediante un input hidden -->
                <div class="custom-select" data-name="status" role="combobox" aria-haspopup="listbox"
                  aria-expanded="false" tabindex="0">
                  <input type="hidden" id="statusInput" name="status" value="active">
                  <div class="custom-select__trigger" aria-labelledby="statusLabel">
                    <span class="custom-select__value" id="statusLabel">Activo</span>
                    <i class="fas fa-chevron-down icon-right" aria-hidden="true"></i>
                  </div>
                  <ul class="custom-select__options" role="listbox">
                    <li role="option" data-value="active" aria-selected="true">Activo</li>
                    <li role="option" data-value="pending" aria-selected="false">Pendiente</li>
                    <li role="option" data-value="inactive" aria-selected="false">Inactivo</li>
                  </ul>
                </div>
              </div>
              <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
            </div>

            <!-- Imagen de perfil -->
            <div class="form-group">
              <label class="modal-expert__label">
                <i class="fas fa-image modal-expert__icon"></i>
                Imagen de perfil
              </label>
              <div class="upload-wrapper">
                <label class="upload-box">
                  <!-- id/name para que el JS central pueda referenciarlo y el formulario lo envíe -->
                  <input type="file" id="profileImage" name="profileImage" class="file-input"
                    accept="image/png, image/jpeg" data-max-size="2097152" aria-label="Seleccionar imagen de perfil" />
                  <i class="fas fa-upload" aria-hidden="true"></i>
                  <span>Seleccionar imagen (png, jpg) · Máx 2MB</span>
                </label>
                <div class="preview-container" id="profilePreviewContainer" aria-hidden="false" style="display:block">
                  <button type="button" class="remove-preview" aria-label="Eliminar imagen" style="display:none">
                    <i class="fas fa-times" aria-hidden="true"></i>
                  </button>
                  <!-- Colocamos un avatar por defecto; el JS puede reemplazarlo al seleccionar -->
                  <img class="preview-image" id="profilePreviewImage" src="https://i.pravatar.cc/64"
                    alt="Vista previa" />
                </div>
              </div>
            </div>

            <!-- Categorías -->
            <div class="form-group full-width">
              <label class="modal-expert__label" for="categorias-input">
                <i class="fas fa-tags modal-expert__icon"></i>
                Categorías *
              </label>

              <!-- Input de búsqueda -->
              <div class="categorias-search-wrapper">
                <input type="text" id="categorias-input" class="modal-expert__input" placeholder="Buscar categorías..."
                  autocomplete="off">
                <i class="fas fa-search categorias-search-icon"></i>
              </div>

              <!-- Chips de categorías seleccionadas -->
              <div class="categorias-chips" id="categorias-chips">
                <span class="categorias-empty">No hay categorías seleccionadas</span>
              </div>

              <!-- Lista de opciones -->
              <div class="categorias-options" id="categorias-options">
                <!-- Opciones se cargan dinámicamente -->
              </div>

              <!-- Campo hidden para el formulario -->
              <input type="hidden" id="categorias-values" name="categorias">

              <small class="modal-expert__hint">Selecciona las categorías del experto (mínimo 1)</small>
            </div>

            <!-- Estilos específicos para el selector de categorías -->
            <style>
              /* Estilos para el selector de categorías */
              .categorias-search-wrapper {
                position: relative;
                margin-bottom: 0.75rem;
              }

              .categorias-search-icon {
                position: absolute;
                right: 12px;
                top: 50%;
                transform: translateY(-50%);
                color: var(--admin-text-secondary);
              }

              .categorias-chips {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                min-height: 44px;
                padding: 0.75rem;
                background: var(--admin-hover-bg);
                border-radius: 8px;
                margin-bottom: 0.75rem;
                align-items: center;
              }

              .categoria-chip {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.4rem 0.75rem;
                background: var(--admin-accent-color);
                color: white;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 500;
              }

              .categoria-chip-remove {
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                padding: 0;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
              }

              .categoria-chip-remove:hover {
                background: rgba(255, 255, 255, 0.2);
              }

              .categorias-empty {
                color: var(--admin-text-secondary);
                font-style: italic;
              }

              .categorias-options {
                max-height: 200px;
                overflow-y: auto;
                border: 1px solid var(--admin-border-color);
                border-radius: 8px;
                background: var(--admin-card-bg);
              }

              .categoria-option {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.75rem 1rem;
                cursor: pointer;
                transition: background-color 0.2s;
                border-bottom: 1px solid var(--admin-border-color);
              }

              .categoria-option:last-child {
                border-bottom: none;
              }

              .categoria-option:hover {
                background: var(--admin-hover-bg);
              }

              .categoria-option.selected {
                background: rgba(58, 142, 255, 0.1);
                color: var(--admin-accent-color);
              }

              .categoria-option-checkbox {
                width: 18px;
                height: 18px;
                border: 2px solid var(--admin-border-color);
                border-radius: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
              }

              .categoria-option.selected .categoria-option-checkbox {
                background: var(--admin-accent-color);
                border-color: var(--admin-accent-color);
              }

              .categoria-option.selected .categoria-option-checkbox::after {
                content: "✓";
                color: white;
                font-size: 12px;
                font-weight: bold;
              }

              /* Estados de validación */
              .categorias-chips.error {
                border: 1px solid #e53e3e;
                background: rgba(229, 62, 62, 0.05);
              }

              .categorias-error {
                color: #e53e3e;
                font-size: 0.85rem;
                margin-top: 0.5rem;
                display: none;
              }
            </style>

            <!-- Biografía -->
            <div class="form-group full-width">
              <label class="modal-expert__label" for="bio">
                <i class="fas fa-file-alt modal-expert__icon"></i>
                Biografía profesional
              </label>
              <textarea id="bio" class="modal-expert__input modal-expert__textarea" rows="4"
                placeholder="Descripción breve de experiencia y especialización"></textarea>
            </div>

            <!-- Datos bancarios -->
            <div class="form-group full-width">
              <div class="bank-section">
                <h3 class="bank-title">
                  <i class="fas fa-university"></i> Datos Bancarios para Pagos
                </h3>
                <p class="bank-subtitle">Información necesaria para recibir pagos por tus asesorías</p>

                <div class="bank-grid">
                  <div class="form-group">
                    <label class="modal-expert__label" for="banco">
                      <i class="fas fa-university modal-expert__icon"></i>
                      Banco *
                    </label>
                    <select id="banco" class="modal-expert__input" required>
                      <option value="">Selecciona tu banco</option>
                      <option value="Bancolombia">Bancolombia</option>
                      <option value="Banco de Bogotá">Banco de Bogotá</option>
                      <!-- Más opciones -->
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="modal-expert__label" for="tipoCuenta">
                      <i class="fas fa-credit-card modal-expert__icon"></i>
                      Tipo de cuenta *
                    </label>
                    <select id="tipoCuenta" class="modal-expert__input" required>
                      <option value="">Selecciona el tipo</option>
                      <option value="ahorros">Cuenta de Ahorros</option>
                      <option value="corriente">Cuenta Corriente</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="modal-expert__label" for="numeroCuenta">
                      <i class="fas fa-hashtag modal-expert__icon"></i>
                      Número de cuenta *
                    </label>
                    <div class="account-input-wrapper">
                      <input type="password" id="numeroCuenta" class="modal-expert__input account-input" required
                        placeholder="Número de cuenta" />
                      <button type="button" class="toggle-password" aria-label="Mostrar número de cuenta">
                        <i class="fas fa-eye"></i>
                      </button>
                    </div>
                    <small class="modal-expert__hint">Número completo de tu cuenta</small>
                  </div>

                  <div class="form-group">
                    <label class="modal-expert__label" for="titular">
                      <i class="fas fa-user-tie modal-expert__icon"></i>
                      Titular de la cuenta *
                    </label>
                    <input type="text" id="titular" class="modal-expert__input" required
                      placeholder="Nombre completo del titular" />
                    <small class="modal-expert__hint">Debe coincidir con el nombre en la cuenta</small>
                  </div>

                  <div class="form-group">
                    <label class="modal-expert__label" for="tipoDocumento">
                      <i class="fas fa-id-card modal-expert__icon"></i>
                      Tipo de documento *
                    </label>
                    <select id="tipoDocumento" class="modal-expert__input" required>
                      <option value="">Selecciona el tipo</option>
                      <option value="cedula">Cédula de Ciudadanía</option>
                      <option value="extranjeria">Cédula de Extranjería</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="modal-expert__label" for="numeroDocumento">
                      <i class="fas fa-fingerprint modal-expert__icon"></i>
                      Número de documento *
                    </label>
                    <input type="text" id="numeroDocumento" class="modal-expert__input" required
                      placeholder="Número de identificación" />
                    <small class="modal-expert__hint">Documento del titular</small>
                  </div>

                  <div class="form-group full-width">
                    <label class="modal-expert__label">
                      <i class="fas fa-phone modal-expert__icon"></i>
                      Teléfono de contacto
                    </label>
                    <div class="phone-fields">
                      <input type="tel" class="modal-expert__input" placeholder="+57 300 123 4567" />
                      <input type="tel" class="modal-expert__input" placeholder="Confirmar número" />
                    </div>
                    <small class="modal-expert__hint">Opcional: Teléfono para contacto sobre pagos</small>
                  </div>
                </div>

                <div class="info-box">
                  <div class="info-header">
                    <i class="fas fa-info-circle"></i>
                    <strong>Información importante sobre pagos</strong>
                  </div>
                  <ul class="info-list">
                    <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                    <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                    <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                    <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </form>
      </div>

      <div class="modal-expert__footer">
        <button class="btn btn-outline" type="button">Cancelar</button>
        <button class="btn btn-primary" type="submit">Guardar experto</button>
      </div>
    </div>
  </div>

  <!-- Modal para editar nuevo experto -->
  <div id="editExpertModal" class="modal-expert">
    <div class="modal-expert__container">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Agregar nuevo experto</h2>
        <button class="btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-expert__body">
        <form id="expertForm_edit">
          <div class="modal-expert__grid">
            <!-- Información básica -->
            <div>
              <label class="modal-expert__label" for="name">
                <i class="fas fa-user modal-expert__icon" aria-hidden="true"></i>
                Nombre completo
              </label>
              <input type="text" id="name_edit" placeholder="Nombre y apellidos registrados"
                class="modal-expert__input" />
            </div>

            <div>
              <label class="modal-expert__label" for="email">
                <i class="fas fa-envelope modal-expert__icon" aria-hidden="true"></i>
                Email registrado
              </label>
              <input type="email" id="email_edit" placeholder="Email de la cuenta" class="modal-expert__input" />
            </div>

            <!-- Precio por hora -->
            <div>
              <label for="precio" class="modal-expert__label">
                <i class="fas fa-money-bill-wave modal-expert__icon" aria-hidden="true" title="Precio"></i>
                Precio por hora (COP)
                <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP"
                  style="margin-left:.5rem;">
                  <i class="fas fa-info-circle"></i>
                </span>
              </label>

              <div class="srv-price-input price-input">
                <span class="srv-currency currency-symbol">$</span>
                <input type="number" id="precio_edit" name="precio" min="10000" step="100" required
                  placeholder="Ej: 50000" class="srv-input price-field" />
              </div>
              <p class="srv-note price-note">
                Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)
                </small>
              <div id="precio-feedback" class="srv-feedback price-feedback" aria-live="polite"></div>
            </div>

            <!-- Días disponibles -->
            <div>
              <label for="diasDisponibles" class="modal-expert__label">
                <i class="fas fa-calendar-alt modal-expert__icon" aria-hidden="true"></i>
                Días disponibles
              </label>

              <div class="srv-days-wrapper">
                <div class="srv-days">
                  <button type="button" class="srv-day" data-day="Lunes" aria-pressed="false">L</button>
                  <button type="button" class="srv-day" data-day="Martes" aria-pressed="false">M</button>
                  <button type="button" class="srv-day" data-day="Miércoles" aria-pressed="false">X</button>
                  <button type="button" class="srv-day" data-day="Jueves" aria-pressed="false">J</button>
                  <button type="button" class="srv-day" data-day="Viernes" aria-pressed="false">V</button>
                  <button type="button" class="srv-day" data-day="Sábado" aria-pressed="false">S</button>
                  <button type="button" class="srv-day" data-day="Domingo" aria-pressed="false">D</button>
                </div>

                <div class="srv-days-display">
                  Ningún día seleccionado
                </div>
              </div>

              <input type="hidden" id="diasDisponibles_edit" name="diasDisponibles" />
            </div>

            <!-- Estado -->
            <div>
              <label class="modal-expert__label" for="status">
                <i class="fas fa-toggle-on modal-expert__icon" aria-hidden="true"></i>
                Estado
              </label>
              <div class="input-with-icon">
                <i class="fas fa-toggle-on" aria-hidden="true"></i>
                <select id="status" class="modal-expert__input modal-expert__select" aria-label="Estado del experto">
                  <option value="active">Activo</option>
                  <option value="pending">Pendiente</option>
                  <option value="inactive">Inactivo</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
            </div>

            <!-- Categorías -->
            <div class="full-width">
              <label class="modal-expert__label" for="categorias">
                <i class="fas fa-tags modal-expert__icon" aria-hidden="true"></i>
                Categorías
              </label>
              <select id="categorias_edit" class="modal-expert__input modal-expert__select-categorias" multiple size="4"
                aria-label="Categorías">
                <!-- opciones añadidas dinámicamente desde categorias-data -->
              </select>

              <!-- Choices visual fixes moved to admin-expertos.js -->
              <small class="modal-expert__hint">Selecciona una o varias categorías (Ctrl/Cmd+click)</small>
            </div>

            <!-- Biografía -->
            <div class="full-width">
              <label class="modal-expert__label" for="bio">
                <i class="fas fa-file-alt modal-expert__icon" aria-hidden="true"></i>
                Biografía profesional
              </label>
              <textarea id="bio_edit" rows="4" placeholder="Descripción breve de experiencia y especialización"
                class="modal-expert__input modal-expert__textarea"></textarea>
            </div>

            <!-- Imagen de perfil -->
            <div>
              <label class="modal-expert__label" for="profileImage">
                <i class="fas fa-image modal-expert__icon" aria-hidden="true"></i>
                Imagen de perfil
              </label>

              <div class="modal-expert__upload-wrapper">
                <label for="profileImage_edit" class="modal-expert__upload-box" role="button" aria-haspopup="dialog">
                  <input type="file" id="profileImage_edit" class="modal-expert__file-input"
                    aria-label="Seleccionar imagen de perfil" accept="image/*" />
                  <i class="fas fa-upload" aria-hidden="true"></i>
                  <span id="uploadLabel_edit">Seleccionar imagen (png, jpg) · Máx 2MB</span>
                </label>

                <div id="profilePreview_edit" aria-hidden="true" role="img" aria-label="Vista previa de imagen">
                  <button id="removeProfileBtn_edit" type="button" title="Eliminar imagen" aria-label="Eliminar imagen"
                    style="display:none;">
                    <i class="fas fa-times"></i>
                  </button>
                  <img src="" alt="Preview" />
                </div>

                <div class="upload-meta" id="uploadMeta_edit" aria-live="polite" style="display:none;"></div>
                <div class="upload-error" id="profileImageError_edit" role="alert" style="display:none;"></div>
              </div>
            </div>

            <!-- Datos bancarios - Sección completa -->
            <div class="full-width">
              <div class="bank-section">
                <h3 class="bank-title">
                  <i class="fas fa-university"></i> Datos Bancarios para Pagos
                </h3>
                <p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

                <div class="bank-grid">
                  <div>
                    <label class="modal-expert__label" for="banco">
                      <i class="fas fa-university modal-expert__icon" aria-hidden="true"></i>
                      Banco *
                    </label>
                    <select id="banco_edit" name="banco" required class="modal-expert__input">
                      <option value="">Selecciona tu banco</option>
                      <option value="Banco de Bogotá">Banco de Bogotá</option>
                      <option value="Bancolombia">Bancolombia</option>
                      <option value="Banco Popular">Banco Popular</option>
                      <option value="Banco AV Villas">Banco AV Villas</option>
                      <option value="Banco Caja Social">Banco Caja Social</option>
                      <option value="Banco de Occidente">Banco de Occidente</option>
                      <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
                      <option value="Banco Itaú">Banco Itaú</option>
                      <option value="Banco Pichincha">Banco Pichincha</option>
                      <option value="Banco Santander">Banco Santander</option>
                      <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
                      <option value="Davivienda">Davivienda</option>
                      <option value="Banco Agrario">Banco Agrario</option>
                      <option value="Banco Falabella">Banco Falabella</option>
                      <option value="Banco Finandina">Banco Finandina</option>
                      <option value="Banco W">Banco W</option>
                      <option value="Banco Serfinanza">Banco Serfinanza</option>
                      <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
                      <option value="Banco BBVA">Banco BBVA</option>
                      <option value="Nequi">Nequi</option>
                      <option value="Daviplata">Daviplata</option>
                      <option value="Movii">Movii</option>
                      <option value="Banco de Vivienda">Banco de Vivienda</option>
                      <option value="Banco ProCredit">Banco ProCredit</option>
                      <option value="Banco Multibank">Banco Multibank</option>
                      <option value="Banco Coopcentral">Banco Coopcentral</option>
                      <option value="Banco Credifinanciera">Banco Credifinanciera</option>
                      <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
                      <option value="Banco Ripley">Banco Ripley</option>
                      <option value="Banco CrediScotia">Banco CrediScotia</option>
                    </select>
                  </div>

                  <div>
                    <label class="modal-expert__label" for="tipoCuenta">
                      <i class="fas fa-credit-card modal-expert__icon" aria-hidden="true"></i>
                      Tipo de cuenta *
                    </label>
                    <select id="tipoCuenta_edit" name="tipoCuenta" required class="modal-expert__input">
                      <option value="">Selecciona el tipo</option>
                      <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
                      <option value="Cuenta Corriente">Cuenta Corriente</option>
                      <option value="Cuenta de Nómina">Cuenta de Nómina</option>
                      <option value="Cuenta Digital">Cuenta Digital</option>
                    </select>
                  </div>

                  <div>
                    <label class="modal-expert__label" for="numeroCuenta">
                      <i class="fas fa-hashtag modal-expert__icon" aria-hidden="true"></i>
                      Número de cuenta *
                    </label>
                    <div class="acct-wrap">
                      <input type="password" id="numeroCuenta_edit" name="numeroCuenta" required
                        placeholder="Número de cuenta" pattern="[0-9\-]*" title="Solo números y guiones"
                        class="acct-input">
                      <button type="button" id="toggleAccountNumber" class="acct-toggle"
                        aria-label="Mostrar número de cuenta">
                        <i class="fas fa-eye"></i>
                      </button>
                      <small class="modal-expert__hint">Número completo de tu cuenta</small>
                    </div>

                    <div>
                      <label class="modal-expert__label" for="titular">
                        <i class="fas fa-user-tie modal-expert__icon" aria-hidden="true"></i>
                        Titular de la cuenta *
                      </label>
                      <input type="text" id="titular_edit" name="titular" required
                        placeholder="Nombre completo del titular" class="modal-expert__input">
                      <small class="modal-expert__hint">Debe coincidir con el nombre en la cuenta</small>
                    </div>

                    <div>
                      <label class="modal-expert__label" for="tipoDocumento">
                        <i class="fas fa-id-card modal-expert__icon" aria-hidden="true"></i>
                        Tipo de documento *
                      </label>
                      <select id="tipoDocumento_edit" name="tipoDocumento" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                        <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                        <option value="NIT">NIT (Persona Jurídica)</option>
                      </select>
                    </div>

                    <div>
                      <label class="modal-expert__label" for="numeroDocumento">
                        <i class="fas fa-fingerprint modal-expert__icon" aria-hidden="true"></i>
                        Número de documento *
                      </label>
                      <input type="text" id="numeroDocumento_edit" name="numeroDocumento" required
                        placeholder="Número de identificación" pattern="[0-9\-]*" class="modal-expert__input">
                      <small class="modal-expert__hint">Documento del titular</small>
                    </div>

                    <div class="full-width">
                      <label class="modal-expert__label" for="telefonoContacto">
                        <i class="fas fa-phone modal-expert__icon" aria-hidden="true"></i>
                        Teléfono de contacto
                      </label>
                      <input type="tel" id="telefonoContacto_edit" name="telefonoContacto"
                        placeholder="+57 300 123 4567" class="modal-expert__input">
                      <small class="modal-expert__hint">Opcional: Teléfono para contacto sobre pagos</small>
                    </div>
                  </div>

                  <div class="info-box info-sm">
                    <div class="info-header">
                      <i class="fas fa-info-circle"></i>
                      <strong>Información importante sobre pagos</strong>
                    </div>
                    <ul class="info-list">
                      <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                      <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                      <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                      <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
        </form>
      </div>

      <div class="modal-expert__footer">
        <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
        <button type="button" class="btn-primary" id="saveExpert_edit">Guardar experto</button>
      </div>
    </div>
  </div>

  <!-- Modal para ver perfil de experto (solo lectura) -->
  <div id="verPerfilExperto" class="modal-expert">
    <div class="modal-expert__container">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Agregar nuevo experto</h2>
        <button class="btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-expert__body">
        <form id="expertForm_view">
          <div class="modal-expert__grid">
            <!-- Información básica -->
            <div>
              <label class="modal-expert__label" for="name">
                <i class="fas fa-user modal-expert__icon" aria-hidden="true"></i>
                Nombre completo
              </label>
              <input type="text" id="name_view" placeholder="Nombre y apellidos registrados"
                class="modal-expert__input" />
            </div>

            <div>
              <label class="modal-expert__label" for="email">
                <i class="fas fa-envelope modal-expert__icon" aria-hidden="true"></i>
                Email registrado
              </label>
              <input type="email" id="email_view" placeholder="Email de la cuenta" class="modal-expert__input" />
            </div>

            <!-- Precio por hora -->
            <div>
              <label for="precio" class="modal-expert__label">
                <i class="fas fa-money-bill-wave modal-expert__icon" aria-hidden="true" title="Precio"></i>
                Precio por hora (COP)
                <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP"
                  style="margin-left:.5rem;">
                  <i class="fas fa-info-circle"></i>
                </span>
              </label>

              <div class="srv-price-input price-input">
                <span class="srv-currency currency-symbol">$</span>
                <input type="number" id="precio_view" name="precio" min="10000" step="100" required
                  placeholder="Ej: 50000" class="srv-input price-field" />
              </div>
              <p class="srv-note price-note">
                Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)
                </small>
              <div id="precio-feedback" class="srv-feedback price-feedback" aria-live="polite"></div>
            </div>

            <!-- Días disponibles -->
            <div>
              <label for="diasDisponibles" class="modal-expert__label">
                <i class="fas fa-calendar-alt modal-expert__icon" aria-hidden="true"></i>
                Días disponibles
              </label>

              <div class="srv-days-wrapper">
                <div class="srv-days">
                  <button type="button" class="srv-day" data-day="Lunes" aria-pressed="false">L</button>
                  <button type="button" class="srv-day" data-day="Martes" aria-pressed="false">M</button>
                  <button type="button" class="srv-day" data-day="Miércoles" aria-pressed="false">X</button>
                  <button type="button" class="srv-day" data-day="Jueves" aria-pressed="false">J</button>
                  <button type="button" class="srv-day" data-day="Viernes" aria-pressed="false">V</button>
                  <button type="button" class="srv-day" data-day="Sábado" aria-pressed="false">S</button>
                  <button type="button" class="srv-day" data-day="Domingo" aria-pressed="false">D</button>
                </div>

                <div class="srv-days-display">
                  Ningún día seleccionado
                </div>
              </div>

              <input type="hidden" id="diasDisponibles_view" name="diasDisponibles" />
            </div>

            <!-- Estado -->
            <div>
              <label class="modal-expert__label" for="status">
                <i class="fas fa-toggle-on modal-expert__icon" aria-hidden="true"></i>
                Estado
              </label>
              <div class="input-with-icon">
                <i class="fas fa-toggle-on" aria-hidden="true"></i>
                <select id="status" class="modal-expert__input modal-expert__select" aria-label="Estado del experto">
                  <option value="active">Activo</option>
                  <option value="pending">Pendiente</option>
                  <option value="inactive">Inactivo</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
            </div>

            <!-- Categorías -->
            <div class="full-width">
              <label class="modal-expert__label" for="categorias">
                <i class="fas fa-tags modal-expert__icon" aria-hidden="true"></i>
                Categorías
              </label>
              <select id="categorias_view" class="modal-expert__input modal-expert__select-categorias" multiple size="4"
                aria-label="Categorías">
                <!-- opciones añadidas dinámicamente desde categorias-data -->
              </select>

              <!-- Choices visual fixes moved to /assets/js/admin/admin-expertos.js -->
              <small class="modal-expert__hint">Selecciona una o varias categorías (Ctrl/Cmd+click)</small>
            </div>

            <!-- Biografía -->
            <div class="full-width">
              <label class="modal-expert__label" for="bio">
                <i class="fas fa-file-alt modal-expert__icon" aria-hidden="true"></i>
                Biografía profesional
              </label>
              <textarea id="bio_view" rows="4" placeholder="Descripción breve de experiencia y especialización"
                class="modal-expert__input modal-expert__textarea"></textarea>
            </div>

            <!-- Imagen de perfil -->
            <div>
              <label class="modal-expert__label" for="profileImage">
                <i class="fas fa-image modal-expert__icon" aria-hidden="true"></i>
                Imagen de perfil
              </label>

              <div class="modal-expert__upload-wrapper">
                <label for="profileImage_view" class="modal-expert__upload-box" role="button" aria-haspopup="dialog">
                  <input type="file" id="profileImage_view" class="modal-expert__file-input"
                    aria-label="Seleccionar imagen de perfil" accept="image/*" />
                  <i class="fas fa-upload" aria-hidden="true"></i>
                  <span id="uploadLabel_view">Seleccionar imagen (png, jpg) · Máx 2MB</span>
                </label>

                <div id="profilePreview_view" aria-hidden="true" role="img" aria-label="Vista previa de imagen">
                  <button id="removeProfileBtn_view" type="button" title="Eliminar imagen" aria-label="Eliminar imagen"
                    style="display:none;">
                    <i class="fas fa-times"></i>
                  </button>
                  <img src="" alt="Preview" />
                </div>

                <div class="upload-meta" id="uploadMeta_view" aria-live="polite" style="display:none;"></div>
                <div class="upload-error" id="profileImageError_view" role="alert" style="display:none;"></div>
              </div>
            </div>

            <!-- Datos bancarios - Sección completa -->
            <div class="full-width">
              <div class="bank-section">
                <h3 class="bank-title">
                  <i class="fas fa-university"></i> Datos Bancarios para Pagos
                </h3>
                <p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

                <div class="bank-grid">
                  <div>
                    <label class="modal-expert__label" for="banco">
                      <i class="fas fa-university modal-expert__icon" aria-hidden="true"></i>
                      Banco *
                    </label>
                    <select id="banco_view" name="banco" required class="modal-expert__input">
                      <option value="">Selecciona tu banco</option>
                      <option value="Banco de Bogotá">Banco de Bogotá</option>
                      <option value="Bancolombia">Bancolombia</option>
                      <option value="Banco Popular">Banco Popular</option>
                      <option value="Banco AV Villas">Banco AV Villas</option>
                      <option value="Banco Caja Social">Banco Caja Social</option>
                      <option value="Banco de Occidente">Banco de Occidente</option>
                      <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
                      <option value="Banco Itaú">Banco Itaú</option>
                      <option value="Banco Pichincha">Banco Pichincha</option>
                      <option value="Banco Santander">Banco Santander</option>
                      <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
                      <option value="Davivienda">Davivienda</option>
                      <option value="Banco Agrario">Banco Agrario</option>
                      <option value="Banco Falabella">Banco Falabella</option>
                      <option value="Banco Finandina">Banco Finandina</option>
                      <option value="Banco W">Banco W</option>
                      <option value="Banco Serfinanza">Banco Serfinanza</option>
                      <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
                      <option value="Banco BBVA">Banco BBVA</option>
                      <option value="Nequi">Nequi</option>
                      <option value="Daviplata">Daviplata</option>
                      <option value="Movii">Movii</option>
                      <option value="Banco de Vivienda">Banco de Vivienda</option>
                      <option value="Banco ProCredit">Banco ProCredit</option>
                      <option value="Banco Multibank">Banco Multibank</option>
                      <option value="Banco Coopcentral">Banco Coopcentral</option>
                      <option value="Banco Credifinanciera">Banco Credifinanciera</option>
                      <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
                      <option value="Banco Ripley">Banco Ripley</option>
                      <option value="Banco CrediScotia">Banco CrediScotia</option>
                    </select>
                  </div>

                  <div>
                    <label class="modal-expert__label" for="tipoCuenta">
                      <i class="fas fa-credit-card modal-expert__icon" aria-hidden="true"></i>
                      Tipo de cuenta *
                    </label>
                    <select id="tipoCuenta_view" name="tipoCuenta" required class="modal-expert__input">
                      <option value="">Selecciona el tipo</option>
                      <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
                      <option value="Cuenta Corriente">Cuenta Corriente</option>
                      <option value="Cuenta de Nómina">Cuenta de Nómina</option>
                      <option value="Cuenta Digital">Cuenta Digital</option>
                    </select>
                  </div>

                  <div>
                    <label class="modal-expert__label" for="numeroCuenta">
                      <i class="fas fa-hashtag modal-expert__icon" aria-hidden="true"></i>
                      Número de cuenta *
                    </label>
                    <div class="acct-wrap">
                      <input type="password" id="numeroCuenta_view" name="numeroCuenta" required
                        placeholder="Número de cuenta" pattern="[0-9\-]*" title="Solo números y guiones"
                        class="acct-input">
                      <button type="button" id="toggleAccountNumber" class="acct-toggle"
                        aria-label="Mostrar número de cuenta">
                        <i class="fas fa-eye"></i>
                      </button>
                      <small class="modal-expert__hint">Número completo de tu cuenta</small>
                    </div>

                    <div>
                      <label class="modal-expert__label" for="titular">
                        <i class="fas fa-user-tie modal-expert__icon" aria-hidden="true"></i>
                        Titular de la cuenta *
                      </label>
                      <input type="text" id="titular_view" name="titular" required
                        placeholder="Nombre completo del titular" class="modal-expert__input">
                      <small class="modal-expert__hint">Debe coincidir con el nombre en la cuenta</small>
                    </div>

                    <div>
                      <label class="modal-expert__label" for="tipoDocumento">
                        <i class="fas fa-id-card modal-expert__icon" aria-hidden="true"></i>
                        Tipo de documento *
                      </label>
                      <select id="tipoDocumento_view" name="tipoDocumento" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                        <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                        <option value="NIT">NIT (Persona Jurídica)</option>
                      </select>
                    </div>

                    <div>
                      <label class="modal-expert__label" for="numeroDocumento">
                        <i class="fas fa-fingerprint modal-expert__icon" aria-hidden="true"></i>
                        Número de documento *
                      </label>
                      <input type="text" id="numeroDocumento_view" name="numeroDocumento" required
                        placeholder="Número de identificación" pattern="[0-9\-]*" class="modal-expert__input">
                      <small class="modal-expert__hint">Documento del titular</small>
                    </div>

                    <div class="full-width">
                      <label class="modal-expert__label" for="telefonoContacto">
                        <i class="fas fa-phone modal-expert__icon" aria-hidden="true"></i>
                        Teléfono de contacto
                      </label>
                      <input type="tel" id="telefonoContacto_view" name="telefonoContacto"
                        placeholder="+57 300 123 4567" class="modal-expert__input">
                      <small class="modal-expert__hint">Opcional: Teléfono para contacto sobre pagos</small>
                    </div>
                  </div>

                  <div class="info-box info-sm">
                    <div class="info-header">
                      <i class="fas fa-info-circle"></i>
                      <strong>Información importante sobre pagos</strong>
                    </div>
                    <ul class="info-list">
                      <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                      <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                      <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                      <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
        </form>
      </div>

      <div class="modal-expert__footer">
        <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
        <button type="button" class="btn-primary" id="saveExpert_view">Guardar experto</button>
      </div>
    </div>
  </div>

  <!-- Modal para inactivar experto -->
  <div id="modalInactivarExperto" class="modal-expert">
    <div class="modal-expert__content">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Inactivar experto</h2>
        <button class="btn-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-expert__body">
        <p id="modalInactivarExpertoNombre" class="modal-expert__nombre-destacado"></small>
        <p>
          ¿Está seguro que desea inactivar este usuario?<br />
          <span class="modal-expert__texto-secundario">
            El usuario <b>no se eliminará</b> de la base de datos, solo pasará
            a estado <b>inactivo</b>.
          </span>
          </small>
      </div>
      <div class="modal-expert__footer">
        <button type="button" class="btn-outline modal-inactivar-cancelar">
          Cancelar
        </button>
        <button type="button" class="btn-primary modal-inactivar-confirmar">
          Inactivar
        </button>
      </div>
    </div>
  </div>

  <script>
    // Early mitigation for autofill/placeholder issues inside the view expert modal.
    (function () {
      try {
        var m = document.getElementById('verPerfilExperto');
        if (!m) return;
        var email = m.querySelector && m.querySelector('#email');
        if (!email) return;
        try {
          email.value = '';
          email.setAttribute('autocomplete', 'off');
          email.setAttribute('autocorrect', 'off');
          email.setAttribute('autocapitalize', 'off');
          email.setAttribute('spellcheck', 'false');
          email.readOnly = true;
          var sec = getComputedStyle(document.documentElement).getPropertyValue('--admin-text-secondary') || '#8892a6';
          try { email.style.setProperty('color', sec, 'important'); } catch (e) { }
          try { email.style.setProperty('-webkit-text-fill-color', sec, 'important'); } catch (e) { }
          setTimeout(function () { try { email.readOnly = false; } catch (e) { } }, 80);
        } catch (e) { }
      } catch (e) { }
    })();
  </script>

  <script id="initial-expertos" type="application/json"><%- JSON.stringify(initialExpertos || []) %></script>
  <script id="categorias-data" type="application/json"><%- JSON.stringify(categorias || []) %></script>

  <script src="/assets/js/admin/admin-common.js"></script>
  <script src="/assets/js/admin/admin-expertos.js"></script>
  <script src="/assets/js/admin/admin-expertos.bootstrap.js"></script>

</body>

</html>
