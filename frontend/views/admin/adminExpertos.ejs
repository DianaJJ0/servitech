<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Expertos - Servitech Admin</title>
  <link rel="stylesheet" href="/assets/css/administrador.css" />
  <link rel="stylesheet" href="/assets/css/admin.css" />
  <link rel="stylesheet" href="/assets/css/admin-responsive.css" />
  <link rel="stylesheet" href="/assets/css/admin-components.css" />
  <!-- page-specific CSS -->
  <link rel="stylesheet" href="/assets/css/Admin-expertos.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <div class="admin-layout">
    <%- include('../componentes/navbarAdmin.ejs') %>

      <script id="initial-expertos" type="application/json"><%= JSON.stringify(initialExpertos || []) %></script>

      <main class="admin-main">
        <!-- Contenido principal -->
        <header class="admin-header">
          <div class="admin-content-wrapper">
            <div class="header-search">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Buscar expertos..." />
            </div>
            <div class="header-actions">
              <div class="notification-icon">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">5</span>
              </div>
              <div class="admin-profile">
                <img src="https://i.pravatar.cc/150?img=11" alt="Admin profile" class="profile-img" />
                <div class="profile-info">
                  <span class="profile-name">Admin ServiTech</span>
                  <span class="profile-role">Administrador</span>
                </div>
                <i class="fas fa-chevron-down"></i>
              </div>
            </div>
          </div>
        </header>

        <div class="admin-content">

          <!-- Título y acciones principales. -->
          <div class="page-header">
            <h1>Gestión de Expertos</h1>
            <div class="page-actions">
              <button type="button" class="btn-primary" id="btnAddExpert">
                <i class="fas fa-plus"></i>
                <span>Nuevo experto</span>
              </button>
              <button class="btn-outline">
                <i class="fas fa-file-export"></i>
                <span>Exportar</span>
              </button>
            </div>
          </div>

          <!-- Modernized filtros, estadísticas, tabla y paginación -->

          <style>
            /* Expertos grid / filtros / tabla
               Variables forced by user: use only those colors */
            .expertos-grid {
              display: grid;
              grid-template-columns: 300px 1fr;
              gap: 1.25rem;
              align-items: start;
              width: 100%;
              box-sizing: border-box;
              margin-top: 1rem;
            }

            /* Card base used by both aside and section */
            .expertos-card {
              background: var(--admin-card-bg);
              border: 1px solid var(--admin-border-color);
              color: var(--admin-text-primary);
              border-radius: 10px;
              box-shadow: var(--admin-shadow);
              padding: 1rem;
              box-sizing: border-box;
            }

            /* Filters sidebar */
            .expertos-grid__filters {
              padding: 1rem;
              min-width: 220px;
              display: flex;
              flex-direction: column;
              gap: 1rem;
            }

            /* Filters header and group layout */
            .expertos-filtros__title {
              margin: 0 0 .25rem 0;
              font-size: 1.05rem;
              font-weight: 600;
              color: var(--admin-text-primary);
            }

            .expertos-filtros__group {
              display: flex;
              flex-direction: column;
              gap: .375rem;
            }

            .expertos-filtros__label {
              font-size: .85rem;
              color: var(--admin-text-secondary);
              display: block;
            }

            .expertos-filtros__select {
              background: transparent;
              color: var(--admin-text-primary);
              border: 1px solid var(--admin-border-color);
              padding: .5rem .625rem;
              border-radius: 6px;
              outline: none;
              transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
              -webkit-appearance: none;
              appearance: none;
            }

            /* Focus and hover states */
            .expertos-filtros__select:focus,
            .expertos-filtros__select:hover {
              border-color: var(--admin-accent-color);
              box-shadow: 0 0 0 3px rgba(58, 142, 255, 0.08);
            }

            /* Apply button inside filters */
            .expertos-filtros__btn {
              margin-top: .25rem;
              display: inline-flex;
              gap: .5rem;
              align-items: center;
              justify-content: center;
              width: 100%;
              padding: .6rem .75rem;
              border-radius: 8px;
              border: none;
              background: linear-gradient(180deg, var(--admin-accent-color), var(--admin-accent-color));
              color: #fff;
              cursor: pointer;
              font-weight: 600;
              transition: transform .06s ease, box-shadow .12s ease, filter .08s ease;
            }

            .expertos-filtros__btn:active {
              transform: translateY(1px);
            }

            .expertos-filtros__btn:focus {
              box-shadow: 0 0 0 4px rgba(58, 142, 255, 0.12);
              outline: none;
            }

            /* Reset (Limpiar filtros) - tailored styles */
            .btn-outline.expertos-filtros__reset {
              display: inline-flex;
              gap: .5rem;
              align-items: center;
              justify-content: center;
              width: 100%;
              padding: .55rem .75rem;
              border-radius: 8px;
              border: 1px solid var(--admin-border-color);
              background: transparent;
              color: var(--admin-text-secondary);
              font-weight: 600;
              cursor: pointer;
              transition: background .12s ease, color .12s ease, transform .06s ease, border-color .12s ease;
              margin-top: .5rem;
            }

            .btn-outline.expertos-filtros__reset i {
              color: var(--admin-text-secondary);
              font-size: 0.95rem;
            }

            .btn-outline.expertos-filtros__reset:hover {
              background: rgba(255, 255, 255, 0.02);
              color: var(--admin-text-primary);
              border-color: rgba(255, 255, 255, 0.04);
              transform: translateY(-1px);
            }

            .btn-outline.expertos-filtros__reset:active {
              transform: translateY(0);
            }

            .btn-outline.expertos-filtros__reset:focus {
              outline: none;
              box-shadow: 0 0 0 4px rgba(18, 216, 250, 0.10);
            }

            .btn-outline.expertos-filtros__reset[disabled],
            .btn-outline.expertos-filtros__reset[aria-disabled="true"] {
              opacity: .45;
              cursor: default;
            }

            /* Estadísticas block */
            .expertos-estadisticas__title {
              margin: 0 0 .5rem 0;
              font-size: 1rem;
              font-weight: 600;
              color: var(--admin-text-primary);
            }

            .expertos-estadisticas__list {
              display: grid;
              grid-template-columns: 1fr;
              gap: .65rem;
            }

            .expertos-estadisticas__item {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: .5rem;
              border-radius: 8px;
              background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
              border: 1px solid rgba(255, 255, 255, 0.02);
            }

            .expertos-estadisticas__item-info {
              display: flex;
              gap: .6rem;
              align-items: center;
              color: var(--admin-text-secondary);
              font-size: .92rem;
            }

            .expertos-estadisticas__icon {
              color: var(--admin-accent-secondary);
              font-size: 1.05rem;
              width: 26px;
              height: 26px;
              display: inline-flex;
              align-items: center;
              justify-content: center;
            }

            /* Tabla principal */
            .expertos-grid__tabla {
              padding: 0;
              overflow: hidden;
              min-width: 0;
              /* allow truncation inside flex/grid */
            }

            /* Responsive wrapper: allows horizontal scroll on narrow sizes */
            .expertos-grid__tabla .table-wrap {
              width: 100%;
              overflow-x: auto;
              -webkit-overflow-scrolling: touch;
            }

            .admin-table {
              width: 100%;
              border-collapse: collapse;
              color: var(--admin-text-primary);
              font-size: .95rem;
              min-width: 720px;
              /* baseline so desktop shows full columns */
            }

            /* Table head */
            .admin-table thead th {
              text-align: left;
              padding: .9rem .75rem;
              font-size: .85rem;
              color: var(--admin-text-secondary);
              border-bottom: 1px solid var(--admin-border-color);
              background: transparent;
              vertical-align: middle;
              white-space: nowrap;
            }

            /* Table body rows */
            .admin-table tbody tr {
              border-bottom: 1px solid rgba(255, 255, 255, 0.02);
              transition: background .12s ease;
            }

            .admin-table tbody tr:hover {
              background: var(--admin-hover-bg);
            }

            /* Cells */
            .admin-table td {
              padding: .75rem;
              vertical-align: middle;
              color: var(--admin-text-primary);
              font-size: .95rem;
              white-space: nowrap;
            }

            /* Small states & badges inside table cells */
            .admin-table .badge {
              display: inline-flex;
              align-items: center;
              gap: .4rem;
              padding: .2rem .5rem;
              font-size: .8rem;
              border-radius: 999px;
              background: rgba(255, 255, 255, 0.02);
              color: var(--admin-text-secondary);
            }

            /* Checkbox */
            .expertos-checkbox {
              width: 16px;
              height: 16px;
              accent-color: var(--admin-accent-color);
            }

            /* Placeholder row */
            .placeholder-row td {
              background: transparent;
              color: var(--admin-text-secondary);
            }

            /* Acciones cell layout */
            .admin-table td .actions {
              display: flex;
              gap: .5rem;
              align-items: center;
              justify-content: flex-end;
            }

            /* Buttons used in actions, keep lightweight overrides */
            .expertos-action-btn {
              background: transparent;
              border: 1px solid transparent;
              color: var(--admin-text-secondary);
              padding: .45rem .55rem;
              border-radius: 6px;
              display: inline-flex;
              align-items: center;
              gap: .45rem;
              cursor: pointer;
              transition: background .12s ease, color .12s ease, transform .06s ease;
            }

            .expertos-action-btn:hover {
              background: rgba(255, 255, 255, 0.02);
              color: var(--admin-text-primary);
            }

            .expertos-action-btn:focus {
              outline: none;
              box-shadow: 0 0 0 4px rgba(18, 216, 250, 0.12);
            }

            /* Pagination */
            .expertos-paginacion {
              margin-top: .75rem;
              padding: .75rem;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: .75rem;
              flex-wrap: wrap;
            }

            .expertos-paginacion__info {
              color: var(--admin-text-secondary);
              font-size: .88rem;
            }

            .expertos-paginacion__controles {
              display: inline-flex;
              gap: .35rem;
              align-items: center;
            }

            .expertos-paginacion__btn {
              background: transparent;
              border: 1px solid transparent;
              color: var(--admin-text-secondary);
              padding: .45rem .65rem;
              border-radius: 6px;
              cursor: pointer;
            }

            .expertos-paginacion__btn:hover {
              background: rgba(255, 255, 255, 0.02);
              color: var(--admin-text-primary);
            }

            .expertos-paginacion__btn--active {
              background: linear-gradient(180deg, var(--admin-accent-color), var(--admin-accent-color));
              color: white;
              border-color: transparent;
            }

            .expertos-paginacion__btn--disabled,
            .expertos-paginacion__btn[aria-disabled="true"] {
              opacity: .45;
              cursor: default;
            }

            /* Responsive: stack filters above table on small screens */
            @media (max-width: 900px) {
              .expertos-grid {
                grid-template-columns: 1fr;
              }

              .expertos-grid__filters {
                order: 0;
                min-width: 0;
              }

              .expertos-grid__tabla {
                order: 1;
              }

              .expertos-estadisticas__list {
                grid-template-columns: repeat(2, 1fr);
              }

              /* allow horizontal scroll on medium/narrow screens */
              .admin-table {
                min-width: 640px;
              }
            }

            /* Mobile-first card transformation for very small screens */
            @media (max-width: 640px) {

              /* wrap table to disable difficult horizontal scroll inside grid */
              .admin-table {
                border: none;
                min-width: 0;
                font-size: 0.95rem;
              }

              .admin-table thead {
                display: none;
              }

              /* turn each row into a card */
              .admin-table,
              .admin-table tbody,
              .admin-table tr,
              .admin-table td {
                display: block;
                width: 100%;
              }

              .admin-table tr {
                margin: 0 0 0.75rem 0;
                padding: 0.8rem;
                border-radius: 8px;
                background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
                border: 1px solid var(--admin-border-color);
                box-shadow: none;
              }

              .admin-table td {
                padding: .35rem 0;
                border: none;
                color: var(--admin-text-primary);
                display: flex;
                justify-content: space-between;
                align-items: center;
              }

              /* Add label before each cell using nth-child mapping (keeps HTML unchanged) */
              .admin-table td:nth-child(1):before {
                content: "Sel";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
              }

              .admin-table td:nth-child(2):before {
                content: "Experto";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(3):before {
                content: "Categorías";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(4):before {
                content: "Especialidad";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(5):before {
                content: "Registro";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(6):before {
                content: "Sesiones";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(7):before {
                content: "Calificación";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(8):before {
                content: "Estado";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              .admin-table td:nth-child(9):before {
                content: "Acciones";
                color: var(--admin-text-secondary);
                font-weight: 600;
                margin-right: .6rem;
                width: 28%;
                text-align: left;
              }

              /* visually separate label from value */
              .admin-table td:before {
                display: inline-block;
                font-size: .82rem;
                color: var(--admin-text-secondary);
                flex: 0 0 40%;
                white-space: nowrap;
              }

              .admin-table td>* {
                flex: 1 1 auto;
                text-align: right;
              }

              /* make action buttons wrap nicely on small cards */
              .admin-table td .actions {
                justify-content: flex-end;
                gap: .5rem;
                flex-wrap: wrap;
              }

              /* hide some non-critical columns on tiniest screens to improve readability */
              @media (max-width: 420px) {
                .admin-table td:nth-child(4),
                /* especialidad */
                .admin-table td:nth-child(6)

                /* sesiones */
                  {
                  display: none;
                }
              }
            }

            /* Accessibility: high-contrast focus fallback */
            :focus {
              outline-offset: 2px;
            }

            /* Small niceties */
            .expertos-grid .fas {
              color: var(--admin-text-secondary);
            }

            /* Ensure table cells don't overflow on narrow screens */
            .admin-table td,
            .admin-table th {
              word-break: break-word;
            }

            /* Limits to avoid overly wide sidebar on very large screens */
            @media (min-width: 1600px) {
              .expertos-grid {
                grid-template-columns: 320px 1fr;
              }
            }
          </style>

          <div class="expertos-grid">
            <aside class="expertos-card expertos-grid__filters" aria-label="Filtros y estadísticas">
              <div class="expertos-filtros">
                <h3 class="expertos-filtros__title">Filtros</h3>

                <div class="expertos-filtros__group">
                  <label class="expertos-filtros__label" for="filterEstado">Estado</label>
                  <select class="expertos-filtros__select" id="filterEstado">
                    <option value="">Todos los estados</option>
                    <option value="active">Activos</option>
                    <option value="pending">Pendientes</option>
                    <option value="inactive">Inactivos</option>
                  </select>
                </div>

                <div class="expertos-filtros__group">
                  <label class="expertos-filtros__label" for="filterCategoria">Categoría</label>
                  <select class="expertos-filtros__select" id="filterCategoria">
                    <option value="">Todas las categorías</option>
                    <% if (typeof categorias !=='undefined' && Array.isArray(categorias)) { %>
                      <% categorias.forEach(function(c){ %>
                        <option value="<%= c._id %>">
                          <%= c.nombre || c.name %>
                        </option>
                        <% }) %>
                          <% } %>
                  </select>
                </div>

                <div class="expertos-filtros__group">
                  <label class="expertos-filtros__label" for="filterRating">Calificación mínima</label>
                  <select class="expertos-filtros__select" id="filterRating">
                    <option value="">Todas las calificaciones</option>
                    <option value="5">5 estrellas</option>
                    <option value="4">4+ estrellas</option>
                    <option value="3">3+ estrellas</option>
                    <option value="2">2+ estrellas</option>
                  </select>
                </div>

                <button class="btn-primary expertos-filtros__btn" id="applyFiltersBtn">
                  <i class="fas fa-filter" aria-hidden="true"></i>
                  <span>Aplicar filtros</span>
                </button>

                <!-- Reset button: Limpiar filtros -->
                <button type="button" class="btn-outline expertos-filtros__reset" id="resetFiltersBtn"
                  aria-label="Limpiar filtros">
                  <i class="fas fa-eraser" aria-hidden="true"></i>
                  <span>Limpiar filtros</span>
                </button>
              </div>

              <div class="expertos-estadisticas" style="margin-top:1rem;">
                <h3 class="expertos-estadisticas__title">Estadísticas</h3>
                <div class="expertos-estadisticas__list">
                  <div class="expertos-estadisticas__item">
                    <div class="expertos-estadisticas__item-info">
                      <i class="fas fa-user-tie expertos-estadisticas__icon" aria-hidden="true"></i>
                      <span>Total Expertos</span>
                    </div>
                    <span class="expertos-estadisticas__value">128</span>
                  </div>

                  <div class="expertos-estadisticas__item">
                    <div class="expertos-estadisticas__item-info">
                      <i class="fas fa-check-circle expertos-estadisticas__icon" aria-hidden="true"></i>
                      <span>Activos</span>
                    </div>
                    <span class="expertos-estadisticas__value">98</span>
                  </div>

                  <div class="expertos-estadisticas__item">
                    <div class="expertos-estadisticas__item-info">
                      <i class="fas fa-clock expertos-estadisticas__icon" aria-hidden="true"></i>
                      <span>Pendientes</span>
                    </div>
                    <span class="expertos-estadisticas__value">22</span>
                  </div>

                  <div class="expertos-estadisticas__item">
                    <div class="expertos-estadisticas__item-info">
                      <i class="fas fa-star expertos-estadisticas__icon" aria-hidden="true"></i>
                      <span>Promedio</span>
                    </div>
                    <span class="expertos-estadisticas__value">4.7</span>
                  </div>
                </div>
              </div>
            </aside>

            <section class="expertos-card expertos-grid__tabla" aria-label="Tabla de expertos">
              <div class="table-wrap">
                <table class="admin-table" role="table" aria-label="Lista de expertos">
                  <thead>
                    <tr>
                      <th style="width:40px;">
                        <input type="checkbox" id="selectAll" class="expertos-checkbox" />
                      </th>
                      <th>Experto</th>
                      <th>Categorías</th>
                      <th>Especialidad</th>
                      <th>Registro</th>
                      <th>Sesiones</th>
                      <th>Calificación</th>
                      <th>Estado</th>
                      <th style="width:160px;">Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="placeholder-row">
                      <td colspan="9" style="text-align:center;padding:24px;color:var(--admin-text-secondary);">
                        Cargando expertos...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Paginación (ubicada directamente bajo la tabla para asociación semántica y visual) -->
              <div class="expertos-paginacion" role="navigation" aria-label="Paginación de expertos">
                <span class="expertos-paginacion__info">Mostrando 1-7 de 128 expertos</span>
                <div class="expertos-paginacion__controles" aria-hidden="false">
                  <button class="expertos-paginacion__btn expertos-paginacion__btn--disabled" aria-disabled="true">
                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                  </button>
                  <button class="expertos-paginacion__btn expertos-paginacion__btn--active"
                    aria-current="page">1</button>
                  <button class="expertos-paginacion__btn">2</button>
                  <button class="expertos-paginacion__btn">3</button>
                  <span class="expertos-paginacion__ellipsis">…</span>
                  <button class="expertos-paginacion__btn">18</button>
                  <button class="expertos-paginacion__btn">
                    <i class="fas fa-chevron-right" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </section>

          </div>

        </div>

  </div>
  </main>
  </div>

  <!-- Modal para agregar experto -->
<<<<<<< HEAD
  <div id="expertModal" class="modal-expert">
=======
  <style>
    /* Modal overlay & container (apply to any .modal-expert instance) */
    .modal-expert {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(2, 6, 23, 0.6);
      z-index: 1200;
      -webkit-overflow-scrolling: touch;
    }
>>>>>>> f6d3d6a87628fb1eff6cb39bf29d70fa0a856857

    /* Container: column flex so footer stays visible */
    .modal-expert .modal-expert__container {
      width: 100%;
      max-width: 980px;
      max-height: calc(100vh - 48px);
      box-sizing: border-box;
      background: var(--admin-card-bg);
      border: 1px solid var(--admin-border-color);
      border-radius: 12px;
      box-shadow: var(--admin-shadow);
      color: var(--admin-text-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Header */
    .modal-expert .modal-expert__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.125rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.02);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
    }

    .modal-expert .modal-expert__title {
      margin: 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--admin-text-primary);
    }

    .modal-expert .btn-close {
      background: transparent;
      border: 1px solid transparent;
      color: var(--admin-text-secondary);
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      transition: background .12s ease, color .12s ease;
    }

    .modal-expert .btn-close:hover {
      background: rgba(255, 255, 255, 0.02);
      color: var(--admin-text-primary);
    }

    /* Body (scrollable) */
    .modal-expert .modal-expert__body {
      padding: 1rem;
      overflow: auto;
      flex: 1 1 auto;
    }

    /* Form grid */
    .modal-expert .modal-expert__grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1rem;
      align-items: start;
      width: 100%;
      box-sizing: border-box;
    }

    .modal-expert .modal-expert__grid .full-width {
      grid-column: 1 / -1;
    }

    /* Labels and inputs */
    .modal-expert .modal-expert__label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: var(--admin-text-secondary);
      margin-bottom: 0.375rem;
    }

    .modal-expert .modal-expert__icon {
      color: var(--admin-accent-secondary);
    }

    .modal-expert .modal-expert__input,
    .modal-expert .modal-expert__select,
    .modal-expert select,
    .modal-expert input[type="text"],
    .modal-expert input[type="email"],
    .modal-expert input[type="tel"],
    .modal-expert textarea,
    .modal-expert .acct-input {
      width: 100%;
      box-sizing: border-box;
      background: transparent;
      color: var(--admin-text-primary);
      border: 1px solid var(--admin-border-color);
      padding: 0.5rem 0.625rem;
      border-radius: 8px;
      font-size: 0.95rem;
      outline: none;
      transition: box-shadow .12s ease, border-color .12s ease;
    }

    .modal-expert .modal-expert__input:focus,
    .modal-expert select:focus,
    .modal-expert textarea:focus {
      border-color: var(--admin-accent-color);
      box-shadow: 0 0 0 4px rgba(58, 142, 255, 0.06);
    }

    .modal-expert .modal-expert__textarea {
      min-height: 96px;
      resize: vertical;
    }

    /* Price input */
    .modal-expert .srv-price-input,
    .modal-expert .price-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem;
      border-radius: 8px;
      border: 1px solid var(--admin-border-color);
      background: rgba(255, 255, 255, 0.01);
    }

    .modal-expert .srv-currency,
    .modal-expert .currency-symbol {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      color: var(--admin-text-primary);
      font-weight: 700;
      font-size: 0.95rem;
    }

    .modal-expert input.price-field {
      border: none;
      background: transparent;
      color: var(--admin-text-primary);
      padding: 0.5rem 0;
    }

    .modal-expert .srv-note,
    .modal-expert .hint,
    .modal-expert .modal-expert__hint {
      margin: 0.35rem 0 0 0;
      font-size: 0.82rem;
      color: var(--admin-text-secondary);
    }

    /* Days selector */
    .modal-expert .srv-days-wrapper {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-direction: column;
    }

    .modal-expert .srv-days {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      margin-top: 0.4rem;
    }

    .modal-expert .srv-day {
      background: transparent;
      border: 1px solid var(--admin-border-color);
      color: var(--admin-text-secondary);
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background .12s ease, color .12s ease, transform .06s ease;
    }

    .modal-expert .srv-day:hover {
      background: rgba(58, 142, 255, 0.06);
      color: var(--admin-text-primary);
      transform: translateY(-1px);
    }

    .modal-expert .srv-day.selected,
    .modal-expert .srv-day[aria-pressed="true"] {
      background: linear-gradient(180deg, var(--admin-accent-color), var(--admin-accent-color));
      color: #fff;
      border-color: transparent;
    }

    .modal-expert .srv-days-display {
      font-size: 0.9rem;
      color: var(--admin-text-secondary);
    }

    /* Upload area */
    .modal-expert .modal-expert__upload-wrapper {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      flex-direction: row;
      flex-wrap: wrap;
    }

    .modal-expert .modal-expert__file-input {
      display: none;
    }

    .modal-expert .modal-expert__upload-box {
      display: inline-flex;
      gap: 0.65rem;
      align-items: center;
      padding: 0.6rem 0.8rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.01);
      border: 1px dashed var(--admin-border-color);
      color: var(--admin-text-secondary);
      cursor: pointer;
      font-size: 0.95rem;
    }

    .modal-expert .modal-expert__upload-box:hover {
      background: rgba(255, 255, 255, 0.02);
      color: var(--admin-text-primary);
    }

    .modal-expert #profilePreview {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 72px;
      min-height: 48px;
      max-height: 72px;
      overflow: hidden;
      border-radius: 8px;
    }

    .modal-expert #profilePreview img {
      display: block;
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 6px;
    }

    .modal-expert #removeProfileBtn {
      display: none;
      background: rgba(0, 0, 0, 0.4);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.25rem;
      cursor: pointer;
    }

    /* Account number toggle */
    .modal-expert .acct-wrap {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-expert .acct-toggle {
      background: transparent;
      border: 1px solid var(--admin-border-color);
      color: var(--admin-text-secondary);
      padding: 0.45rem 0.6rem;
      border-radius: 8px;
      cursor: pointer;
    }

    .modal-expert .acct-toggle:hover {
      background: rgba(255, 255, 255, 0.02);
      color: var(--admin-text-primary);
    }

    /* Bank section */
    .modal-expert .bank-section {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .modal-expert .bank-title {
      margin: 0 0 0.35rem 0;
      font-size: 1rem;
      color: var(--admin-text-primary);
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .modal-expert .bank-sub {
      margin: 0 0 0.6rem 0;
      color: var(--admin-text-secondary);
      font-size: 0.88rem;
    }

    .modal-expert .bank-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
    }

    .modal-expert .bank-grid .full-width {
      grid-column: 1 / -1;
    }

    /* Info box small */
    .modal-expert .info-box.info-sm {
      margin-top: 0.65rem;
      background: rgba(255, 255, 255, 0.01);
      border: 1px solid rgba(255, 255, 255, 0.02);
      padding: 0.6rem;
      border-radius: 8px;
      color: var(--admin-text-secondary);
    }

    .modal-expert .info-header {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.35rem;
      color: var(--admin-text-primary);
      font-weight: 600;
    }

    .modal-expert .info-list {
      margin: 0;
      padding: 0 0 0 1rem;
      display: block;
      color: var(--admin-text-secondary);
      font-size: 0.9rem;
    }

    /* Footer (keeps visible) */
    .modal-expert .modal-expert__footer {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      justify-content: flex-end;
      padding: 0.75rem 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.02);
      background: linear-gradient(0deg, rgba(255, 255, 255, 0.01), transparent);
    }

    /* Buttons (lightweight overrides to match theme) */
    .modal-expert .btn-primary {
      background: linear-gradient(180deg, var(--admin-accent-color), var(--admin-accent-color));
      color: #fff;
      border: none;
      padding: 0.6rem 0.9rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .modal-expert .btn-outline {
      background: transparent;
      border: 1px solid var(--admin-border-color);
      color: var(--admin-text-secondary);
      padding: 0.55rem 0.85rem;
      border-radius: 8px;
      cursor: pointer;
    }

    .modal-expert .btn-outline:hover {
      color: var(--admin-text-primary);
      background: rgba(255, 255, 255, 0.02);
    }

    /* Small utilities */
    .modal-expert .price-feedback {
      font-size: 0.85rem;
      color: var(--admin-accent-color);
      margin-top: 0.35rem;
    }

    .modal-expert .upload-error {
      color: #ff7676;
      margin-top: 0.35rem;
      font-size: 0.9rem;
    }

    /* Responsive adjustments */
    @media (max-width: 880px) {
      .modal-expert .modal-expert__container {
        max-width: 92%;
      }

      .modal-expert .modal-expert__grid {
        grid-template-columns: 1fr;
      }

      .modal-expert .bank-grid {
        grid-template-columns: 1fr;
      }

      .modal-expert .bank-grid .full-width {
        grid-column: auto;
      }
    }

    @media (max-width: 420px) {
      .modal-expert .modal-expert__container {
        border-radius: 8px;
        max-height: calc(100vh - 24px);
      }

      .modal-expert .modal-expert__title {
        font-size: 1rem;
      }

      .modal-expert .srv-day {
        width: 36px;
        height: 36px;
      }
    }
  </style>
  <div id="expertModal" class="modal-expert">
    <div class="modal-expert__container">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Agregar nuevo experto</h2>
        <button class="btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-expert__body">
        <form id="expertForm">
          <!-- Layout helper: responsive two-column grid for most rows -->
          <div class="modal-expert__grid">

            <!-- Información básica -->
            <div>
              <label class="modal-expert__label" for="name">
                <i class="fas fa-user modal-expert__icon" aria-hidden="true"></i>
                Nombre completo
              </label>
              <input type="text" id="name" placeholder="Nombre y apellidos registrados" class="modal-expert__input" />
            </div>

            <div>
              <label class="modal-expert__label" for="email">
                <i class="fas fa-envelope modal-expert__icon" aria-hidden="true"></i>
                Email registrado
              </label>
              <input type="email" id="email" placeholder="Email de la cuenta" class="modal-expert__input" />
            </div>

            <!-- Precio por hora (columna) -->
            <div>
              <label for="precio" class="modal-expert__label">
                <i class="fas fa-money-bill-wave modal-expert__icon" aria-hidden="true" title="Precio"></i>
                Precio por hora (COP)
                <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP"
                  style="margin-left:.5rem;">
                  <i class="fas fa-info-circle"></i>
                </span>
              </label>

              <div class="srv-price-input price-input">
                <span class="srv-currency currency-symbol">$</span>
                <input type="number" id="precio" name="precio" min="10000" step="100" required placeholder="Ej: 50000"
                  class="srv-input price-field" />
              </div>
              <p class="srv-note price-note">
                Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)
              </p>
              <div id="precio-feedback" class="srv-feedback price-feedback" aria-live="polite"></div>
            </div>

            <!-- Días disponibles (columna) -->
            <div>
              <label for="diasDisponibles" class="modal-expert__label">
                <i class="fas fa-calendar-alt modal-expert__icon" aria-hidden="true"></i>
                Días disponibles
              </label>

              <div class="srv-days-wrapper">
                <div class="srv-days">
                  <button type="button" class="srv-day" data-day="Lunes" aria-pressed="false">L</button>
                  <button type="button" class="srv-day" data-day="Martes" aria-pressed="false">M</button>
                  <button type="button" class="srv-day" data-day="Miércoles" aria-pressed="false">X</button>
                  <button type="button" class="srv-day" data-day="Jueves" aria-pressed="false">J</button>
                  <button type="button" class="srv-day" data-day="Viernes" aria-pressed="false">V</button>
                  <button type="button" class="srv-day" data-day="Sábado" aria-pressed="false">S</button>
                  <button type="button" class="srv-day" data-day="Domingo" aria-pressed="false">D</button>
                </div>

                <div class="srv-days-display">
                  Ningún día seleccionado
                </div>
              </div>

              <input type="hidden" id="diasDisponibles" name="diasDisponibles" />
            </div>

            <!-- Especialidad principal -->
            <div>
              <label class="modal-expert__label" for="specialty">
                <i class="fas fa-briefcase modal-expert__icon" aria-hidden="true"></i>
                Especialidad principal
              </label>
              <div class="input-with-icon">
                <i class="fas fa-briefcase" aria-hidden="true"></i>
                <select id="specialty" class="modal-expert__input modal-expert__select"
                  aria-label="Especialidad principal">
                  <option value="">Seleccionar especialidad</option>
                  <option value="web">Desarrollo Web</option>
                  <option value="mobile">Desarrollo Móvil</option>
                  <option value="data">Ciencia de Datos</option>
                  <option value="uxui">UX/UI</option>
                  <option value="devops">DevOps</option>
                  <option value="blockchain">Blockchain</option>
                  <option value="cloud">Cloud Computing</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Selecciona la especialidad principal que describe mejor al
                experto</small>
            </div>

            <!-- Estado -->
            <div>
              <label class="modal-expert__label" for="status">
                <i class="fas fa-toggle-on modal-expert__icon" aria-hidden="true"></i>
                Estado
              </label>
              <div class="input-with-icon">
                <i class="fas fa-toggle-on" aria-hidden="true"></i>
                <select id="status" class="modal-expert__input modal-expert__select" aria-label="Estado del experto">
                  <option value="active">Activo</option>
                  <option value="pending">Pendiente</option>
                  <option value="inactive">Inactivo</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
            </div>

            <!-- Categorías (full width) -->
            <div class="full-width">
              <label class="modal-expert__label" for="categorias">
                <i class="fas fa-tags modal-expert__icon" aria-hidden="true"></i>
                Categorías
              </label>
              <select id="categorias" class="modal-expert__input modal-expert__select-categorias" multiple size="4"
                aria-label="Categorías">
                <!-- opciones añadidas dinámicamente -->
              </select>

<<<<<<< HEAD
              <script>
                // Initialize Choices and force visual fixes for the created/cloned input
                document.addEventListener('DOMContentLoaded', function () {
                  function applyInputFix(el) {
                    if (!el || el.dataset.__stylingApplied) return;
                    try {
                      el.style.setProperty('background', 'transparent', 'important');
                      el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                      el.style.setProperty('-webkit-text-fill-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                      el.style.setProperty('caret-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-accent-color') || '#5e81ff', 'important');
                      el.style.setProperty('border', 'none', 'important');
                      el.style.setProperty('outline', 'none', 'important');
                      el.style.setProperty('width', 'auto', 'important');
                      el.style.setProperty('min-width', '22ch', 'important');
                      el.style.setProperty('font-family', 'inherit', 'important');
                      el.style.setProperty('padding-left', '42px', 'important');
                      el.dataset.__stylingApplied = '1';
                    } catch (e) { }
                  }

                  // Initialize Choices on categorias (if available)
                  if (window.Choices) {
                    const catSelect = document.getElementById('categorias');
                    if (catSelect && !catSelect.classList.contains('choices-initialized')) {
                      new Choices(catSelect, {
                        removeItemButton: true,
                        delimiter: ',',
                        editItems: false,
                        maxItemCount: 10,
                        duplicateItemsAllowed: false
                      });
                      catSelect.classList.add('choices-initialized');
                    }
                  }

                  // Try to style existing inputs immediately and observe future clones
                  function processAll() {
                    document.querySelectorAll('#expertModal .choices__input, #expertModal .choices__input--cloned, input[placeholder="Selecciona categorías"], input[aria-label="Selecciona categorías"]').forEach(applyInputFix);
                    document.querySelectorAll('#expertModal .choices__list--dropdown, #expertModal .choices__list--dropdown .choices__item').forEach(function (el) {
                      try {
                        el.style.setProperty('background', getComputedStyle(document.documentElement).getPropertyValue('--admin-card-bg') || '#121212', 'important');
                        el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                        el.style.setProperty('border-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-border-color') || '#333', 'important');
                      } catch (e) { }
                    });

                    document.querySelectorAll('#expertModal .choices__inner').forEach(function (inner) {
                      try {
                        if (inner.querySelector('.choices__list--multiple')) inner.classList.add('no-icon');
                        else inner.classList.remove('no-icon');
                      } catch (e) { }
                    });
                  }

                  processAll();
                  var attempts = 0;
                  var id = setInterval(function () { processAll(); attempts++; if (attempts > 20) clearInterval(id); }, 150);
                  var mo = new MutationObserver(function () { processAll(); });
                  mo.observe(document.body, { childList: true, subtree: true });
                });
              </script>
              <script>
                // Diagnóstico: registra en consola la estructura y estilos computados del botón remove
                (function () {
                  function diag() {
                    try {
                      var btns = document.querySelectorAll('#expertModal .choices__button');
                      if (!btns || btns.length === 0) {
                        console.info('[diag] No se encontraron .choices__button dentro de #expertModal');
                        return;
                      }
                      btns.forEach(function (b, i) {
                        console.info('[diag] choices__button #' + i + ':', b.outerHTML);
                        var cs = window.getComputedStyle(b);
                        console.info('[diag] computed (button):', {
                          display: cs.display,
                          visibility: cs.visibility,
                          color: cs.color,
                          background: cs.backgroundColor || cs['background-color'],
                          overflow: cs.overflow,
                          zIndex: cs.zIndex
                        });
                        var pa = window.getComputedStyle(b, '::after');
                        console.info('[diag] computed (::after):', {
                          content: pa.content,
                          color: pa.color,
                          display: pa.display,
                          visibility: pa.visibility,
                          zIndex: pa.zIndex,
                          fontSize: pa.fontSize
                        });
                        var pb = window.getComputedStyle(b, '::before');
                        console.info('[diag] computed (::before):', {
                          content: pb.content,
                          color: pb.color
                        });
                      });
                    } catch (e) {
                      console.error('[diag] error:', e);
                    }
                  }
                  document.addEventListener('DOMContentLoaded', function () {
                    setTimeout(diag, 600);
                    // también vuelve a correr cuando se detecta interacción que puede abrir el modal
                    document.body.addEventListener('click', function (ev) {
                      if (ev.target.closest('#expertModal') || ev.target.closest('.btn-close')) setTimeout(diag, 300);
                    }, true);
                  });
                })();
              </script>
=======
              <!-- Choices initialization and visual fixes are centralized in /assets/js/admin/admin-expertos.js -->
>>>>>>> f6d3d6a87628fb1eff6cb39bf29d70fa0a856857
              <small class="modal-expert__hint">Selecciona una o varias categorías (Ctrl/Cmd+click)</small>
            </div>

            <!-- Habilidades (full width) -->
            <div class="full-width">
              <label class="modal-expert__label" for="skills">
                <i class="fas fa-tools modal-expert__icon" aria-hidden="true"></i>
                Habilidades
              </label>
              <select id="skills" class="modal-expert__input" multiple size="6">
                <% if (typeof habilidades !=='undefined' && Array.isArray(habilidades) && habilidades.length> 0) { %>
                  <% habilidades.forEach(function(h) { %>
                    <% const val=(h && (h.nombre || h.name || h.label)) ? (h.nombre || h.name || h.label) : (h && h._id ?
                      String(h._id) : '' ); %>
                      <% if (val) { %>
                        <option value="<%= val %>">
                          <%= val %>
                        </option>
                        <% } %>
                          <% }); %>
                            <% } %>
              </select>
              <!-- Inicialización de Choices para #skills centralizada en /assets/js/admin/admin-expertos.js -->
              <small class="modal-expert__hint">Selecciona o escribe para añadir nuevas habilidades</small>
            </div>

            <!-- Biografía -->
            <div class="full-width">
              <label class="modal-expert__label" for="bio">
                <i class="fas fa-file-alt modal-expert__icon" aria-hidden="true"></i>
                Biografía profesional
              </label>
              <textarea id="bio" rows="4" placeholder="Descripción breve de experiencia y especialización"
                class="modal-expert__input modal-expert__textarea"></textarea>
            </div>

            <!-- Imagen de perfil -->
            <div class="full-width">
              <label class="modal-expert__label" for="profileImage">
                <i class="fas fa-image modal-expert__icon" aria-hidden="true"></i>
                Imagen de perfil
              </label>

              <div class="modal-expert__upload-wrapper">
                <!-- hidden but accessible -->
                <input type="file" id="profileImage" class="modal-expert__file-input"
                  aria-label="Seleccionar imagen de perfil" accept="image/*" />

                <!-- visual upload box (acts as label) -->
                <label for="profileImage" class="modal-expert__upload-box" role="button" aria-haspopup="dialog">
                  <i class="fas fa-upload" aria-hidden="true"></i>
                  <span id="uploadLabel">Seleccionar imagen (png, jpg) · Máx 2MB</span>
                </label>

                <!-- preview thumbnail -->
                <div id="profilePreview" aria-hidden="true" role="img" aria-label="Vista previa de imagen">
                  <button id="removeProfileBtn" type="button" title="Eliminar imagen" aria-label="Eliminar imagen"
                    style="display:none;">
                    <i class="fas fa-times"></i>
                  </button>
                  <img src="" alt="Preview" />
                </div>

                <div class="upload-meta" id="uploadMeta" aria-live="polite" style="display:none;"></div>
                <div class="upload-error" id="profileImageError" role="alert" style="display:none;"></div>
              </div>
            </div>

            <!-- Espacio reservado para mantener la columna alineada -->
            <div aria-hidden="true"></div>

            <!-- Sección bancaria (tarjeta de ancho completo) -->
            <div class="full-width">
              <div class="bank-section">
                <h3 class="bank-title">
                  <i class="fas fa-university"></i> Datos Bancarios para Pagos
                </h3>
                <p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

                <div class="bank-grid">
                  <div>
                    <label for="banco">Banco *</label>
                    <div id="banco-wrapper">
                      <select id="banco" name="banco" required class="modal-expert__input">
                        <option value="">Selecciona tu banco</option>
                        <option value="Banco de Bogotá">Banco de Bogotá</option>
                        <option value="Bancolombia">Bancolombia</option>
                        <option value="Banco Popular">Banco Popular</option>
                        <option value="Banco AV Villas">Banco AV Villas</option>
                        <option value="Banco Caja Social">Banco Caja Social</option>
                        <option value="Banco de Occidente">Banco de Occidente</option>
                        <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
                        <option value="Banco Itaú">Banco Itaú</option>
                        <option value="Banco Pichincha">Banco Pichincha</option>
                        <option value="Banco Santander">Banco Santander</option>
                        <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
                        <option value="Davivienda">Davivienda</option>
                        <option value="Banco Agrario">Banco Agrario</option>
                        <option value="Banco Falabella">Banco Falabella</option>
                        <option value="Banco Finandina">Banco Finandina</option>
                        <option value="Banco W">Banco W</option>
                        <option value="Banco Serfinanza">Banco Serfinanza</option>
                        <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
                        <option value="Banco BBVA">Banco BBVA</option>
                        <option value="Nequi">Nequi</option>
                        <option value="Daviplata">Daviplata</option>
                        <option value="Movii">Movii</option>
                        <option value="Banco de Vivienda">Banco de Vivienda</option>
                        <option value="Banco ProCredit">Banco ProCredit</option>
                        <option value="Banco Multibank">Banco Multibank</option>
                        <option value="Banco Coopcentral">Banco Coopcentral</option>
                        <option value="Banco Credifinanciera">Banco Credifinanciera</option>
                        <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
                        <option value="Banco Ripley">Banco Ripley</option>
                        <option value="Banco CrediScotia">Banco CrediScotia</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="tipoCuenta">Tipo de cuenta *</label>
                    <div id="tipoCuenta-wrapper">
                      <select id="tipoCuenta" name="tipoCuenta" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
                        <option value="Cuenta Corriente">Cuenta Corriente</option>
                        <option value="Cuenta de Nómina">Cuenta de Nómina</option>
                        <option value="Cuenta Digital">Cuenta Digital</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="numeroCuenta">Número de cuenta *</label>
                    <div class="acct-wrap">
                      <input type="password" id="numeroCuenta" name="numeroCuenta" required placeholder="Número de cuenta"
                        pattern="[0-9\-]*" title="Solo números y guiones" class="acct-input">
                      <button type="button" id="toggleAccountNumber" class="acct-toggle"
                        aria-label="Mostrar número de cuenta">
                        <i class="fas fa-eye"></i>
                      </button>
                    </div>
                    <p class="hint">Número completo de tu cuenta</p>
                  </div>

                  <div>
                    <label for="titular">Titular de la cuenta *</label>
                    <input type="text" id="titular" name="titular" required placeholder="Nombre completo del titular"
                      class="modal-expert__input">
                    <p class="hint">Debe coincidir con el nombre en la cuenta</p>
                  </div>

                  <div>
                    <label for="tipoDocumento">Tipo de documento *</label>
                    <div id="tipoDocumento-wrapper">
                      <select id="tipoDocumento" name="tipoDocumento" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                        <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                        <option value="NIT">NIT (Persona Jurídica)</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="numeroDocumento">Número de documento *</label>
                    <input type="text" id="numeroDocumento" name="numeroDocumento" required
                      placeholder="Número de identificación" pattern="[0-9\-]*" class="modal-expert__input">
                    <p class="hint">Documento del titular</p>
                  </div>

                  <div class="full-width">
                    <label for="telefonoContacto">Teléfono de contacto</label>
                    <input type="tel" id="telefonoContacto" name="telefonoContacto" placeholder="+57 300 123 4567"
                      class="modal-expert__input">
                    <p class="hint">Opcional: Teléfono para contacto sobre pagos</p>
                  </div>
                </div>

                <div class="info-box info-sm">
                  <div class="info-header">
                    <i class="fas fa-info-circle"></i>
                    <strong>Información importante sobre pagos</strong>
                  </div>
                  <ul class="info-list">
                    <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                    <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                    <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                    <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Moved footer inside container so it remains visually part of the modal.
             The container is a column-flex so the body scrolls while footer stays at bottom. -->
      <div class="modal-expert__footer">
        <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
        <button type="button" class="btn-primary" id="saveExpert">Guardar experto</button>
      </div>
    </div>
  </div>

  <!-- Modal editar experto is intentionally left in the template; UI helpers moved to centralized JS -->
  <!-- Modal editar experto -->
  <div id="expertModal" class="modal-expert" aria-hidden="true" style="display:none;">

    <div class="modal-expert__container">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Editar experto</h2>
        <button class="btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-expert__body">
        <form id="expertForm">
          <!-- Layout helper: responsive two-column grid for most rows -->
          <div class="modal-expert__grid">

            <!-- Información básica -->
            <div>
              <label class="modal-expert__label" for="name">
                <i class="fas fa-user modal-expert__icon" aria-hidden="true"></i>
                Nombre completo
              </label>
              <input type="text" id="name" placeholder="Nombre y apellidos registrados" class="modal-expert__input" />
            </div>

            <div>
              <label class="modal-expert__label" for="email">
                <i class="fas fa-envelope modal-expert__icon" aria-hidden="true"></i>
                Email registrado
              </label>
              <input type="email" id="email" placeholder="Email de la cuenta" class="modal-expert__input" />
            </div>

            <!-- Precio por hora (columna) -->
            <div>
              <label for="precio" class="modal-expert__label">
                <i class="fas fa-money-bill-wave modal-expert__icon" aria-hidden="true" title="Precio"></i>
                Precio por hora (COP)
<<<<<<< HEAD
                <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP"
                  style="margin-left:.5rem;">
                  <i class="fas fa-info-circle"></i>
                </span>
              </label>

              <div class="srv-price-input price-input">
                <span class="srv-currency currency-symbol">$</span>
                <input type="number" id="precio" name="precio" min="10000" step="100" required placeholder="Ej: 50000"
                  class="srv-input price-field" />
              </div>
              <p class="srv-note price-note">
                Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)
              </p>
              <div id="precio-feedback" class="srv-feedback price-feedback" aria-live="polite"></div>
            </div>

            <!-- Días disponibles (columna) -->
            <div>
              <label for="diasDisponibles" class="modal-expert__label">
                <i class="fas fa-calendar-alt modal-expert__icon" aria-hidden="true"></i>
                Días disponibles
              </label>

              <div class="srv-days-wrapper">
                <div class="srv-days">
                  <button type="button" class="srv-day" data-day="Lunes" aria-pressed="false">L</button>
                  <button type="button" class="srv-day" data-day="Martes" aria-pressed="false">M</button>
                  <button type="button" class="srv-day" data-day="Miércoles" aria-pressed="false">X</button>
                  <button type="button" class="srv-day" data-day="Jueves" aria-pressed="false">J</button>
                  <button type="button" class="srv-day" data-day="Viernes" aria-pressed="false">V</button>
                  <button type="button" class="srv-day" data-day="Sábado" aria-pressed="false">S</button>
                  <button type="button" class="srv-day" data-day="Domingo" aria-pressed="false">D</button>
                </div>

                <div class="srv-days-display">
                  Ningún día seleccionado
                </div>
              </div>

              <input type="hidden" id="diasDisponibles" name="diasDisponibles" />
            </div>

            <!-- Especialidad principal -->
            <div>
              <label class="modal-expert__label" for="specialty">
                <i class="fas fa-briefcase modal-expert__icon" aria-hidden="true"></i>
                Especialidad principal
              </label>
              <div class="input-with-icon">
                <i class="fas fa-briefcase" aria-hidden="true"></i>
                <select id="specialty" class="modal-expert__input modal-expert__select"
                  aria-label="Especialidad principal">
                  <option value="">Seleccionar especialidad</option>
                  <option value="web">Desarrollo Web</option>
                  <option value="mobile">Desarrollo Móvil</option>
                  <option value="data">Ciencia de Datos</option>
                  <option value="uxui">UX/UI</option>
                  <option value="devops">DevOps</option>
                  <option value="blockchain">Blockchain</option>
                  <option value="cloud">Cloud Computing</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Selecciona la especialidad principal que describe mejor al
                experto</small>
            </div>

            <!-- Estado -->
            <div>
              <label class="modal-expert__label" for="status">
                <i class="fas fa-toggle-on modal-expert__icon" aria-hidden="true"></i>
                Estado
              </label>
              <div class="input-with-icon">
                <i class="fas fa-toggle-on" aria-hidden="true"></i>
                <select id="status" class="modal-expert__input modal-expert__select" aria-label="Estado del experto">
                  <option value="active">Activo</option>
                  <option value="pending">Pendiente</option>
                  <option value="inactive">Inactivo</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
            </div>

            <!-- Categorías (full width) -->
            <div class="full-width">
              <label class="modal-expert__label" for="categorias">
                <i class="fas fa-tags modal-expert__icon" aria-hidden="true"></i>
                Categorías
              </label>
              <select id="categorias" class="modal-expert__input modal-expert__select-categorias" multiple size="4"
                aria-label="Categorías">
                <!-- opciones añadidas dinámicamente -->
              </select>

              <script>
                // Initialize Choices and force visual fixes for the created/cloned input
                document.addEventListener('DOMContentLoaded', function () {
                  function applyInputFix(el) {
                    if (!el || el.dataset.__stylingApplied) return;
                    try {
                      el.style.setProperty('background', 'transparent', 'important');
                      el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                      el.style.setProperty('-webkit-text-fill-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                      el.style.setProperty('caret-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-accent-color') || '#5e81ff', 'important');
                      el.style.setProperty('border', 'none', 'important');
                      el.style.setProperty('outline', 'none', 'important');
                      el.style.setProperty('width', 'auto', 'important');
                      el.style.setProperty('min-width', '22ch', 'important');
                      el.style.setProperty('font-family', 'inherit', 'important');
                      el.style.setProperty('padding-left', '42px', 'important');
                      el.dataset.__stylingApplied = '1';
                    } catch (e) { }
                  }

                  // Initialize Choices on categorias (if available)
                  if (window.Choices) {
                    const catSelect = document.getElementById('categorias');
                    if (catSelect && !catSelect.classList.contains('choices-initialized')) {
                      new Choices(catSelect, {
                        removeItemButton: true,
                        delimiter: ',',
                        editItems: false,
                        maxItemCount: 10,
                        duplicateItemsAllowed: false
                      });
                      catSelect.classList.add('choices-initialized');
                    }
                  }

                  // Try to style existing inputs immediately and observe future clones
                  function processAll() {
                    document.querySelectorAll('#expertModal .choices__input, #expertModal .choices__input--cloned, input[placeholder="Selecciona categorías"], input[aria-label="Selecciona categorías"]').forEach(applyInputFix);
                    document.querySelectorAll('#expertModal .choices__list--dropdown, #expertModal .choices__list--dropdown .choices__item').forEach(function (el) {
                      try {
                        el.style.setProperty('background', getComputedStyle(document.documentElement).getPropertyValue('--admin-card-bg') || '#121212', 'important');
                        el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                        el.style.setProperty('border-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-border-color') || '#333', 'important');
                      } catch (e) { }
                    });

                    document.querySelectorAll('#expertModal .choices__inner').forEach(function (inner) {
                      try {
                        if (inner.querySelector('.choices__list--multiple')) inner.classList.add('no-icon');
                        else inner.classList.remove('no-icon');
                      } catch (e) { }
                    });
                  }

                  processAll();
                  var attempts = 0;
                  var id = setInterval(function () { processAll(); attempts++; if (attempts > 20) clearInterval(id); }, 150);
                  var mo = new MutationObserver(function () { processAll(); });
                  mo.observe(document.body, { childList: true, subtree: true });
                });
              </script>
              <script>
                // Diagnóstico: registra en consola la estructura y estilos computados del botón remove
                (function () {
                  function diag() {
                    try {
                      var btns = document.querySelectorAll('#expertModal .choices__button');
                      if (!btns || btns.length === 0) {
                        console.info('[diag] No se encontraron .choices__button dentro de #expertModal');
                        return;
                      }
                      btns.forEach(function (b, i) {
                        console.info('[diag] choices__button #' + i + ':', b.outerHTML);
                        var cs = window.getComputedStyle(b);
                        console.info('[diag] computed (button):', {
                          display: cs.display,
                          visibility: cs.visibility,
                          color: cs.color,
                          background: cs.backgroundColor || cs['background-color'],
                          overflow: cs.overflow,
                          zIndex: cs.zIndex
                        });
                        var pa = window.getComputedStyle(b, '::after');
                        console.info('[diag] computed (::after):', {
                          content: pa.content,
                          color: pa.color,
                          display: pa.display,
                          visibility: pa.visibility,
                          zIndex: pa.zIndex,
                          fontSize: pa.fontSize
                        });
                        var pb = window.getComputedStyle(b, '::before');
                        console.info('[diag] computed (::before):', {
                          content: pb.content,
                          color: pb.color
                        });
                      });
                    } catch (e) {
                      console.error('[diag] error:', e);
                    }
                  }
                  document.addEventListener('DOMContentLoaded', function () {
                    setTimeout(diag, 600);
                    // también vuelve a correr cuando se detecta interacción que puede abrir el modal
                    document.body.addEventListener('click', function (ev) {
                      if (ev.target.closest('#expertModal') || ev.target.closest('.btn-close')) setTimeout(diag, 300);
                    }, true);
                  });
                })();
              </script>
              <small class="modal-expert__hint">Selecciona una o varias categorías (Ctrl/Cmd+click)</small>
            </div>

            <!-- Habilidades (full width) -->
            <div class="full-width">
              <label class="modal-expert__label" for="skills">
                <i class="fas fa-tools modal-expert__icon" aria-hidden="true"></i>
                Habilidades
              </label>
              <select id="skills" class="modal-expert__input" multiple size="6">
                <% if (typeof habilidades !=='undefined' && Array.isArray(habilidades) && habilidades.length> 0) { %>
                  <% habilidades.forEach(function(h) { %>
                    <% const val=(h && (h.nombre || h.name || h.label)) ? (h.nombre || h.name || h.label) : (h && h._id
                      ? String(h._id) : '' ); %>
                      <% if (val) { %>
                        <option value="<%= val %>">
                          <%= val %>
                        </option>
                        <% } %>
                          <% }); %>
                            <% } %>
              </select>
              <script>
                document.addEventListener('DOMContentLoaded', function () {
                  if (window.Choices) {
                    const skillsSelect = document.getElementById('skills');
                    if (skillsSelect && !skillsSelect.classList.contains('choices-initialized')) {
                      new Choices(skillsSelect, {
                        removeItemButton: true,
                        delimiter: ',',
                        editItems: false,
                        maxItemCount: 10,
                        duplicateItemsAllowed: false
                      });
                      skillsSelect.classList.add('choices-initialized');
                    }
                  }
                });
              </script>
              <small class="modal-expert__hint">Selecciona o escribe para añadir nuevas habilidades</small>
            </div>

            <!-- Biografía -->
            <div class="full-width">
              <label class="modal-expert__label" for="bio">
                <i class="fas fa-file-alt modal-expert__icon" aria-hidden="true"></i>
                Biografía profesional
              </label>
              <textarea id="bio" rows="4" placeholder="Descripción breve de experiencia y especialización"
                class="modal-expert__input modal-expert__textarea"></textarea>
            </div>

            <!-- Imagen de perfil -->
            <div class="full-width">
              <label class="modal-expert__label" for="profileImage">
                <i class="fas fa-image modal-expert__icon" aria-hidden="true"></i>
                Imagen de perfil
              </label>

              <div class="modal-expert__upload-wrapper">
                <!-- hidden but accessible -->
                <input type="file" id="profileImage" class="modal-expert__file-input"
                  aria-label="Seleccionar imagen de perfil" accept="image/*" />

                <!-- visual upload box (acts as label) -->
                <label for="profileImage" class="modal-expert__upload-box" role="button" aria-haspopup="dialog">
                  <i class="fas fa-upload" aria-hidden="true"></i>
                  <span id="uploadLabel">Seleccionar imagen (png, jpg) · Máx 2MB</span>
                </label>

                <!-- preview thumbnail -->
                <div id="profilePreview" aria-hidden="true" role="img" aria-label="Vista previa de imagen">
                  <button id="removeProfileBtn" type="button" title="Eliminar imagen" aria-label="Eliminar imagen"
                    style="display:none;">
                    <i class="fas fa-times"></i>
                  </button>
                  <img src="" alt="Preview" />
                </div>

                <div class="upload-meta" id="uploadMeta" aria-live="polite" style="display:none;"></div>
                <div class="upload-error" id="profileImageError" role="alert" style="display:none;"></div>
              </div>
            </div>

            <!-- Espacio reservado para mantener la columna alineada -->
            <div aria-hidden="true"></div>

            <!-- Sección bancaria (tarjeta de ancho completo) -->
            <div class="full-width">
              <div class="bank-section">
                <h3 class="bank-title">
                  <i class="fas fa-university"></i> Datos Bancarios para Pagos
                </h3>
                <p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

                <div class="bank-grid">
                  <div>
                    <label for="banco">Banco *</label>
                    <div id="banco-wrapper">
                      <select id="banco" name="banco" required class="modal-expert__input">
                        <option value="">Selecciona tu banco</option>
                        <option value="Banco de Bogotá">Banco de Bogotá</option>
                        <option value="Bancolombia">Bancolombia</option>
                        <option value="Banco Popular">Banco Popular</option>
                        <option value="Banco AV Villas">Banco AV Villas</option>
                        <option value="Banco Caja Social">Banco Caja Social</option>
                        <option value="Banco de Occidente">Banco de Occidente</option>
                        <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
                        <option value="Banco Itaú">Banco Itaú</option>
                        <option value="Banco Pichincha">Banco Pichincha</option>
                        <option value="Banco Santander">Banco Santander</option>
                        <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
                        <option value="Davivienda">Davivienda</option>
                        <option value="Banco Agrario">Banco Agrario</option>
                        <option value="Banco Falabella">Banco Falabella</option>
                        <option value="Banco Finandina">Banco Finandina</option>
                        <option value="Banco W">Banco W</option>
                        <option value="Banco Serfinanza">Banco Serfinanza</option>
                        <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
                        <option value="Banco BBVA">Banco BBVA</option>
                        <option value="Nequi">Nequi</option>
                        <option value="Daviplata">Daviplata</option>
                        <option value="Movii">Movii</option>
                        <option value="Banco de Vivienda">Banco de Vivienda</option>
                        <option value="Banco ProCredit">Banco ProCredit</option>
                        <option value="Banco Multibank">Banco Multibank</option>
                        <option value="Banco Coopcentral">Banco Coopcentral</option>
                        <option value="Banco Credifinanciera">Banco Credifinanciera</option>
                        <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
                        <option value="Banco Ripley">Banco Ripley</option>
                        <option value="Banco CrediScotia">Banco CrediScotia</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="tipoCuenta">Tipo de cuenta *</label>
                    <div id="tipoCuenta-wrapper">
                      <select id="tipoCuenta" name="tipoCuenta" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
                        <option value="Cuenta Corriente">Cuenta Corriente</option>
                        <option value="Cuenta de Nómina">Cuenta de Nómina</option>
                        <option value="Cuenta Digital">Cuenta Digital</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="numeroCuenta">Número de cuenta *</label>
                    <div class="acct-wrap">
                      <input type="password" id="numeroCuenta" name="numeroCuenta" required
                        placeholder="Número de cuenta" pattern="[0-9\-]*" title="Solo números y guiones"
                        class="acct-input">
                      <button type="button" id="toggleAccountNumber" class="acct-toggle"
                        aria-label="Mostrar número de cuenta">
                        <i class="fas fa-eye"></i>
                      </button>
                    </div>
                    <p class="hint">Número completo de tu cuenta</p>
                  </div>

                  <div>
                    <label for="titular">Titular de la cuenta *</label>
                    <input type="text" id="titular" name="titular" required placeholder="Nombre completo del titular"
                      class="modal-expert__input">
                    <p class="hint">Debe coincidir con el nombre en la cuenta</p>
                  </div>

                  <div>
                    <label for="tipoDocumento">Tipo de documento *</label>
                    <div id="tipoDocumento-wrapper">
                      <select id="tipoDocumento" name="tipoDocumento" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                        <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                        <option value="NIT">NIT (Persona Jurídica)</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="numeroDocumento">Número de documento *</label>
                    <input type="text" id="numeroDocumento" name="numeroDocumento" required
                      placeholder="Número de identificación" pattern="[0-9\-]*" class="modal-expert__input">
                    <p class="hint">Documento del titular</p>
                  </div>

                  <div class="full-width">
                    <label for="telefonoContacto">Teléfono de contacto</label>
                    <input type="tel" id="telefonoContacto" name="telefonoContacto" placeholder="+57 300 123 4567"
                      class="modal-expert__input">
                    <p class="hint">Opcional: Teléfono para contacto sobre pagos</p>
                  </div>
                </div>

                <div class="info-box info-sm">
                  <div class="info-header">
                    <i class="fas fa-info-circle"></i>
                    <strong>Información importante sobre pagos</strong>
                  </div>
                  <ul class="info-list">
                    <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                    <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                    <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                    <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Moved footer inside container so it remains visually part of the modal.
             The container is a column-flex so the body scrolls while footer stays at bottom. -->
      <div class="modal-expert__footer">
        <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
        <button type="button" class="btn-primary" id="saveExpert">Guardar experto</button>
      </div>
    </div>
  </div>

  <!--modal ver perfil experto-->
  <div id="verPerfilExperto" class="modal-expert" aria-hidden="true" style="display:none;">

    <div class="modal-expert__container">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Perfil del experto</h2>
        <button class="btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-expert__body">
        <form id="expertForm">
          <!-- Layout helper: responsive two-column grid for most rows -->
          <div class="modal-expert__grid">

            <!-- Información básica -->
            <div>
              <label class="modal-expert__label" for="name">
                <i class="fas fa-user modal-expert__icon" aria-hidden="true"></i>
                Nombre completo
              </label>
              <input type="text" id="name" placeholder="Nombre y apellidos registrados" class="modal-expert__input" />
            </div>

            <div>
              <label class="modal-expert__label" for="email">
                <i class="fas fa-envelope modal-expert__icon" aria-hidden="true"></i>
                Email registrado
              </label>
              <input type="email" id="email" placeholder="Email de la cuenta" class="modal-expert__input" />
            </div>

            <!-- Precio por hora (columna) -->
            <div>
              <label for="precio" class="modal-expert__label">
                <i class="fas fa-money-bill-wave modal-expert__icon" aria-hidden="true" title="Precio"></i>
                Precio por hora (COP)
                <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP"
                  style="margin-left:.5rem;">
                  <i class="fas fa-info-circle"></i>
                </span>
              </label>

              <div class="srv-price-input price-input">
                <span class="srv-currency currency-symbol">$</span>
                <input type="number" id="precio" name="precio" min="10000" step="100" required placeholder="Ej: 50000"
                  class="srv-input price-field" />
              </div>
              <p class="srv-note price-note">
                Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)
              </p>
              <div id="precio-feedback" class="srv-feedback price-feedback" aria-live="polite"></div>
            </div>

            <!-- Días disponibles (columna) -->
            <div>
              <label for="diasDisponibles" class="modal-expert__label">
                <i class="fas fa-calendar-alt modal-expert__icon" aria-hidden="true"></i>
                Días disponibles
              </label>

              <div class="srv-days-wrapper">
                <div class="srv-days">
                  <button type="button" class="srv-day" data-day="Lunes" aria-pressed="false">L</button>
                  <button type="button" class="srv-day" data-day="Martes" aria-pressed="false">M</button>
                  <button type="button" class="srv-day" data-day="Miércoles" aria-pressed="false">X</button>
                  <button type="button" class="srv-day" data-day="Jueves" aria-pressed="false">J</button>
                  <button type="button" class="srv-day" data-day="Viernes" aria-pressed="false">V</button>
                  <button type="button" class="srv-day" data-day="Sábado" aria-pressed="false">S</button>
                  <button type="button" class="srv-day" data-day="Domingo" aria-pressed="false">D</button>
                </div>

                <div class="srv-days-display">
                  Ningún día seleccionado
                </div>
              </div>

              <input type="hidden" id="diasDisponibles" name="diasDisponibles" />
            </div>

            <!-- Especialidad principal -->
            <div>
              <label class="modal-expert__label" for="specialty">
                <i class="fas fa-briefcase modal-expert__icon" aria-hidden="true"></i>
                Especialidad principal
              </label>
              <div class="input-with-icon">
                <i class="fas fa-briefcase" aria-hidden="true"></i>
                <select id="specialty" class="modal-expert__input modal-expert__select"
                  aria-label="Especialidad principal">
                  <option value="">Seleccionar especialidad</option>
                  <option value="web">Desarrollo Web</option>
                  <option value="mobile">Desarrollo Móvil</option>
                  <option value="data">Ciencia de Datos</option>
                  <option value="uxui">UX/UI</option>
                  <option value="devops">DevOps</option>
                  <option value="blockchain">Blockchain</option>
                  <option value="cloud">Cloud Computing</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Selecciona la especialidad principal que describe mejor al
                experto</small>
            </div>

            <!-- Estado -->
            <div>
              <label class="modal-expert__label" for="status">
                <i class="fas fa-toggle-on modal-expert__icon" aria-hidden="true"></i>
                Estado
              </label>
              <div class="input-with-icon">
                <i class="fas fa-toggle-on" aria-hidden="true"></i>
                <select id="status" class="modal-expert__input modal-expert__select" aria-label="Estado del experto">
                  <option value="active">Activo</option>
                  <option value="pending">Pendiente</option>
                  <option value="inactive">Inactivo</option>
                </select>
                <i class="fas fa-chevron-down" aria-hidden="true"></i>
              </div>
              <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
            </div>

            <!-- Categorías (full width) -->
            <div class="full-width">
              <label class="modal-expert__label" for="categorias">
                <i class="fas fa-tags modal-expert__icon" aria-hidden="true"></i>
                Categorías
              </label>
              <select id="categorias" class="modal-expert__input modal-expert__select-categorias" multiple size="4"
                aria-label="Categorías">
                <!-- opciones añadidas dinámicamente -->
              </select>

              <script>
                // Initialize Choices and force visual fixes for the created/cloned input
                document.addEventListener('DOMContentLoaded', function () {
                  function applyInputFix(el) {
                    if (!el || el.dataset.__stylingApplied) return;
                    try {
                      el.style.setProperty('background', 'transparent', 'important');
                      el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                      el.style.setProperty('-webkit-text-fill-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                      el.style.setProperty('caret-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-accent-color') || '#5e81ff', 'important');
                      el.style.setProperty('border', 'none', 'important');
                      el.style.setProperty('outline', 'none', 'important');
                      el.style.setProperty('width', 'auto', 'important');
                      el.style.setProperty('min-width', '22ch', 'important');
                      el.style.setProperty('font-family', 'inherit', 'important');
                      el.style.setProperty('padding-left', '42px', 'important');
                      el.dataset.__stylingApplied = '1';
                    } catch (e) { }
                  }

                  // Initialize Choices on categorias (if available)
                  if (window.Choices) {
                    const catSelect = document.getElementById('categorias');
                    if (catSelect && !catSelect.classList.contains('choices-initialized')) {
                      new Choices(catSelect, {
                        removeItemButton: true,
                        delimiter: ',',
                        editItems: false,
                        maxItemCount: 10,
                        duplicateItemsAllowed: false
                      });
                      catSelect.classList.add('choices-initialized');
                    }
                  }

                  // Try to style existing inputs immediately and observe future clones
                  function processAll() {
                    document.querySelectorAll('#expertModal .choices__input, #expertModal .choices__input--cloned, input[placeholder="Selecciona categorías"], input[aria-label="Selecciona categorías"]').forEach(applyInputFix);
                    document.querySelectorAll('#expertModal .choices__list--dropdown, #expertModal .choices__list--dropdown .choices__item').forEach(function (el) {
                      try {
                        el.style.setProperty('background', getComputedStyle(document.documentElement).getPropertyValue('--admin-card-bg') || '#121212', 'important');
                        el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-primary') || '#ffffff', 'important');
                        el.style.setProperty('border-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-border-color') || '#333', 'important');
                      } catch (e) { }
                    });

                    document.querySelectorAll('#expertModal .choices__inner').forEach(function (inner) {
                      try {
                        if (inner.querySelector('.choices__list--multiple')) inner.classList.add('no-icon');
                        else inner.classList.remove('no-icon');
                      } catch (e) { }
                    });
                  }

                  processAll();
                  var attempts = 0;
                  var id = setInterval(function () { processAll(); attempts++; if (attempts > 20) clearInterval(id); }, 150);
                  var mo = new MutationObserver(function () { processAll(); });
                  mo.observe(document.body, { childList: true, subtree: true });
                });
              </script>
              <script>
                // Diagnóstico: registra en consola la estructura y estilos computados del botón remove
                (function () {
                  function diag() {
                    try {
                      var btns = document.querySelectorAll('#expertModal .choices__button');
                      if (!btns || btns.length === 0) {
                        console.info('[diag] No se encontraron .choices__button dentro de #expertModal');
                        return;
                      }
                      btns.forEach(function (b, i) {
                        console.info('[diag] choices__button #' + i + ':', b.outerHTML);
                        var cs = window.getComputedStyle(b);
                        console.info('[diag] computed (button):', {
                          display: cs.display,
                          visibility: cs.visibility,
                          color: cs.color,
                          background: cs.backgroundColor || cs['background-color'],
                          overflow: cs.overflow,
                          zIndex: cs.zIndex
                        });
                        var pa = window.getComputedStyle(b, '::after');
                        console.info('[diag] computed (::after):', {
                          content: pa.content,
                          color: pa.color,
                          display: pa.display,
                          visibility: pa.visibility,
                          zIndex: pa.zIndex,
                          fontSize: pa.fontSize
                        });
                        var pb = window.getComputedStyle(b, '::before');
                        console.info('[diag] computed (::before):', {
                          content: pb.content,
                          color: pb.color
                        });
                      });
                    } catch (e) {
                      console.error('[diag] error:', e);
                    }
                  }
                  document.addEventListener('DOMContentLoaded', function () {
                    setTimeout(diag, 600);
                    // también vuelve a correr cuando se detecta interacción que puede abrir el modal
                    document.body.addEventListener('click', function (ev) {
                      if (ev.target.closest('#expertModal') || ev.target.closest('.btn-close')) setTimeout(diag, 300);
                    }, true);
                  });
                })();
              </script>
              <small class="modal-expert__hint">Selecciona una o varias categorías (Ctrl/Cmd+click)</small>
            </div>

            <!-- Habilidades (full width) -->
            <div class="full-width">
              <label class="modal-expert__label" for="skills">
                <i class="fas fa-tools modal-expert__icon" aria-hidden="true"></i>
                Habilidades
              </label>
              <select id="skills" class="modal-expert__input" multiple size="6">
                <% if (typeof habilidades !=='undefined' && Array.isArray(habilidades) && habilidades.length> 0) { %>
                  <% habilidades.forEach(function(h) { %>
                    <% const val=(h && (h.nombre || h.name || h.label)) ? (h.nombre || h.name || h.label) : (h && h._id
                      ? String(h._id) : '' ); %>
                      <% if (val) { %>
                        <option value="<%= val %>">
                          <%= val %>
                        </option>
                        <% } %>
                          <% }); %>
                            <% } %>
              </select>
              <script>
                document.addEventListener('DOMContentLoaded', function () {
                  if (window.Choices) {
                    const skillsSelect = document.getElementById('skills');
                    if (skillsSelect && !skillsSelect.classList.contains('choices-initialized')) {
                      new Choices(skillsSelect, {
                        removeItemButton: true,
                        delimiter: ',',
                        editItems: false,
                        maxItemCount: 10,
                        duplicateItemsAllowed: false
                      });
                      skillsSelect.classList.add('choices-initialized');
                    }
                  }
                });
              </script>
              <small class="modal-expert__hint">Selecciona o escribe para añadir nuevas habilidades</small>
            </div>

            <!-- Biografía -->
            <div class="full-width">
              <label class="modal-expert__label" for="bio">
                <i class="fas fa-file-alt modal-expert__icon" aria-hidden="true"></i>
                Biografía profesional
              </label>
              <textarea id="bio" rows="4" placeholder="Descripción breve de experiencia y especialización"
                class="modal-expert__input modal-expert__textarea"></textarea>
            </div>

            <!-- Imagen de perfil -->
            <div class="full-width">
              <label class="modal-expert__label" for="profileImage">
                <i class="fas fa-image modal-expert__icon" aria-hidden="true"></i>
                Imagen de perfil
              </label>

              <div class="modal-expert__upload-wrapper">
                <!-- hidden but accessible -->
                <input type="file" id="profileImage" class="modal-expert__file-input"
                  aria-label="Seleccionar imagen de perfil" accept="image/*" />

                <!-- visual upload box (acts as label) -->
                <label for="profileImage" class="modal-expert__upload-box" role="button" aria-haspopup="dialog">
                  <i class="fas fa-upload" aria-hidden="true"></i>
                  <span id="uploadLabel">Seleccionar imagen (png, jpg) · Máx 2MB</span>
                </label>

                <!-- preview thumbnail -->
                <div id="profilePreview" aria-hidden="true" role="img" aria-label="Vista previa de imagen">
                  <button id="removeProfileBtn" type="button" title="Eliminar imagen" aria-label="Eliminar imagen"
                    style="display:none;">
                    <i class="fas fa-times"></i>
                  </button>
                  <img src="" alt="Preview" />
                </div>

                <div class="upload-meta" id="uploadMeta" aria-live="polite" style="display:none;"></div>
                <div class="upload-error" id="profileImageError" role="alert" style="display:none;"></div>
              </div>
            </div>

            <!-- Espacio reservado para mantener la columna alineada -->
            <div aria-hidden="true"></div>

            <!-- Sección bancaria (tarjeta de ancho completo) -->
            <div class="full-width">
              <div class="bank-section">
                <h3 class="bank-title">
                  <i class="fas fa-university"></i> Datos Bancarios para Pagos
                </h3>
                <p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

                <div class="bank-grid">
                  <div>
                    <label for="banco">Banco *</label>
                    <div id="banco-wrapper">
                      <select id="banco" name="banco" required class="modal-expert__input">
                        <option value="">Selecciona tu banco</option>
                        <option value="Banco de Bogotá">Banco de Bogotá</option>
                        <option value="Bancolombia">Bancolombia</option>
                        <option value="Banco Popular">Banco Popular</option>
                        <option value="Banco AV Villas">Banco AV Villas</option>
                        <option value="Banco Caja Social">Banco Caja Social</option>
                        <option value="Banco de Occidente">Banco de Occidente</option>
                        <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
                        <option value="Banco Itaú">Banco Itaú</option>
                        <option value="Banco Pichincha">Banco Pichincha</option>
                        <option value="Banco Santander">Banco Santander</option>
                        <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
                        <option value="Davivienda">Davivienda</option>
                        <option value="Banco Agrario">Banco Agrario</option>
                        <option value="Banco Falabella">Banco Falabella</option>
                        <option value="Banco Finandina">Banco Finandina</option>
                        <option value="Banco W">Banco W</option>
                        <option value="Banco Serfinanza">Banco Serfinanza</option>
                        <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
                        <option value="Banco BBVA">Banco BBVA</option>
                        <option value="Nequi">Nequi</option>
                        <option value="Daviplata">Daviplata</option>
                        <option value="Movii">Movii</option>
                        <option value="Banco de Vivienda">Banco de Vivienda</option>
                        <option value="Banco ProCredit">Banco ProCredit</option>
                        <option value="Banco Multibank">Banco Multibank</option>
                        <option value="Banco Coopcentral">Banco Coopcentral</option>
                        <option value="Banco Credifinanciera">Banco Credifinanciera</option>
                        <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
                        <option value="Banco Ripley">Banco Ripley</option>
                        <option value="Banco CrediScotia">Banco CrediScotia</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="tipoCuenta">Tipo de cuenta *</label>
                    <div id="tipoCuenta-wrapper">
                      <select id="tipoCuenta" name="tipoCuenta" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
                        <option value="Cuenta Corriente">Cuenta Corriente</option>
                        <option value="Cuenta de Nómina">Cuenta de Nómina</option>
                        <option value="Cuenta Digital">Cuenta Digital</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="numeroCuenta">Número de cuenta *</label>
                    <div class="acct-wrap">
                      <input type="password" id="numeroCuenta" name="numeroCuenta" required
                        placeholder="Número de cuenta" pattern="[0-9\-]*" title="Solo números y guiones"
                        class="acct-input">
                      <button type="button" id="toggleAccountNumber" class="acct-toggle"
                        aria-label="Mostrar número de cuenta">
                        <i class="fas fa-eye"></i>
                      </button>
                    </div>
                    <p class="hint">Número completo de tu cuenta</p>
                  </div>

                  <div>
                    <label for="titular">Titular de la cuenta *</label>
                    <input type="text" id="titular" name="titular" required placeholder="Nombre completo del titular"
                      class="modal-expert__input">
                    <p class="hint">Debe coincidir con el nombre en la cuenta</p>
                  </div>

                  <div>
                    <label for="tipoDocumento">Tipo de documento *</label>
                    <div id="tipoDocumento-wrapper">
                      <select id="tipoDocumento" name="tipoDocumento" required class="modal-expert__input">
                        <option value="">Selecciona el tipo</option>
                        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                        <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                        <option value="NIT">NIT (Persona Jurídica)</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label for="numeroDocumento">Número de documento *</label>
                    <input type="text" id="numeroDocumento" name="numeroDocumento" required
                      placeholder="Número de identificación" pattern="[0-9\-]*" class="modal-expert__input">
                    <p class="hint">Documento del titular</p>
                  </div>

                  <div class="full-width">
                    <label for="telefonoContacto">Teléfono de contacto</label>
                    <input type="tel" id="telefonoContacto" name="telefonoContacto" placeholder="+57 300 123 4567"
                      class="modal-expert__input">
                    <p class="hint">Opcional: Teléfono para contacto sobre pagos</p>
                  </div>
                </div>

                <div class="info-box info-sm">
                  <div class="info-header">
                    <i class="fas fa-info-circle"></i>
                    <strong>Información importante sobre pagos</strong>
                  </div>
                  <ul class="info-list">
                    <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                    <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                    <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                    <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Moved footer inside container so it remains visually part of the modal.
             The container is a column-flex so the body scrolls while footer stays at bottom. -->
      <div class="modal-expert__footer">
        <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
        <button type="button" class="btn-primary" id="saveExpert">Guardar experto</button>
      </div>
    </div>
  </div>


  <!-- Modal inactivar experto -->
  <div id="modalInactivarExperto" class="modal-expert">
    <div class="modal-expert__content">
      <div class="modal-expert__header">
        <h2 class="modal-expert__title">Inactivar experto</h2>
        <button class="btn-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-expert__body">
        <p id="modalInactivarExpertoNombre" class="modal-expert__nombre-destacado"></p>
        <p>
          ¿Está seguro que desea inactivar este usuario?<br />
          <span class="modal-expert__texto-secundario">
            El usuario <b>no se eliminará</b> de la base de datos, solo pasará
            a estado <b>inactivo</b>.
          </span>
        </p>
      </div>
      <div class="modal-expert__footer">
        <button type="button" class="btn-outline modal-inactivar-cancelar">
          Cancelar
        </button>
        <button type="button" class="btn-primary modal-inactivar-confirmar">
          Inactivar
        </button>
      </div>
    </div>
  </div>

  <script src="/assets/js/admin/admin-common.js"></script>
  <% /* Garantizar que _adminHabs siempre sea un array para producir JSON válido */ %>
    <% const _adminHabs=(typeof habilidades !=='undefined' && Array.isArray(habilidades)) ? habilidades : []; %>
      <!-- Inyectar JSON en un script de tipo application/json y leerlo desde JS -->
      <script id="admin-habilidades" type="application/json"><%- JSON.stringify(_adminHabs) %></script>
      <script src="/assets/js/admin/admin-expertos.js"></script>
      <script>
        // Forzar color del input clonado de Choices con placeholder/aria-label "Selecciona habilidades"
        (function forceSkillsPlaceholderColor() {
          function apply(el) {
            try {
              if (!el) return;
              // Apply inline styles with CSS priority using setProperty and 'important'
              el.style.setProperty('color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-secondary') || '#a0a0a0', 'important');
              el.style.setProperty('-webkit-text-fill-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-secondary') || '#a0a0a0', 'important');
              el.style.setProperty('caret-color', getComputedStyle(document.documentElement).getPropertyValue('--admin-text-secondary') || '#a0a0a0', 'important');
            } catch (e) { /* ignore */ }
          }

          function findAndApply() {
            // Common places Choices places the cloned input
            var selectors = [
              'input.choices__input--cloned[aria-label="Selecciona habilidades"]',
              'input.choices__input--cloned[placeholder="Selecciona habilidades"]',
              'input.choices__input[aria-label="Selecciona habilidades"]',
              'input.choices__input[placeholder="Selecciona habilidades"]'
            ];
            selectors.forEach(function (s) {
              document.querySelectorAll(s).forEach(apply);
            });
          }

          // Run after DOM ready and periodically for dynamic injection by Choices
          document.addEventListener('DOMContentLoaded', function () {
            findAndApply();
            var attempts = 0;
            var id = setInterval(function () {
              findAndApply();
              attempts += 1;
              if (attempts > 20) clearInterval(id);
            }, 150);
          });

          // Observe DOM changes to catch later insertions
          var mo = new MutationObserver(function () {
            findAndApply();
          });
          mo.observe(document.body, { childList: true, subtree: true });
        })();
      </script>
      <script>
        // Forzar estilos inline para el bloque Precio por hora si el CSS no se está aplicando
        (function forcePriceRowStyles() {
          function varOr(name, def) { try { var v = getComputedStyle(document.documentElement).getPropertyValue(name); return (v && v.trim()) || def; } catch (e) { return def; } }
          var bg = varOr('--admin-card-bg', '#1a1a1a');
          var text = varOr('--admin-text-primary', '#ffffff');
          var secondary = varOr('--admin-text-secondary', '#a0a0a0');
          var border = varOr('--admin-border-color', '#333');
          var accent = varOr('--admin-accent-color', '#5e81ff');

          function apply() {
            // Apply grid to the container that holds both columns (precio + días)
            var containers = document.querySelectorAll('.modal-expert__price-days');
            containers.forEach(function (c) {
              c.style.setProperty('display', 'grid', 'important');
              c.style.setProperty('grid-template-columns', '1fr 1fr', 'important');
              c.style.setProperty('gap', '1rem', 'important');
              c.style.setProperty('align-items', 'start', 'important');
              c.style.setProperty('width', '100%', 'important');
              c.style.setProperty('box-sizing', 'border-box', 'important');
            });

            // Ensure internal rows are stacked normally
            document.querySelectorAll('.modal-expert__price-days .price-row, .modal-expert__price-days .srv-grid').forEach(function (w) {
              w.style.setProperty('display', 'block', 'important');
              w.style.setProperty('margin', '0', 'important');
            });

            document.querySelectorAll('.srv-price-input, .price-input').forEach(function (pi) {
              pi.style.setProperty('display', 'flex', 'important');
              pi.style.setProperty('align-items', 'center', 'important');
              pi.style.setProperty('gap', '0.5rem', 'important');
              pi.style.setProperty('background', 'rgba(255,255,255,0.02)', 'important');
              pi.style.setProperty('border', '1px solid ' + border, 'important');
              pi.style.setProperty('padding', '0.375rem 0.5rem', 'important');
              pi.style.setProperty('border-radius', '0.5rem', 'important');
              pi.style.setProperty('box-sizing', 'border-box', 'important');
            });

            document.querySelectorAll('.srv-currency, .currency-symbol').forEach(function (c) {
              c.style.setProperty('display', 'inline-flex', 'important');
              c.style.setProperty('align-items', 'center', 'important');
              c.style.setProperty('justify-content', 'center', 'important');
              c.style.setProperty('min-width', '30px', 'important');
              c.style.setProperty('height', '36px', 'important');
              c.style.setProperty('color', text, 'important');
              c.style.setProperty('font-weight', '700', 'important');
              c.style.setProperty('font-size', '0.95rem', 'important');
            });

            document.querySelectorAll('input.srv-input.price-field, .price-input input.srv-input').forEach(function (inp) {
              inp.style.setProperty('flex', '1 1 auto', 'important');
              inp.style.setProperty('border', 'none', 'important');
              inp.style.setProperty('background', 'transparent', 'important');
              inp.style.setProperty('color', text, 'important');
              inp.style.setProperty('font-size', '1rem', 'important');
              inp.style.setProperty('padding', '0.25rem 0.25rem', 'important');
              inp.style.setProperty('outline', 'none', 'important');
              inp.style.setProperty('min-width', '0', 'important');
            });

            document.querySelectorAll('.srv-note.price-note').forEach(function (n) {
              n.style.setProperty('margin', '0.35rem 0 0 0', 'important');
              n.style.setProperty('color', secondary, 'important');
              n.style.setProperty('font-size', '0.8rem', 'important');
            });

            document.querySelectorAll('.srv-feedback.price-feedback').forEach(function (f) {
              f.style.setProperty('margin-top', '0.35rem', 'important');
              f.style.setProperty('font-size', '0.85rem', 'important');
              f.style.setProperty('color', accent, 'important');
              // keep hidden unless JS toggles it
              if (!f.classList.contains('visible')) f.style.setProperty('display', 'none', 'important');
            });
          }

          // Run now and observe
          apply();
          var attempts = 0; var id = setInterval(function () { apply(); attempts++; if (attempts > 20) clearInterval(id); }, 150);
          var mo = new MutationObserver(function () { apply(); }); mo.observe(document.body, { childList: true, subtree: true });
        })();
      </script>
      <script>
        // Forzar estilos inline en dropdown y items de Choices para evitar reglas externas que los pongan en blanco
        (function forceChoicesDropdownColors() {
          function varOr(def, name) {
            try { var v = getComputedStyle(document.documentElement).getPropertyValue(name); return (v && v.trim()) || def; } catch (e) { return def; }
          }
          var bg = varOr('#1a1a1a', '--admin-card-bg');
          var text = varOr('#ffffff', '--admin-text-primary');
          var border = varOr('#333', '--admin-border-color');

          function applyToList(list) {
            try {
              list.style.setProperty('background', bg, 'important');
              list.style.setProperty('color', text, 'important');
              list.style.setProperty('border', '1px solid ' + border, 'important');
            } catch (e) { }
          }
          function applyToItem(it) {
            try {
              it.style.setProperty('color', text, 'important');
              it.style.setProperty('background', 'transparent', 'important');
              it.style.setProperty('border-color', border, 'important');
            } catch (e) { }
          }

          function process() {
            document.querySelectorAll('.choices__list--dropdown').forEach(applyToList);
            document.querySelectorAll('.choices__list--dropdown .choices__item').forEach(applyToItem);
          }

          // Run immediately and then repeatedly for dynamic injection
          process();
          var attempts = 0;
          var iid = setInterval(function () { process(); attempts++; if (attempts > 30) clearInterval(iid); }, 150);

          var mo = new MutationObserver(function () { process(); });
          mo.observe(document.body, { childList: true, subtree: true });
        })();
      </script>
      <script>
        // Selector dinámico de Días Disponibles: click / teclado y sincronización con input oculto
        (function daysSelector() {
          function readHidden() {
            var h = document.getElementById('diasDisponibles');
            if (!h) return [];
            if (!h.value) return [];
            try { var v = JSON.parse(h.value); if (Array.isArray(v)) return v; } catch (e) { }
            return h.value.split(',').map(function (s) { return s.trim(); }).filter(Boolean);
          }

          function writeHidden(arr) {
            var h = document.getElementById('diasDisponibles');
            if (!h) return;
            h.value = JSON.stringify(arr);
          }

          function shortLabel(day) {
            // Map day names to short letters shown in UI
            var map = { 'Lunes': 'L', 'Martes': 'M', 'Miércoles': 'X', 'Miercoles': 'X', 'Jueves': 'J', 'Viernes': 'V', 'Sábado': 'S', 'Sabado': 'S', 'Domingo': 'D' };
            return map[day] || (day && day.charAt(0)) || '';
          }

          function updateDisplay(selected) {
            var disp = document.querySelector('.srv-days-display');
            if (!disp) return;
            if (!selected || selected.length === 0) {
              disp.textContent = 'Ningún día seleccionado';
            } else {
              // mostrar nombres cortos y la lista completa al pasar el ratón
              var short = selected.map(function (d) { return shortLabel(d); }).join(' ');
              disp.textContent = short + ' — ' + selected.join(', ');
            }
          }

          function toggleDay(el) {
            if (!el) return;
            var day = el.getAttribute('data-day');
            if (!day) return;
            var was = el.classList.toggle('selected');
            el.setAttribute('aria-pressed', was ? 'true' : 'false');
            syncHiddenFromUI();
          }

          function syncHiddenFromUI() {
            var items = Array.from(document.querySelectorAll('.srv-day.selected')).map(function (e) { return e.getAttribute('data-day'); }).filter(Boolean);
            writeHidden(items);
            updateDisplay(items);
          }

          document.addEventListener('DOMContentLoaded', function () {
            var nodes = Array.from(document.querySelectorAll('.srv-day'));
            nodes.forEach(function (n) {
              n.setAttribute('tabindex', '0');
              n.setAttribute('role', 'button');
              n.setAttribute('aria-pressed', 'false');
              n.addEventListener('click', function (e) { toggleDay(n); });
              n.addEventListener('keydown', function (e) { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleDay(n); } });
            });

            // Initialize from hidden input if present (edición)
            var initial = readHidden();
            if (initial && initial.length) {
              nodes.forEach(function (n) { var d = n.getAttribute('data-day'); if (initial.indexOf(d) !== -1) { n.classList.add('selected'); n.setAttribute('aria-pressed', 'true'); } });
            }
            syncHiddenFromUI();

            // Exponer función global rápida para tests (opcional)
            window._srv = window._srv || {};
            window._srv.getSelectedDays = function () { try { return JSON.parse(document.getElementById('diasDisponibles').value); } catch (e) { return []; } };
          });
        })();
      </script>
      <script>
        // Fallback definitivo: aplicar estilos inline para forzar layout horizontal de días
        (function forceDaysInlineStyles() {
          function apply() {
            try {
              var containers = document.querySelectorAll('.srv-days');
              containers.forEach(function (c) {
                c.style.setProperty('display', 'flex', 'important');
                c.style.setProperty('flex-direction', 'row', 'important');
                c.style.setProperty('flex-wrap', 'wrap', 'important');
                c.style.setProperty('gap', '0.5rem', 'important');
                c.style.setProperty('align-items', 'center', 'important');
                c.style.setProperty('justify-content', 'flex-start', 'important');
                c.style.setProperty('margin-top', '0.35rem', 'important');
                c.style.setProperty('padding', '0', 'important');
              });

              document.querySelectorAll('.srv-day').forEach(function (n) {
                n.style.setProperty('display', 'inline-flex', 'important');
                n.style.setProperty('align-items', 'center', 'important');
                n.style.setProperty('justify-content', 'center', 'important');
                n.style.setProperty('width', '40px', 'important');
                n.style.setProperty('height', '40px', 'important');
                n.style.setProperty('min-width', '40px', 'important');
                n.style.setProperty('padding', '0', 'important');
                n.style.setProperty('margin', '0', 'important');
                n.style.setProperty('box-sizing', 'border-box', 'important');
                n.style.setProperty('line-height', '1', 'important');
                n.style.setProperty('position', 'relative', 'important');
              });
            } catch (e) { /* ignore */ }
          }

          document.addEventListener('DOMContentLoaded', function () {
            apply();
            var attempts = 0;
            var iid = setInterval(function () { apply(); attempts++; if (attempts > 25) clearInterval(iid); }, 120);

            var mo = new MutationObserver(function () { apply(); });
            mo.observe(document.body, { childList: true, subtree: true });

            // reapply on window resize in case responsive rules try to change layout
            window.addEventListener('resize', function () { apply(); });
          });
        })();
      </script>
=======
                <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP" <!-- Inline
                  UI scripts removed; logic is centralized in /assets/js/admin/admin-expertos.js -->
>>>>>>> f6d3d6a87628fb1eff6cb39bf29d70fa0a856857
</body>

</html>
<h3 class="bank-title">
  <i class="fas fa-university"></i> Datos Bancarios para Pagos
</h3>
<p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

<div class="bank-grid">
  <div>
    <label for="banco">Banco *</label>
    <div id="banco-wrapper">
      <select id="banco" name="banco" required class="modal-expert__input">
        <option value="">Selecciona tu banco</option>
        <option value="Banco de Bogotá">Banco de Bogotá</option>
        <option value="Bancolombia">Bancolombia</option>
        <option value="Banco Popular">Banco Popular</option>
        <option value="Banco AV Villas">Banco AV Villas</option>
        <option value="Banco Caja Social">Banco Caja Social</option>
        <option value="Banco de Occidente">Banco de Occidente</option>
        <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
        <option value="Banco Itaú">Banco Itaú</option>
        <option value="Banco Pichincha">Banco Pichincha</option>
        <option value="Banco Santander">Banco Santander</option>
        <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
        <option value="Davivienda">Davivienda</option>
        <option value="Banco Agrario">Banco Agrario</option>
        <option value="Banco Falabella">Banco Falabella</option>
        <option value="Banco Finandina">Banco Finandina</option>
        <option value="Banco W">Banco W</option>
        <option value="Banco Serfinanza">Banco Serfinanza</option>
        <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
        <option value="Banco BBVA">Banco BBVA</option>
        <option value="Nequi">Nequi</option>
        <option value="Daviplata">Daviplata</option>
        <option value="Movii">Movii</option>
        <option value="Banco de Vivienda">Banco de Vivienda</option>
        <option value="Banco ProCredit">Banco ProCredit</option>
        <option value="Banco Multibank">Banco Multibank</option>
        <option value="Banco Coopcentral">Banco Coopcentral</option>
        <option value="Banco Credifinanciera">Banco Credifinanciera</option>
        <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
        <option value="Banco Ripley">Banco Ripley</option>
        <option value="Banco CrediScotia">Banco CrediScotia</option>
      </select>
    </div>
  </div>

  <div>
    <label for="tipoCuenta">Tipo de cuenta *</label>
    <div id="tipoCuenta-wrapper">
      <select id="tipoCuenta" name="tipoCuenta" required class="modal-expert__input">
        <option value="">Selecciona el tipo</option>
        <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
        <option value="Cuenta Corriente">Cuenta Corriente</option>
        <option value="Cuenta de Nómina">Cuenta de Nómina</option>
        <option value="Cuenta Digital">Cuenta Digital</option>
      </select>
    </div>
  </div>

  <div>
    <label for="numeroCuenta">Número de cuenta *</label>
    <div class="acct-wrap">
      <input type="password" id="numeroCuenta" name="numeroCuenta" required placeholder="Número de cuenta"
        pattern="[0-9\-]*" title="Solo números y guiones" class="acct-input">
      <button type="button" id="toggleAccountNumber" class="acct-toggle" aria-label="Mostrar número de cuenta">
        <i class="fas fa-eye"></i>
      </button>
    </div>
    <p class="hint">Número completo de tu cuenta</p>
  </div>

  <div>
    <label for="titular">Titular de la cuenta *</label>
    <input type="text" id="titular" name="titular" required placeholder="Nombre completo del titular"
      class="modal-expert__input">
    <p class="hint">Debe coincidir con el nombre en la cuenta</p>
  </div>

  <div>
    <label for="tipoDocumento">Tipo de documento *</label>
    <div id="tipoDocumento-wrapper">
      <select id="tipoDocumento" name="tipoDocumento" required class="modal-expert__input">
        <option value="">Selecciona el tipo</option>
        <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
        <option value="Cédula de Extranjería">Cédula de Extranjería</option>
        <option value="Pasaporte">Pasaporte</option>
        <option value="NIT">NIT (Persona Jurídica)</option>
      </select>
    </div>
  </div>

  <div>
    <label for="numeroDocumento">Número de documento *</label>
    <input type="text" id="numeroDocumento" name="numeroDocumento" required placeholder="Número de identificación"
      pattern="[0-9\-]*" class="modal-expert__input">
    <p class="hint">Documento del titular</p>
  </div>

  <div class="full-width">
    <label for="telefonoContacto">Teléfono de contacto</label>
    <input type="tel" id="telefonoContacto" name="telefonoContacto" placeholder="+57 300 123 4567"
      class="modal-expert__input">
    <p class="hint">Opcional: Teléfono para contacto sobre pagos</p>
  </div>
</div>

<div class="info-box info-sm">
  <div class="info-header">
    <i class="fas fa-info-circle"></i>
    <strong>Información importante sobre pagos</strong>
  </div>
  <ul class="info-list">
    <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
    <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
    <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
    <li><i class="fas fa-check"></i> Seguridad garantizada</li>
  </ul>
</div>
</div>
</div>
</div>
</form>
</div>

<!-- Moved footer inside container so it remains visually part of the modal.
             The container is a column-flex so the body scrolls while footer stays at bottom. -->
<div class="modal-expert__footer">
  <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
  <button type="button" class="btn-primary" id="saveExpert">Guardar experto</button>
</div>
</div>
</div>

<!--modal ver perfil experto-->
<div id="verPerfilExperto" class="modal-expert">

  <div class="modal-expert__container">
    <div class="modal-expert__header">
      <h2 class="modal-expert__title">Perfil del experto</h2>
      <button class="btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
    </div>

    <div class="modal-expert__body">
      <form id="expertForm">
        <!-- Layout helper: responsive two-column grid for most rows -->
        <div class="modal-expert__grid">

          <!-- Información básica -->
          <div>
            <label class="modal-expert__label" for="name">
              <i class="fas fa-user modal-expert__icon" aria-hidden="true"></i>
              Nombre completo
            </label>
            <input type="text" id="name" placeholder="Nombre y apellidos registrados" class="modal-expert__input" />
          </div>

          <div>
            <label class="modal-expert__label" for="email">
              <i class="fas fa-envelope modal-expert__icon" aria-hidden="true"></i>
              Email registrado
            </label>
            <input type="email" id="email" placeholder="Email de la cuenta" class="modal-expert__input" />
          </div>

          <!-- Precio por hora (columna) -->
          <div>
            <label for="precio" class="modal-expert__label">
              <i class="fas fa-money-bill-wave modal-expert__icon" aria-hidden="true" title="Precio"></i>
              Precio por hora (COP)
              <span class="price-tooltip icon-tooltip" title="Ejemplo recomendado: $30.000 - $200.000 COP"
                style="margin-left:.5rem;">
                <i class="fas fa-info-circle"></i>
              </span>
            </label>

            <div class="srv-price-input price-input">
              <span class="srv-currency currency-symbol">$</span>
              <input type="number" id="precio" name="precio" min="10000" step="100" required placeholder="Ej: 50000"
                class="srv-input price-field" />
            </div>
            <p class="srv-note price-note">
              Tarifa por hora de asesoría (Recomendado: $30.000 - $200.000 COP)
            </p>
            <div id="precio-feedback" class="srv-feedback price-feedback" aria-live="polite"></div>
          </div>

          <!-- Días disponibles (columna) -->
          <div>
            <label for="diasDisponibles" class="modal-expert__label">
              <i class="fas fa-calendar-alt modal-expert__icon" aria-hidden="true"></i>
              Días disponibles
            </label>

            <div class="srv-days-wrapper">
              <div class="srv-days">
                <button type="button" class="srv-day" data-day="Lunes" aria-pressed="false">L</button>
                <button type="button" class="srv-day" data-day="Martes" aria-pressed="false">M</button>
                <button type="button" class="srv-day" data-day="Miércoles" aria-pressed="false">X</button>
                <button type="button" class="srv-day" data-day="Jueves" aria-pressed="false">J</button>
                <button type="button" class="srv-day" data-day="Viernes" aria-pressed="false">V</button>
                <button type="button" class="srv-day" data-day="Sábado" aria-pressed="false">S</button>
                <button type="button" class="srv-day" data-day="Domingo" aria-pressed="false">D</button>
              </div>

              <div class="srv-days-display">
                Ningún día seleccionado
              </div>
            </div>

            <input type="hidden" id="diasDisponibles" name="diasDisponibles" />
          </div>

          <!-- Especialidad principal -->
          <div>
            <label class="modal-expert__label" for="specialty">
              <i class="fas fa-briefcase modal-expert__icon" aria-hidden="true"></i>
              Especialidad principal
            </label>
            <div class="input-with-icon">
              <i class="fas fa-briefcase" aria-hidden="true"></i>
              <select id="specialty" class="modal-expert__input modal-expert__select"
                aria-label="Especialidad principal">
                <option value="">Seleccionar especialidad</option>
                <option value="web">Desarrollo Web</option>
                <option value="mobile">Desarrollo Móvil</option>
                <option value="data">Ciencia de Datos</option>
                <option value="uxui">UX/UI</option>
                <option value="devops">DevOps</option>
                <option value="blockchain">Blockchain</option>
                <option value="cloud">Cloud Computing</option>
              </select>
              <i class="fas fa-chevron-down" aria-hidden="true"></i>
            </div>
            <small class="modal-expert__hint">Selecciona la especialidad principal que describe mejor al
              experto</small>
          </div>

          <!-- Estado -->
          <div>
            <label class="modal-expert__label" for="status">
              <i class="fas fa-toggle-on modal-expert__icon" aria-hidden="true"></i>
              Estado
            </label>
            <div class="input-with-icon">
              <i class="fas fa-toggle-on" aria-hidden="true"></i>
              <select id="status" class="modal-expert__input modal-expert__select" aria-label="Estado del experto">
                <option value="active">Activo</option>
                <option value="pending">Pendiente</option>
                <option value="inactive">Inactivo</option>
              </select>
              <i class="fas fa-chevron-down" aria-hidden="true"></i>
            </div>
            <small class="modal-expert__hint">Define si el experto puede recibir solicitudes</small>
          </div>

          <!-- Categorías (full width) -->
          <div class="full-width">
            <label class="modal-expert__label" for="categorias">
              <i class="fas fa-tags modal-expert__icon" aria-hidden="true"></i>
              Categorías
            </label>
            <select id="categorias" class="modal-expert__input modal-expert__select-categorias" multiple size="4"
              aria-label="Categorías">
              <!-- opciones añadidas dinámicamente -->
            </select>

            <!-- Choices initialization and visual fixes are centralized in /assets/js/admin/admin-expertos.js -->
            <small class="modal-expert__hint">Selecciona una o varias categorías (Ctrl/Cmd+click)</small>
          </div>

          <!-- Habilidades (full width) -->
          <div class="full-width">
            <label class="modal-expert__label" for="skills">
              <i class="fas fa-tools modal-expert__icon" aria-hidden="true"></i>
              Habilidades
            </label>
            <select id="skills" class="modal-expert__input" multiple size="6">
              <% if (typeof habilidades !=='undefined' && Array.isArray(habilidades) && habilidades.length> 0) { %>
                <% habilidades.forEach(function(h) { %>
                  <% const val=(h && (h.nombre || h.name || h.label)) ? (h.nombre || h.name || h.label) : (h && h._id ?
                    String(h._id) : '' ); %>
                    <% if (val) { %>
                      <option value="<%= val %>">
                        <%= val %>
                      </option>
                      <% } %>
                        <% }); %>
                          <% } %>
            </select>
            <!-- Inicialización de Choices para #skills centralizada en /assets/js/admin/admin-expertos.js -->
            <small class="modal-expert__hint">Selecciona o escribe para añadir nuevas habilidades</small>
          </div>

          <!-- Biografía -->
          <div class="full-width">
            <label class="modal-expert__label" for="bio">
              <i class="fas fa-file-alt modal-expert__icon" aria-hidden="true"></i>
              Biografía profesional
            </label>
            <textarea id="bio" rows="4" placeholder="Descripción breve de experiencia y especialización"
              class="modal-expert__input modal-expert__textarea"></textarea>
          </div>

          <!-- Imagen de perfil -->
          <div class="full-width">
            <label class="modal-expert__label" for="profileImage">
              <i class="fas fa-image modal-expert__icon" aria-hidden="true"></i>
              Imagen de perfil
            </label>

            <div class="modal-expert__upload-wrapper">
              <!-- hidden but accessible -->
              <input type="file" id="profileImage" class="modal-expert__file-input"
                aria-label="Seleccionar imagen de perfil" accept="image/*" />

              <!-- visual upload box (acts as label) -->
              <label for="profileImage" class="modal-expert__upload-box" role="button" aria-haspopup="dialog">
                <i class="fas fa-upload" aria-hidden="true"></i>
                <span id="uploadLabel">Seleccionar imagen (png, jpg) · Máx 2MB</span>
              </label>

              <!-- preview thumbnail -->
              <div id="profilePreview" aria-hidden="true" role="img" aria-label="Vista previa de imagen">
                <button id="removeProfileBtn" type="button" title="Eliminar imagen" aria-label="Eliminar imagen"
                  style="display:none;">
                  <i class="fas fa-times"></i>
                </button>
                <img src="" alt="Preview" />
              </div>

              <div class="upload-meta" id="uploadMeta" aria-live="polite" style="display:none;"></div>
              <div class="upload-error" id="profileImageError" role="alert" style="display:none;"></div>
            </div>
          </div>

          <!-- Espacio reservado para mantener la columna alineada -->
          <div aria-hidden="true"></div>

          <!-- Sección bancaria (tarjeta de ancho completo) -->
          <div class="full-width">
            <div class="bank-section">
              <h3 class="bank-title">
                <i class="fas fa-university"></i> Datos Bancarios para Pagos
              </h3>
              <p class="bank-sub">Información necesaria para recibir pagos por tus asesorías</p>

              <div class="bank-grid">
                <div>
                  <label for="banco">Banco *</label>
                  <div id="banco-wrapper">
                    <select id="banco" name="banco" required class="modal-expert__input">
                      <option value="">Selecciona tu banco</option>
                      <option value="Banco de Bogotá">Banco de Bogotá</option>
                      <option value="Bancolombia">Bancolombia</option>
                      <option value="Banco Popular">Banco Popular</option>
                      <option value="Banco AV Villas">Banco AV Villas</option>
                      <option value="Banco Caja Social">Banco Caja Social</option>
                      <option value="Banco de Occidente">Banco de Occidente</option>
                      <option value="Banco GNB Sudameris">Banco GNB Sudameris</option>
                      <option value="Banco Itaú">Banco Itaú</option>
                      <option value="Banco Pichincha">Banco Pichincha</option>
                      <option value="Banco Santander">Banco Santander</option>
                      <option value="Banco Scotiabank Colpatria">Banco Scotiabank Colpatria</option>
                      <option value="Davivienda">Davivienda</option>
                      <option value="Banco Agrario">Banco Agrario</option>
                      <option value="Banco Falabella">Banco Falabella</option>
                      <option value="Banco Finandina">Banco Finandina</option>
                      <option value="Banco W">Banco W</option>
                      <option value="Banco Serfinanza">Banco Serfinanza</option>
                      <option value="Banco Cooperativo Coopcentral">Banco Cooperativo Coopcentral</option>
                      <option value="Banco BBVA">Banco BBVA</option>
                      <option value="Nequi">Nequi</option>
                      <option value="Daviplata">Daviplata</option>
                      <option value="Movii">Movii</option>
                      <option value="Banco de Vivienda">Banco de Vivienda</option>
                      <option value="Banco ProCredit">Banco ProCredit</option>
                      <option value="Banco Multibank">Banco Multibank</option>
                      <option value="Banco Coopcentral">Banco Coopcentral</option>
                      <option value="Banco Credifinanciera">Banco Credifinanciera</option>
                      <option value="Banco Mundo Mujer">Banco Mundo Mujer</option>
                      <option value="Banco Ripley">Banco Ripley</option>
                      <option value="Banco CrediScotia">Banco CrediScotia</option>
                    </select>
                  </div>
                </div>

                <div>
                  <label for="tipoCuenta">Tipo de cuenta *</label>
                  <div id="tipoCuenta-wrapper">
                    <select id="tipoCuenta" name="tipoCuenta" required class="modal-expert__input">
                      <option value="">Selecciona el tipo</option>
                      <option value="Cuenta de Ahorros">Cuenta de Ahorros</option>
                      <option value="Cuenta Corriente">Cuenta Corriente</option>
                      <option value="Cuenta de Nómina">Cuenta de Nómina</option>
                      <option value="Cuenta Digital">Cuenta Digital</option>
                    </select>
                  </div>
                </div>

                <div>
                  <label for="numeroCuenta">Número de cuenta *</label>
                  <div class="acct-wrap">
                    <input type="password" id="numeroCuenta" name="numeroCuenta" required placeholder="Número de cuenta"
                      pattern="[0-9\-]*" title="Solo números y guiones" class="acct-input">
                    <button type="button" id="toggleAccountNumber" class="acct-toggle"
                      aria-label="Mostrar número de cuenta">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <p class="hint">Número completo de tu cuenta</p>
                </div>

                <div>
                  <label for="titular">Titular de la cuenta *</label>
                  <input type="text" id="titular" name="titular" required placeholder="Nombre completo del titular"
                    class="modal-expert__input">
                  <p class="hint">Debe coincidir con el nombre en la cuenta</p>
                </div>

                <div>
                  <label for="tipoDocumento">Tipo de documento *</label>
                  <div id="tipoDocumento-wrapper">
                    <select id="tipoDocumento" name="tipoDocumento" required class="modal-expert__input">
                      <option value="">Selecciona el tipo</option>
                      <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                      <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                      <option value="Pasaporte">Pasaporte</option>
                      <option value="NIT">NIT (Persona Jurídica)</option>
                    </select>
                  </div>
                </div>

                <div>
                  <label for="numeroDocumento">Número de documento *</label>
                  <input type="text" id="numeroDocumento" name="numeroDocumento" required
                    placeholder="Número de identificación" pattern="[0-9\-]*" class="modal-expert__input">
                  <p class="hint">Documento del titular</p>
                </div>

                <div class="full-width">
                  <label for="telefonoContacto">Teléfono de contacto</label>
                  <input type="tel" id="telefonoContacto" name="telefonoContacto" placeholder="+57 300 123 4567"
                    class="modal-expert__input">
                  <p class="hint">Opcional: Teléfono para contacto sobre pagos</p>
                </div>
              </div>

              <div class="info-box info-sm">
                <div class="info-header">
                  <i class="fas fa-info-circle"></i>
                  <strong>Información importante sobre pagos</strong>
                </div>
                <ul class="info-list">
                  <li><i class="fas fa-check"></i> Los pagos se procesan cada 15 días</li>
                  <li><i class="fas fa-check"></i> Se requiere verificación de cuenta</li>
                  <li><i class="fas fa-check"></i> Datos editables desde tu perfil</li>
                  <li><i class="fas fa-check"></i> Seguridad garantizada</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Moved footer inside container so it remains visually part of the modal.
             The container is a column-flex so the body scrolls while footer stays at bottom. -->
    <div class="modal-expert__footer">
      <button class="btn-outline" data-dismiss="modal" type="button">Cancelar</button>
      <button type="button" class="btn-primary" id="saveExpert">Guardar experto</button>
    </div>
  </div>
</div>


<!-- Modal inactivar experto -->
<div id="modalInactivarExperto" class="modal-expert">
  <div class="modal-expert__content">
    <div class="modal-expert__header">
      <h2 class="modal-expert__title">Inactivar experto</h2>
      <button class="btn-close"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-expert__body">
      <p id="modalInactivarExpertoNombre" class="modal-expert__nombre-destacado"></p>
      <p>
        ¿Está seguro que desea inactivar este usuario?<br />
        <span class="modal-expert__texto-secundario">
          El usuario <b>no se eliminará</b> de la base de datos, solo pasará
          a estado <b>inactivo</b>.
        </span>
      </p>
    </div>
    <div class="modal-expert__footer">
      <button type="button" class="btn-outline modal-inactivar-cancelar">
        Cancelar
      </button>
      <button type="button" class="btn-primary modal-inactivar-confirmar">
        Inactivar
      </button>
    </div>
  </div>
</div>

<script src="/assets/js/admin/admin-common.js"></script>
<% /* Garantizar que _adminHabs siempre sea un array para producir JSON válido */ %>
  <% const _adminHabs=(typeof habilidades !=='undefined' && Array.isArray(habilidades)) ? habilidades : []; %>
    <!-- Inyectar JSON en un script de tipo application/json y leerlo desde JS -->
    <script id="admin-habilidades" type="application/json"><%- JSON.stringify(_adminHabs) %></script>
    <script src="/assets/js/admin/admin-expertos.js"></script>
    <script src="/assets/js/admin/admin-expertos.bootstrap.js"></script>
    <!-- Inline DOM helpers and forced inline styles were moved to /assets/js/admin/admin-expertos.js
       This file now centralizes: Choices visual fixes, days selector, price feedback, account toggle and image preview.
       Removed duplicated IIFEs from template to avoid double execution. -->
    </body>

    </html>
