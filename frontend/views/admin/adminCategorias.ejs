<!--
  Archivo: admin/adminCategorias.ejs
  Propósito: Panel para gestionar categorías del sitio (crear/editar/eliminar, paginación).
  Variables EJS esperadas:
    - user: objeto admin (opcional)
  Dependencias CSS/JS:
    - /assets/css/admin-categoria.css, /assets/css/admin-components.css
    - /assets/js/admin/admin-categorias.js (scripts de CRUD y validación)
  Notas técnicas:
    - Formularios usan validación lado cliente; los endpoints reales deben documentarse en la sección de API.
-->

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Categorías - Servitech Admin</title>
  <link rel="stylesheet" href="/assets/css/administrador.css" />
  <link rel="stylesheet" href="/assets/css/admin.css" />
  <!--<link rel="stylesheet" href="/assets/css/admin-responsive.css" />-->
  <link rel="stylesheet" href="/assets/css/admin-components.css" />
  <!-- page-specific CSS -->
  <link rel="stylesheet" href="/assets/css/admin-clientes.css" />
  <link rel="stylesheet" href="/assets/css/admin-categoria.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <div class="admin-layout">
    <%- include('../componentes/navbarAdmin.ejs') %>

      <main class="admin-main">

        <!-- Header -->
        <header class="admin-header">
          <div class="header-search">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Buscar categorías..." />
          </div>
          <div class="header-actions">
            <div class="notification-icon">
              <i class="fas fa-bell"></i>
              <span class="notification-badge">5</span>
            </div>
            <div class="admin-profile">
              <img src="https://i.pravatar.cc/150?img=11" alt="Admin profile" class="profile-img" />
              <div class="profile-info">
                <span class="profile-name">Admin ServiTech</span>
                <span class="profile-role">Administrador</span>
              </div>
              <i class="fas fa-chevron-down"></i>
            </div>
          </div>
        </header>

        <!-- Contenido principal -->
        <div class="admin-content">

          <!-- button Nueva categoría / Exportar -->
          <div class="page-header">
            <h1>Gestión de Categorías</h1>
            <div class="page-actions">
              <button class="btn-primary" id="btnAddCategory">
                <i class="fas fa-plus"></i>
                <span>Nueva categoría</span>
              </button>
              <button class="btn-outline">
                <i class="fas fa-file-export"></i>
                <span>Exportar</span>
              </button>
            </div>
          </div>

          <!-- Tabla de categorías -->
          <div class="table-container categorias-grid__tabla"> <!-- Contenedor de la tabla principal de categorías -->
            <table class="admin-table categorias-table"> <!-- Tabla con listado de categorías -->
              <thead> <!-- Encabezado de la tabla -->
                <tr> <!-- Fila del encabezado -->
                  <th>
                    <input type="checkbox" id="selectAll" class="categorias-checkbox" />
                    <!-- Checkbox para seleccionar todas las filas -->
                  </th>
                  <th>Categoría</th> <!-- Columna: Nombre de la categoría -->
                  <th>Slug</th> <!-- Columna: Slug/URL amigable -->
                  <th>Categoría Padre</th> <!-- Columna: Categoría padre -->
                  <th>Publicaciones</th> <!-- Columna: Número de publicaciones -->
                  <th>Expertos</th> <!-- Columna: Número de expertos -->
                  <th>Estado</th> <!-- Columna: Estado (Activa/Inactiva) -->
                  <th>Acciones</th> <!-- Columna: Botones de acción (editar/ver/eliminar) -->
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <!-- Paginación -->
            <div class="categorias-paginacion"> <!-- Contenedor de paginación -->
              <span class="categorias-paginacion__info">Mostrando 1-7 de 32 categorías</span>
              <!-- Texto informativo de paginación -->
              <div class="categorias-paginacion__controles"> <!-- Controles de navegación de páginas -->
                <button class="categorias-paginacion__btn categorias-paginacion__btn--disabled">
                  <!-- Botón anterior deshabilitado -->
                  <i class="fas fa-chevron-left"></i>
                </button>
                <button class="categorias-paginacion__btn categorias-paginacion__btn--active"> <!-- Página activa -->
                  1
                </button>
                <button class="categorias-paginacion__btn">2</button> <!-- Página 2 -->
                <button class="categorias-paginacion__btn">3</button> <!-- Página 3 -->
                <button class="categorias-paginacion__btn">4</button> <!-- Página 4 -->
                <button class="categorias-paginacion__btn">5</button> <!-- Página 5 -->
                <button class="categorias-paginacion__btn"> <!-- Botón siguiente -->
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>

          </div> <!-- Fin del contenedor de la tabla -->
        </div>

  </div>
  </main>
  </div>

  <!-- Modal para agregar categoría -->
  <div id="categoryModal" class="modal-categoria">
    <div class="modal-categoria__content">
      <div class="modal-categoria__header">
        <h2 class="modal-categoria__title">Agregar nueva categoría</h2>
        <button class="btn-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-categoria__body">
        <form id="categoryForm">
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Nombre de la categoría</label>
              <input type="text" id="categoryName" placeholder="Ej: Desarrollo Web" class="modal-categoria__input" />
            </div>
            <div>
              <label class="modal-categoria__label">Slug (URL amigable)</label>
              <input type="text" id="categorySlug" placeholder="Ej: desarrollo-web" class="modal-categoria__input" />
            </div>
          </div>
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Categoría padre</label>
              <select id="parentCategory" class="modal-categoria__input">
                <option value="">Sin categoría padre</option>
                <!-- Las opciones se cargarán dinámicamente -->
              </select>
            </div>
            <div>
              <label class="modal-categoria__label">Estado</label>
              <select id="categoryStatus" class="modal-categoria__input">
                <option value="active">Activa</option>
                <option value="inactive">Inactiva</option>
              </select>
            </div>
          </div>
          <div>
            <label class="modal-categoria__label">Descripción</label>
            <textarea id="categoryDescription" rows="4" maxlength="300" placeholder="Breve descripción de la categoría"
              class="modal-categoria__input modal-categoria__textarea"></textarea>
          </div>
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Icono (Font Awesome)</label>
              <input type="text" id="categoryIcon" placeholder="Ej: laptop-code" class="modal-categoria__input" />
              <small class="modal-categoria__hint">Ingresa el nombre del icono sin el prefijo 'fa-'</small>
            </div>
            <div>
              <label class="modal-categoria__label">Color del icono</label>
              <input type="color" id="iconColor" value="#3a8eff"
                class="modal-categoria__input modal-categoria__input--color" />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-categoria__footer">
        <button class="btn-outline" data-dismiss="modal">Cancelar</button>
        <button class="btn-primary" id="saveCategory">
          Guardar categoría
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Editar Categoría -->
  <div id="modalEditarCategoria" class="modal-categoria">
    <div class="modal-categoria__content">
      <div class="modal-categoria__header">
        <h2 class="modal-categoria__title">Editar categoría</h2>
        <button class="btn-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-categoria__body">
        <form id="formEditarCategoria">
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Nombre</label>
              <input type="text" id="editarNombreCategoria" class="modal-categoria__input" />
            </div>
            <div>
              <label class="modal-categoria__label">Slug</label>
              <input type="text" id="editarSlugCategoria" class="modal-categoria__input" />
            </div>
          </div>
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Categoría padre</label>
              <select id="editarPadreCategoria" class="modal-categoria__input">
                <option value="">Sin categoría padre</option>
                <option value="development">Desarrollo</option>
                <option value="design">Diseño</option>
                <option value="data">Datos</option>
                <option value="infrastructure">Infraestructura</option>
              </select>
            </div>
            <div>
              <label class="modal-categoria__label">Estado</label>
              <select id="editarEstadoCategoria" class="modal-categoria__input">
                <option value="active">Activa</option>
                <option value="inactive">Inactiva</option>
              </select>
            </div>
          </div>
          <div>
            <label class="modal-categoria__label">Descripción</label>
            <textarea id="editarDescripcionCategoria" maxlength="300"
              class="modal-categoria__input modal-categoria__textarea"></textarea>
          </div>
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Icono (Font Awesome)</label>
              <input type="text" id="editarIconoCategoria" placeholder="Ej: laptop-code"
                class="modal-categoria__input" />
              <small class="modal-categoria__hint">Ingresa el nombre del icono sin el prefijo 'fa-'</small>
            </div>
            <div>
              <label class="modal-categoria__label">Color del icono</label>
              <input type="color" id="editarColorCategoria"
                class="modal-categoria__input modal-categoria__input--color" />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-categoria__footer">
        <button type="button" class="btn-outline modal-categoria-editar-cancelar">
          Cancelar
        </button>
        <button class="btn-primary" type="submit" form="formEditarCategoria">
          Guardar cambios
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Ver Categoría -->
  <div id="modalVerCategoria" class="modal-categoria">
    <div class="modal-categoria__content">
      <div class="modal-categoria__header">
        <h2 class="modal-categoria__title">Detalle de la categoría</h2>
        <button class="btn-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-categoria__body">
        <form id="formVerCategoria">
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Nombre</label>
              <input type="text" id="verNombreCategoria" class="modal-categoria__input" disabled />
            </div>
            <div>
              <label class="modal-categoria__label">Slug</label>
              <input type="text" id="verSlugCategoria" class="modal-categoria__input" disabled />
            </div>
          </div>
          <div class="modal-categoria__grid">
            <div>
              <label class="modal-categoria__label">Categoría padre</label>
              <input type="text" id="verPadreCategoria" class="modal-categoria__input" disabled />
            </div>
            <div>
              <label class="modal-categoria__label">Estado</label>
              <input type="text" id="verEstadoCategoria" class="modal-categoria__input" disabled />
            </div>
          </div>
          <div>
            <label class="modal-categoria__label">Descripción</label>
            <textarea id="verDescripcionCategoria" class="modal-categoria__input modal-categoria__textarea"
              disabled></textarea>
          </div>
        </form>
      </div>
      <div class="modal-categoria__footer">
        <button type="button" class="btn-outline modal-categoria-ver-cerrar">
          Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Eliminar Categoría -->
  <div id="modalEliminarCategoria" class="modal-categoria">
    <div class="modal-categoria__content">
      <div class="modal-categoria__header">
        <h2 class="modal-categoria__title">Eliminar categoría</h2>
        <button class="btn-close"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-categoria__body">
        <p id="modalEliminarCategoriaNombre" class="modal-categoria__nombre-destacado"></p>
        <p>
          ¿Está seguro que desea eliminar esta categoría?<br />
          <span class="modal-categoria__texto-secundario">
            Esta acción <b>no se puede deshacer</b>.
          </span>
        </p>
      </div>
      <div class="modal-categoria__footer">
        <button type="button" class="btn-outline modal-categoria-eliminar-cancelar">
          Cancelar
        </button>
        <button type="button" class="btn-primary modal-categoria-eliminar-confirmar">
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <% if (typeof API_KEY !=='undefined' && API_KEY) { %>
    <script>
      // Exponer API key para llamadas admin desde cliente (solo para sesiones admin)
      window.API_KEY = '<%= API_KEY %>';
    </script>
    <% } %>

      <script src="/assets/js/admin/admin-common.js"></script>
      <script src="/assets/js/admin/admin-categorias-filters.js"></script>
      <script src="/assets/js/admin/admin-categorias-accessibility.js"></script>
      <script src="/assets/js/admin/admin-categorias.js"></script>
</body>

</html>
